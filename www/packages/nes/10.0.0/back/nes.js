!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=36)}([function(e,t,s){"use strict";const r=s(10),n=s(3),i=s(16),o=s(11),a=s(40),c={};t.clone=function(e,s){if("object"!=typeof e||null===e)return e;const r=(s=s||new Map).get(e);if(r)return r;let n,i=!1;if(Array.isArray(e))n=[],i=!0;else if(Buffer.isBuffer(e))n=Buffer.from(e);else if(e instanceof Date)n=new Date(e.getTime());else if(e instanceof RegExp)n=new RegExp(e);else{const t=Object.getPrototypeOf(e);t&&t.isImmutable?n=e:(n=Object.create(t),i=!0)}if(s.set(e,n),i){const r=Object.getOwnPropertyNames(e);for(let i=0;i<r.length;++i){const o=r[i],a=Object.getOwnPropertyDescriptor(e,o);a&&(a.get||a.set)?Object.defineProperty(n,o,a):n[o]=t.clone(e[o],s)}}return n},t.merge=function(e,s,r,n){if(t.assert(e&&"object"==typeof e,"Invalid target value: must be an object"),t.assert(null==s||"object"==typeof s,"Invalid source value: must be null, undefined, or an object"),!s)return e;if(Array.isArray(s)){t.assert(Array.isArray(e),"Cannot merge array onto an object"),!1===n&&(e.length=0);for(let r=0;r<s.length;++r)e.push(t.clone(s[r]));return e}const i=Object.keys(s);for(let o=0;o<i.length;++o){const a=i[o];if("__proto__"===a)continue;const c=s[a];c&&"object"==typeof c?!e[a]||"object"!=typeof e[a]||Array.isArray(e[a])!==Array.isArray(c)||c instanceof Date||Buffer.isBuffer(c)||c instanceof RegExp?e[a]=t.clone(c):t.merge(e[a],c,r,n):null!=c?e[a]=c:!1!==r&&(e[a]=c)}return e},t.applyToDefaults=function(e,s,r){if(t.assert(e&&"object"==typeof e,"Invalid defaults value: must be an object"),t.assert(!s||!0===s||"object"==typeof s,"Invalid options value: must be true, falsy or an object"),!s)return null;const n=t.clone(e);return!0===s?n:t.merge(n,s,!0===r,!1)},t.cloneWithShallow=function(e,s){if(!e||"object"!=typeof e)return e;const r=c.store(e,s),n=t.clone(e);return c.restore(n,e,r),n},c.store=function(e,s){const r={};for(let n=0;n<s.length;++n){const i=s[n],o=t.reach(e,i);void 0!==o&&(r[i]=o,c.reachSet(e,i,void 0))}return r},c.restore=function(e,t,s){const r=Object.keys(s);for(let n=0;n<r.length;++n){const i=r[n];c.reachSet(e,i,s[i]),c.reachSet(t,i,s[i])}},c.reachSet=function(e,t,s){const r=t.split(".");let n=e;for(let e=0;e<r.length;++e){const t=r[e];e+1===r.length&&(n[t]=s),n=n[t]}},t.applyToDefaultsWithShallow=function(e,s,r){if(t.assert(e&&"object"==typeof e,"Invalid defaults value: must be an object"),t.assert(!s||!0===s||"object"==typeof s,"Invalid options value: must be true, falsy or an object"),t.assert(r&&Array.isArray(r),"Invalid keys"),!s)return null;const n=t.cloneWithShallow(e,r);if(!0===s)return n;const i=c.store(s,r);return t.merge(n,s,!1,!1),c.restore(n,s,i),n},t.deepEqual=function(e,s,r,n){if(e===s)return 0!==e||1/e==1/s;r=r||{prototype:!0};const i=typeof e;if(i!==typeof s)return!1;if("object"!==i||null===e||null===s)return e!=e&&s!=s;if(-1!==(n=n||[]).indexOf(e))return!0;if(n.push(e),Array.isArray(e)){if(!Array.isArray(s))return!1;if(!r.part&&e.length!==s.length)return!1;for(let n=0;n<e.length;++n){if(r.part){let i=!1;for(let o=0;o<s.length;++o)if(t.deepEqual(e[n],s[o],r)){i=!0;break}return i}if(!t.deepEqual(e[n],s[n],r))return!1}return!0}if(Buffer.isBuffer(e)){if(!Buffer.isBuffer(s))return!1;if(e.length!==s.length)return!1;for(let t=0;t<e.length;++t)if(e[t]!==s[t])return!1;return!0}if(e instanceof Date)return s instanceof Date&&e.getTime()===s.getTime();if(e instanceof RegExp)return s instanceof RegExp&&e.toString()===s.toString();if(r.prototype&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(s))return!1;const o=Object.getOwnPropertyNames(e);if(!r.part&&o.length!==Object.getOwnPropertyNames(s).length)return!1;for(let i=0;i<o.length;++i){const a=o[i],c=Object.getOwnPropertyDescriptor(e,a);if(c.get){if(!t.deepEqual(c,Object.getOwnPropertyDescriptor(s,a),r,n))return!1}else if(!t.deepEqual(e[a],s[a],r,n))return!1}return!0},t.unique=((e,t)=>{let s;if(t){s=[];const r=new Set;e.forEach(e=>{const n=e[t];r.has(n)||(r.add(n),s.push(e))})}else s=Array.from(new Set(e));return s}),t.mapToObject=function(e,t){if(!e)return null;const s={};for(let r=0;r<e.length;++r)t?e[r][t]&&(s[e[r][t]]=!0):s[e[r]]=!0;return s},t.intersect=function(e,s,r){if(!e||!s)return[];const n=[],i=Array.isArray(e)?t.mapToObject(e):e,o={};for(let e=0;e<s.length;++e)if(i[s[e]]&&!o[s[e]]){if(r)return s[e];n.push(s[e]),o[s[e]]=!0}return r?null:n},t.contain=function(e,s,r){let n,i,o=null;if("object"!=typeof e||"object"!=typeof s||Array.isArray(e)||Array.isArray(s)?s=[].concat(s):(o=s,s=Object.keys(s)),r=r||{},t.assert("string"==typeof e||"object"==typeof e,"Reference must be string or an object"),t.assert(s.length,"Values array cannot be empty"),r.deep){n=t.deepEqual;const e=r.hasOwnProperty("only"),s=r.hasOwnProperty("part");i={prototype:e?r.only:!!s&&!r.part,part:e?!r.only:!s||r.part}}else n=((e,t)=>e===t);let a=!1;const c=new Array(s.length);for(let e=0;e<c.length;++e)c[e]=0;if("string"==typeof e){let r="(";for(let e=0;e<s.length;++e){const n=s[e];t.assert("string"==typeof n,"Cannot compare string reference to non-string value"),r+=(e?"|":"")+t.escapeRegex(n)}const n=new RegExp(r+")","g");a=!!e.replace(n,(e,t)=>{const r=s.indexOf(t);return++c[r],""})}else if(Array.isArray(e))for(let t=0;t<e.length;++t){let r=!1;for(let o=0;o<s.length&&!1===r;++o)r=n(s[o],e[t],i)&&o;!1!==r?++c[r]:a=!0}else{const t=Object.getOwnPropertyNames(e);for(let r=0;r<t.length;++r){const l=t[r],u=s.indexOf(l);if(-1!==u){if(o&&!n(o[l],e[l],i))return!1;++c[u]}else a=!0}}let l=!1;for(let e=0;e<c.length;++e)if(l=l||!!c[e],r.once&&c[e]>1||!r.part&&!c[e])return!1;return(!r.only||!a)&&l},t.flatten=function(e,s){const r=s||[];for(let s=0;s<e.length;++s)Array.isArray(e[s])?t.flatten(e[s],r):r.push(e[s]);return r},t.reach=function(e,s,r){if(!1===s||null==s)return e;"string"==typeof(r=r||{})&&(r={separator:r});const n=s.split(r.separator||".");let i=e;for(let e=0;e<n.length;++e){let o=n[e];if("-"===o[0]&&Array.isArray(i)&&(o=o.slice(1,o.length),o=i.length-o),!i||"object"!=typeof i&&"function"!=typeof i||!(o in i)||"object"!=typeof i&&!1===r.functions){t.assert(!r.strict||e+1===n.length,"Missing segment",o,"in reach path ",s),t.assert("object"==typeof i||!0===r.functions||"function"!=typeof i,"Invalid segment",o,"in reach path ",s),i=r.default;break}i=i[o]}return i},t.reachTemplate=function(e,s,r){return s.replace(/{([^}]+)}/g,(s,n)=>{const i=t.reach(e,n,r);return null==i?"":i})},t.formatStack=function(e){const t=[];for(let s=0;s<e.length;++s){const r=e[s];t.push([r.getFileName(),r.getLineNumber(),r.getColumnNumber(),r.getFunctionName(),r.isConstructor()])}return t},t.formatTrace=function(e){const t=[];for(let s=0;s<e.length;++s){const r=e[s];t.push((r[4]?"new ":"")+r[3]+" ("+r[0]+":"+r[1]+":"+r[2]+")")}return t},t.callStack=function(e){const s=Error.prepareStackTrace;Error.prepareStackTrace=function(e,t){return t};const r={};Error.captureStackTrace(r,this);const n=r.stack;return Error.prepareStackTrace=s,t.formatStack(n).slice(1+e)},t.displayStack=function(e){const s=t.callStack(void 0===e?1:e+1);return t.formatTrace(s)},t.abortThrow=!1,t.abort=function(e,s){if(!0===t.abortThrow)throw new Error(e||"Unknown error");let r="";s||(r=t.displayStack(1).join("\n\t")),console.log("ABORT: "+e+"\n\t"+r),process.exit(1)},t.assert=function(e,...s){if(e)return;if(1===s.length&&s[0]instanceof Error)throw s[0];const n=s.filter(e=>""!==e).map(e=>"string"==typeof e?e:e instanceof Error?e.message:t.stringify(e));throw new r.AssertionError({message:n.join(" ")||"Unknown error",actual:!1,expected:!0,operator:"==",stackStartFunction:t.assert})},t.Bench=function(){this.ts=0,this.reset()},t.Bench.prototype.reset=function(){this.ts=t.Bench.now()},t.Bench.prototype.elapsed=function(){return t.Bench.now()-this.ts},t.Bench.now=function(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6},t.escapeRegex=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")},t.base64urlEncode=function(e,s){return t.assert("string"==typeof e||Buffer.isBuffer(e),"value must be string or buffer"),(Buffer.isBuffer(e)?e:Buffer.from(e,s||"binary")).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")},t.base64urlDecode=function(e,t){if("string"!=typeof e)throw new Error("Value not a string");if(!/^[\w\-]*$/.test(e))throw new Error("Invalid character");const s=Buffer.from(e,"base64");return"buffer"===t?s:s.toString(t||"binary")},t.escapeHeaderAttribute=function(e){return t.assert(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/.test(e),"Bad attribute value ("+e+")"),e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},t.escapeHtml=function(e){return a.escapeHtml(e)},t.escapeJavaScript=function(e){return a.escapeJavaScript(e)},t.escapeJson=function(e){return a.escapeJson(e)},t.once=function(e){if(e._hoekOnce)return e;let t=!1;const s=function(...s){t||(t=!0,e.apply(null,s))};return s._hoekOnce=!0,s},t.isInteger=Number.isSafeInteger,t.ignore=function(){},t.inherits=o.inherits,t.format=o.format,t.transform=function(e,s,r){t.assert(null==e||"object"==typeof e||Array.isArray(e),"Invalid source object: must be null, undefined, an object, or an array");const n="object"==typeof r&&null!==r&&r.separator||".";if(Array.isArray(e)){const n=[];for(let i=0;i<e.length;++i)n.push(t.transform(e[i],s,r));return n}const i={},o=Object.keys(s);for(let a=0;a<o.length;++a){const c=o[a],l=c.split(n),u=s[c];let h;t.assert("string"==typeof u,'All mappings must be "." delineated strings');let f=i;for(;l.length>1;)f[h=l.shift()]||(f[h]={}),f=f[h];f[h=l.shift()]=t.reach(e,u,r)}return i},t.uniqueFilename=function(e,t){t=t?"."!==t[0]?"."+t:t:"",e=i.resolve(e);const s=[Date.now(),process.pid,n.randomBytes(8).toString("hex")].join("-")+t;return i.join(e,s)},t.stringify=function(...e){try{return JSON.stringify.apply(null,e)}catch(e){return"[Cannot display object: "+e.message+"]"}},t.shallow=function(e){return Object.assign({},e)},t.wait=function(e){return new Promise(t=>setTimeout(t,e))},t.block=function(){return new Promise(t.ignore)}},function(e,t,s){"use strict";const r=s(0),n=s(18),i=s(2),o=s(14);let a=null,c=null;const l={Set:s(19),defaults:{abortEarly:!0,convert:!0,allowUnknown:!1,skipFunctions:!1,stripUnknown:!1,language:{},presence:"optional",strip:!1,noDefaults:!1,escapeHtml:!1}};e.exports=l.Any=class{constructor(){c=c||s(6),this.isJoi=!0,this._type="any",this._settings=null,this._valids=new l.Set,this._invalids=new l.Set,this._tests=[],this._refs=[],this._flags={},this._description=null,this._unit=null,this._notes=[],this._tags=[],this._examples=[],this._meta=[],this._inner={}}_init(){return this}get schemaType(){return this._type}createError(e,t,s,r,n=this._flags){return o.create(e,t,s,r,n)}createOverrideError(e,t,s,r,n,i){return o.create(e,t,s,r,this._flags,n,i)}checkOptions(e){const t=s(45).options.validate(e);if(t.error)throw new Error(t.error.details[0].message)}clone(){const e=Object.create(Object.getPrototypeOf(this));e.isJoi=!0,e._currentJoi=this._currentJoi,e._type=this._type,e._settings=this._settings,e._baseType=this._baseType,e._valids=this._valids.slice(),e._invalids=this._invalids.slice(),e._tests=this._tests.slice(),e._refs=this._refs.slice(),e._flags=r.clone(this._flags),e._description=this._description,e._unit=this._unit,e._notes=this._notes.slice(),e._tags=this._tags.slice(),e._examples=this._examples.slice(),e._meta=this._meta.slice(),e._inner={};const t=Object.keys(this._inner);for(let s=0;s<t.length;++s){const r=t[s];e._inner[r]=this._inner[r]?this._inner[r].slice():null}return e}concat(e){r.assert(e instanceof l.Any,"Invalid schema object"),r.assert("any"===this._type||"any"===e._type||e._type===this._type,"Cannot merge type",this._type,"with another type:",e._type);let t=this.clone();if("any"===this._type&&"any"!==e._type){const s=e.clone(),r=["_settings","_valids","_invalids","_tests","_refs","_flags","_description","_unit","_notes","_tags","_examples","_meta","_inner"];for(let e=0;e<r.length;++e)s[r[e]]=t[r[e]];t=s}t._settings=t._settings?n.concat(t._settings,e._settings):e._settings,t._valids.merge(e._valids,e._invalids),t._invalids.merge(e._invalids,e._valids),t._tests=t._tests.concat(e._tests),t._refs=t._refs.concat(e._refs),r.merge(t._flags,e._flags),t._description=e._description||t._description,t._unit=e._unit||t._unit,t._notes=t._notes.concat(e._notes),t._tags=t._tags.concat(e._tags),t._examples=t._examples.concat(e._examples),t._meta=t._meta.concat(e._meta);const s=Object.keys(e._inner),i="object"===t._type;for(let r=0;r<s.length;++r){const n=s[r],o=e._inner[n];if(o){const e=t._inner[n];if(e)if(i&&"children"===n){const t={};for(let s=0;s<e.length;++s)t[e[s].key]=s;for(let s=0;s<o.length;++s){const r=o[s].key;t[r]>=0?e[t[r]]={key:r,schema:e[t[r]].schema.concat(o[s].schema)}:e.push(o[s])}}else t._inner[n]=t._inner[n].concat(o);else t._inner[n]=o.slice()}}return t}_test(e,t,s,r){const n=this.clone();return n._tests.push({func:s,name:e,arg:t,options:r}),n}options(e){r.assert(!e.context,"Cannot override context"),this.checkOptions(e);const t=this.clone();return t._settings=n.concat(t._settings,e),t}strict(e){const t=this.clone(),s=void 0!==e&&!e;return t._settings=n.concat(t._settings,{convert:s}),t}raw(e){const t=void 0===e||e;if(this._flags.raw===t)return this;const s=this.clone();return s._flags.raw=t,s}error(e){r.assert(e&&(e instanceof Error||"function"==typeof e),"Must provide a valid Error object or a function");const t=this.clone();return t._flags.error=e,t}allow(...e){const t=this.clone();e=r.flatten(e);for(let s=0;s<e.length;++s){const n=e[s];r.assert(void 0!==n,"Cannot call allow/valid/invalid with undefined"),t._invalids.remove(n),t._valids.add(n,t._refs)}return t}valid(...e){const t=this.allow(...e);return t._flags.allowOnly=!0,t}invalid(...e){const t=this.clone();e=r.flatten(e);for(let s=0;s<e.length;++s){const n=e[s];r.assert(void 0!==n,"Cannot call allow/valid/invalid with undefined"),t._valids.remove(n),t._invalids.add(n,t._refs)}return t}required(){if("required"===this._flags.presence)return this;const e=this.clone();return e._flags.presence="required",e}optional(){if("optional"===this._flags.presence)return this;const e=this.clone();return e._flags.presence="optional",e}forbidden(){if("forbidden"===this._flags.presence)return this;const e=this.clone();return e._flags.presence="forbidden",e}strip(){if(this._flags.strip)return this;const e=this.clone();return e._flags.strip=!0,e}applyFunctionToChildren(e,t,s,r){if(1!==(e=[].concat(e)).length||""!==e[0]){r=r?r+".":"";const t=(""===e[0]?e.slice(1):e).map(e=>r+e);throw new Error("unknown key(s) "+t.join(", "))}return this[t].apply(this,s)}default(e,t){"function"!=typeof e||i.isRef(e)||(!e.description&&t&&(e.description=t),this._flags.func||r.assert("string"==typeof e.description&&e.description.length>0,"description must be provided when default value is a function"));const s=this.clone();return s._flags.default=e,i.push(s._refs,e),s}empty(e){const t=this.clone();return void 0===e?delete t._flags.empty:t._flags.empty=c.schema(this._currentJoi,e),t}when(e,t){r.assert(t&&"object"==typeof t,"Invalid options"),r.assert(void 0!==t.then||void 0!==t.otherwise,'options must have at least one of "then" or "otherwise"');const n=t.hasOwnProperty("then")?this.concat(c.schema(this._currentJoi,t.then)):void 0,i=t.hasOwnProperty("otherwise")?this.concat(c.schema(this._currentJoi,t.otherwise)):void 0;a=a||s(20);const o={then:n,otherwise:i};Object.prototype.hasOwnProperty.call(t,"is")&&(o.is=t.is);const l=a.when(e,o);return l._flags.presence="ignore",l._baseType=this,l}description(e){r.assert(e&&"string"==typeof e,"Description must be a non-empty string");const t=this.clone();return t._description=e,t}notes(e){r.assert(e&&("string"==typeof e||Array.isArray(e)),"Notes must be a non-empty string or array");const t=this.clone();return t._notes=t._notes.concat(e),t}tags(e){r.assert(e&&("string"==typeof e||Array.isArray(e)),"Tags must be a non-empty string or array");const t=this.clone();return t._tags=t._tags.concat(e),t}meta(e){r.assert(void 0!==e,"Meta cannot be undefined");const t=this.clone();return t._meta=t._meta.concat(e),t}example(...e){r.assert(1===e.length,"Missing example");const t=e[0],s=this.clone();return s._examples.push(t),s}unit(e){r.assert(e&&"string"==typeof e,"Unit name must be a non-empty string");const t=this.clone();return t._unit=e,t}_prepareEmptyValue(e){return"string"==typeof e&&this._flags.trim?e.trim():e}_validate(e,t,s,a){const c=e;t=t||{key:"",path:[],parent:null,reference:a},this._settings&&(s=n.concat(s,this._settings));let u=[];const h=()=>{let n;if(void 0!==e)n=this._flags.raw?c:e;else if(s.noDefaults)n=e;else if(i.isRef(this._flags.default))n=this._flags.default(t.parent,s);else if("function"!=typeof this._flags.default||this._flags.func&&!this._flags.default.description)n=r.clone(this._flags.default);else{let e;null!==t.parent&&this._flags.default.length>0&&(e=[r.clone(t.parent),s]);const i=l._try(this._flags.default,e);n=i.value,i.error&&u.push(this.createError("any.default",{error:i.error},t,s))}if(u.length&&"function"==typeof this._flags.error){const e=this._flags.error.call(this,u);u="string"==typeof e?[this.createOverrideError("override",{reason:u},t,s,e)]:[].concat(e).map(e=>e instanceof Error?e:this.createOverrideError(e.type||"override",e.context,t,s,e.message,e.template))}return{value:this._flags.strip?void 0:n,finalValue:n,errors:u.length?u:null}};if(this._coerce){const r=this._coerce.call(this,e,t,s);if(r.errors)return e=r.value,u=u.concat(r.errors),h();e=r.value}this._flags.empty&&!this._flags.empty._validate(this._prepareEmptyValue(e),null,l.defaults).errors&&(e=void 0);const f=this._flags.presence||s.presence;if("optional"===f){if(void 0===e){if(!(this._flags.hasOwnProperty("default")&&void 0===this._flags.default)||"object"!==this._type)return h();e={}}}else{if("required"===f&&void 0===e)return u.push(this.createError("any.required",null,t,s)),h();if("forbidden"===f)return void 0===e?h():(u.push(this.createError("any.unknown",null,t,s)),h())}if(this._valids.has(e,t,s,this._flags.insensitive))return h();if(this._invalids.has(e,t,s,this._flags.insensitive)&&(u.push(this.createError(""===e?"any.empty":"any.invalid",{value:e,invalids:this._invalids.values({stripUndefined:!0})},t,s)),s.abortEarly||void 0===e))return h();if(this._base){const r=this._base.call(this,e,t,s);if(r.errors)return e=r.value,u=u.concat(r.errors),h();if(r.value!==e){if(e=r.value,this._valids.has(e,t,s,this._flags.insensitive))return h();if(this._invalids.has(e,t,s,this._flags.insensitive)&&(u.push(this.createError(""===e?"any.empty":"any.invalid",{value:e,invalids:this._invalids.values({stripUndefined:!0})},t,s)),s.abortEarly))return h()}}if(this._flags.allowOnly&&(u.push(this.createError("any.allowOnly",{value:e,valids:this._valids.values({stripUndefined:!0})},t,s)),s.abortEarly))return h();for(let r=0;r<this._tests.length;++r){const n=this._tests[r].func.call(this,e,t,s);if(n instanceof o.Err){if(u.push(n),s.abortEarly)return h()}else e=n}return h()}_validateWithOptions(e,t,s){t&&this.checkOptions(t);const r=n.concat(l.defaults,t),i=this._validate(e,null,r),a=o.process(i.errors,e);return s?s(a,i.value):{error:a,value:i.value,then:(e,t)=>a?Promise.reject(a).catch(t):Promise.resolve(i.value).then(e),catch:e=>a?Promise.reject(a).catch(e):Promise.resolve(i.value)}}validate(e,t,s){return"function"==typeof t?this._validateWithOptions(e,null,t):this._validateWithOptions(e,t,s)}describe(){const e={type:this._type},t=Object.keys(this._flags);if(t.length)if(["empty","default","lazy","label"].some(e=>this._flags.hasOwnProperty(e))){e.flags={};for(let s=0;s<t.length;++s){const r=t[s];"empty"===r?e.flags[r]=this._flags[r].describe():"default"===r?i.isRef(this._flags[r])?e.flags[r]=this._flags[r].toString():"function"==typeof this._flags[r]?e.flags[r]={description:this._flags[r].description,function:this._flags[r]}:e.flags[r]=this._flags[r]:"lazy"===r||"label"===r||(e.flags[r]=this._flags[r])}}else e.flags=this._flags;this._settings&&(e.options=r.clone(this._settings)),this._baseType&&(e.base=this._baseType.describe()),this._description&&(e.description=this._description),this._notes.length&&(e.notes=this._notes),this._tags.length&&(e.tags=this._tags),this._meta.length&&(e.meta=this._meta),this._examples.length&&(e.examples=this._examples),this._unit&&(e.unit=this._unit);const s=this._valids.values();s.length&&(e.valids=s.map(e=>i.isRef(e)?e.toString():e));const n=this._invalids.values();n.length&&(e.invalids=n.map(e=>i.isRef(e)?e.toString():e)),e.rules=[];for(let t=0;t<this._tests.length;++t){const s=this._tests[t],r={name:s.name};void 0!==s.arg&&(r.arg=i.isRef(s.arg)?s.arg.toString():s.arg);const n=s.options;if(n){if(n.hasRef){r.arg={};const e=Object.keys(s.arg);for(let t=0;t<e.length;++t){const n=e[t],o=s.arg[n];r.arg[n]=i.isRef(o)?o.toString():o}}"string"==typeof n.description?r.description=n.description:"function"==typeof n.description&&(r.description=n.description(r.arg))}e.rules.push(r)}e.rules.length||delete e.rules;const o=this._getLabel();return o&&(e.label=o),e}label(e){r.assert(e&&"string"==typeof e,"Label name must be a non-empty string");const t=this.clone();return t._flags.label=e,t}_getLabel(e){return this._flags.label||e}},l.Any.prototype.isImmutable=!0,l.Any.prototype.only=l.Any.prototype.equal=l.Any.prototype.valid,l.Any.prototype.disallow=l.Any.prototype.not=l.Any.prototype.invalid,l.Any.prototype.exist=l.Any.prototype.required,l._try=function(e,t){let s,r;try{r=e.apply(null,t)}catch(e){s=e}return{value:r,error:s}}},function(e,t,s){"use strict";const r=s(0);t.create=function(e,t){r.assert("string"==typeof e,"Invalid reference key:",e);const s=r.clone(t),n=function(e,t){return r.reach(n.isContext?t.context:e,n.key,s)};return n.isContext=e[0]===(s&&s.contextPrefix||"$"),n.key=n.isContext?e.slice(1):e,n.path=n.key.split(s&&s.separator||"."),n.depth=n.path.length,n.root=n.path[0],n.isJoi=!0,n.toString=function(){return(n.isContext?"context:":"ref:")+n.key},n},t.isRef=function(e){return"function"==typeof e&&e.isJoi},t.push=function(e,s){t.isRef(s)&&!s.isContext&&e.push(s.root)}},function(e,t){e.exports=require("crypto")},function(e,t,s){"use strict";const r=s(10),n=s(3),i=s(16),o=s(38),a=s(39),c={};t.deepEqual=o,t.clone=function(e,s={},r=null){if("object"!=typeof e||null===e)return e;const n=r||new Map,i=n.get(e);if(i)return i;let o,a=!1;const l=Array.isArray(e);if(l)o=[],a=!0;else if(Buffer.isBuffer(e))o=Buffer.from(e);else if(e instanceof Date)o=new Date(e.getTime());else if(e instanceof RegExp)o=new RegExp(e);else{const t=Object.getPrototypeOf(e);t&&t.isImmutable?o=e:(o=Object.create(t),a=!0)}if(n.set(e,o),a){const r=c.keys(e,s);for(let i=0;i<r.length;++i){const a=r[i];if(l&&"length"===a)continue;const c=Object.getOwnPropertyDescriptor(e,a);c&&(c.get||c.set)?Object.defineProperty(o,a,c):Object.defineProperty(o,a,{enumerable:!c||c.enumerable,writable:!0,configurable:!0,value:t.clone(e[a],s,n)})}l&&(o.length=e.length)}return o},c.keys=function(e,t={}){return t.symbols?Reflect.ownKeys(e):Object.getOwnPropertyNames(e)},t.merge=function(e,s,r,n){if(t.assert(e&&"object"==typeof e,"Invalid target value: must be an object"),t.assert(null==s||"object"==typeof s,"Invalid source value: must be null, undefined, or an object"),!s)return e;if(Array.isArray(s)){t.assert(Array.isArray(e),"Cannot merge array onto an object"),!1===n&&(e.length=0);for(let r=0;r<s.length;++r)e.push(t.clone(s[r]));return e}const i=c.keys(s);for(let o=0;o<i.length;++o){const a=i[o];if("__proto__"===a||!Object.prototype.propertyIsEnumerable.call(s,a))continue;const c=s[a];c&&"object"==typeof c?!e[a]||"object"!=typeof e[a]||Array.isArray(e[a])!==Array.isArray(c)||c instanceof Date||Buffer.isBuffer(c)||c instanceof RegExp?e[a]=t.clone(c):t.merge(e[a],c,r,n):null!=c?e[a]=c:!1!==r&&(e[a]=c)}return e},t.applyToDefaults=function(e,s,r){if(t.assert(e&&"object"==typeof e,"Invalid defaults value: must be an object"),t.assert(!s||!0===s||"object"==typeof s,"Invalid options value: must be true, falsy or an object"),!s)return null;const n=t.clone(e);return!0===s?n:t.merge(n,s,!0===r,!1)},t.cloneWithShallow=function(e,s,r){if(!e||"object"!=typeof e)return e;const n=c.store(e,s),i=t.clone(e,r);return c.restore(i,e,n),i},c.store=function(e,s){const r=new Map;for(let n=0;n<s.length;++n){const i=s[n],o=t.reach(e,i);"object"!=typeof o&&"function"!=typeof o||(r.set(i,o),c.reachSet(e,i,void 0))}return r},c.restore=function(e,t,s){for(const[r,n]of s)c.reachSet(e,r,n),c.reachSet(t,r,n)},c.reachSet=function(e,t,s){const r=Array.isArray(t)?t:t.split(".");let n=e;for(let e=0;e<r.length;++e){const t=r[e];e+1===r.length&&(n[t]=s),n=n[t]}},t.applyToDefaultsWithShallow=function(e,s,r){if(t.assert(e&&"object"==typeof e,"Invalid defaults value: must be an object"),t.assert(!s||!0===s||"object"==typeof s,"Invalid options value: must be true, falsy or an object"),t.assert(r&&Array.isArray(r),"Invalid keys"),!s)return null;const n=t.cloneWithShallow(e,r);if(!0===s)return n;const i=c.store(s,r);return t.merge(n,s,!1,!1),c.restore(n,s,i),n},t.intersect=function(e,t,s){if(!e||!t)return s?null:[];const r=[],n=Array.isArray(e)?new Set(e):e,i=new Set;for(const e of t)if(c.has(n,e)&&!i.has(e)){if(s)return e;r.push(e),i.add(e)}return s?null:r},c.has=function(e,t){return"function"==typeof e.has?e.has(t):void 0!==e[t]},t.contain=function(e,s,r={}){let n,i,o=null;if("object"!=typeof e||"object"!=typeof s||Array.isArray(e)||Array.isArray(s))s=[].concat(s);else{o=s;const e=Object.getOwnPropertySymbols(s).filter(Object.prototype.propertyIsEnumerable.bind(s));s=[...Object.keys(s),...e]}if(t.assert("string"==typeof e||"object"==typeof e,"Reference must be string or an object"),t.assert(s.length,"Values array cannot be empty"),r.deep){n=t.deepEqual;const e=r.hasOwnProperty("only"),s=r.hasOwnProperty("part");i={prototype:e?r.only:!!s&&!r.part,part:e?!r.only:!!s&&r.part}}else n=((e,t)=>e===t);let a=!1;const l=new Array(s.length);for(let e=0;e<l.length;++e)l[e]=0;if("string"==typeof e){let r="(";for(let e=0;e<s.length;++e){const n=s[e];t.assert("string"==typeof n,"Cannot compare string reference to non-string value"),r+=(e?"|":"")+t.escapeRegex(n)}const n=new RegExp(r+")","g");a=!!e.replace(n,(e,t)=>{const r=s.indexOf(t);return++l[r],""})}else if(Array.isArray(e)){const t=!(!r.only||!r.once);if(t&&e.length!==s.length)return!1;for(let r=0;r<e.length;++r){let o=!1;for(let a=0;a<s.length&&!1===o;++a)t&&0!==l[a]||(o=n(s[a],e[r],i)&&a);!1!==o?++l[o]:a=!0}}else{const t=c.keys(e,r);for(let r=0;r<t.length;++r){const c=t[r],u=s.indexOf(c);if(-1!==u){if(o&&!n(o[c],e[c],i))return!1;++l[u]}else a=!0}}if(r.only&&(a||!r.once))return!a;let u=!1;for(let e=0;e<l.length;++e)if(u=u||!!l[e],r.once&&l[e]>1||!r.part&&!l[e])return!1;return u},t.flatten=function(e,s){const r=s||[];for(let s=0;s<e.length;++s)Array.isArray(e[s])?t.flatten(e[s],r):r.push(e[s]);return r},t.reach=function(e,s,r){if(!1===s||null==s)return e;"string"==typeof(r=r||{})&&(r={separator:r});const n=Array.isArray(s);t.assert(!n||!r.separator,"Separator option no valid for array-based chain");const i=n?s:s.split(r.separator||".");let o=e;for(let e=0;e<i.length;++e){let n=i[e];if(Array.isArray(o)){const e=Number(n);Number.isInteger(e)&&e<0&&(n=o.length+e)}if(!o||"object"!=typeof o&&"function"!=typeof o||!(n in o)||"object"!=typeof o&&!1===r.functions){t.assert(!r.strict||e+1===i.length,"Missing segment",n,"in reach path ",s),t.assert("object"==typeof o||!0===r.functions||"function"!=typeof o,"Invalid segment",n,"in reach path ",s),o=r.default;break}o=o[n]}return o},t.reachTemplate=function(e,s,r){return s.replace(/{([^}]+)}/g,(s,n)=>{const i=t.reach(e,n,r);return null==i?"":i})},t.assert=function(e,...s){if(e)return;if(1===s.length&&s[0]instanceof Error)throw s[0];const n=s.filter(e=>""!==e).map(e=>"string"==typeof e?e:e instanceof Error?e.message:t.stringify(e));throw new r.AssertionError({message:n.join(" ")||"Unknown error",actual:!1,expected:!0,operator:"==",stackStartFunction:t.assert})},t.Bench=function(){this.ts=0,this.reset()},t.Bench.prototype.reset=function(){this.ts=t.Bench.now()},t.Bench.prototype.elapsed=function(){return t.Bench.now()-this.ts},t.Bench.now=function(){const e=process.hrtime();return 1e3*e[0]+e[1]/1e6},t.escapeRegex=function(e){return e.replace(/[\^\$\.\*\+\-\?\=\!\:\|\\\/\(\)\[\]\{\}\,]/g,"\\$&")},t.escapeHeaderAttribute=function(e){return t.assert(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~\"\\]*$/.test(e),"Bad attribute value ("+e+")"),e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},t.escapeHtml=function(e){return a.escapeHtml(e)},t.escapeJson=function(e){return a.escapeJson(e)},t.once=function(e){if(e._hoekOnce)return e;let t=!1;const s=function(...s){t||(t=!0,e(...s))};return s._hoekOnce=!0,s},t.ignore=function(){},t.uniqueFilename=function(e,t){t=t?"."!==t[0]?"."+t:t:"",e=i.resolve(e);const s=[Date.now(),process.pid,n.randomBytes(8).toString("hex")].join("-")+t;return i.join(e,s)},t.stringify=function(...e){try{return JSON.stringify.apply(null,e)}catch(e){return"[Cannot display object: "+e.message+"]"}},t.wait=function(e){return new Promise(t=>setTimeout(t,e))},t.block=function(){return new Promise(t.ignore)}},function(e,t,s){"use strict";const r=s(4),n={codes:new Map([[100,"Continue"],[101,"Switching Protocols"],[102,"Processing"],[200,"OK"],[201,"Created"],[202,"Accepted"],[203,"Non-Authoritative Information"],[204,"No Content"],[205,"Reset Content"],[206,"Partial Content"],[207,"Multi-Status"],[300,"Multiple Choices"],[301,"Moved Permanently"],[302,"Moved Temporarily"],[303,"See Other"],[304,"Not Modified"],[305,"Use Proxy"],[307,"Temporary Redirect"],[400,"Bad Request"],[401,"Unauthorized"],[402,"Payment Required"],[403,"Forbidden"],[404,"Not Found"],[405,"Method Not Allowed"],[406,"Not Acceptable"],[407,"Proxy Authentication Required"],[408,"Request Time-out"],[409,"Conflict"],[410,"Gone"],[411,"Length Required"],[412,"Precondition Failed"],[413,"Request Entity Too Large"],[414,"Request-URI Too Large"],[415,"Unsupported Media Type"],[416,"Requested Range Not Satisfiable"],[417,"Expectation Failed"],[418,"I'm a teapot"],[422,"Unprocessable Entity"],[423,"Locked"],[424,"Failed Dependency"],[425,"Unordered Collection"],[426,"Upgrade Required"],[428,"Precondition Required"],[429,"Too Many Requests"],[431,"Request Header Fields Too Large"],[451,"Unavailable For Legal Reasons"],[500,"Internal Server Error"],[501,"Not Implemented"],[502,"Bad Gateway"],[503,"Service Unavailable"],[504,"Gateway Time-out"],[505,"HTTP Version Not Supported"],[506,"Variant Also Negotiates"],[507,"Insufficient Storage"],[509,"Bandwidth Limit Exceeded"],[510,"Not Extended"],[511,"Network Authentication Required"]])};e.exports=n.Boom=class extends Error{static[Symbol.hasInstance](e){return n.Boom.isBoom(e)}constructor(e,t={}){if(e instanceof Error)return n.Boom.boomify(r.clone(e),t);const{statusCode:s=500,data:i=null,ctor:o=n.Boom}=t,a=new Error(e||void 0);return Error.captureStackTrace(a,o),a.data=i,n.initialize(a,s),a.typeof=o,t.decorate&&Object.assign(a,t.decorate),a}static isBoom(e){return e instanceof Error&&!!e.isBoom}static boomify(e,t){return r.assert(e instanceof Error,"Cannot wrap non-Error object"),void 0!==(t=t||{}).data&&(e.data=t.data),t.decorate&&Object.assign(e,t.decorate),e.isBoom?!1===t.override||!t.statusCode&&!t.message?e:n.initialize(e,t.statusCode||e.output.statusCode,t.message):n.initialize(e,t.statusCode||500,t.message)}static badRequest(e,t){return new n.Boom(e,{statusCode:400,data:t,ctor:n.Boom.badRequest})}static unauthorized(e,t,s){const i=new n.Boom(e,{statusCode:401,ctor:n.Boom.unauthorized});if(!t)return i;let o="";if("string"==typeof t){if(o=t,(s||e)&&(i.output.payload.attributes={}),s)if("string"==typeof s)o=o+" "+r.escapeHeaderAttribute(s),i.output.payload.attributes=s;else{const e=Object.keys(s);for(let t=0;t<e.length;++t){const n=e[t];t&&(o+=",");let a=s[n];null==a&&(a=""),o=o+" "+n+'="'+r.escapeHeaderAttribute(a.toString())+'"',i.output.payload.attributes[n]=a}}e?(s&&(o+=","),o=o+' error="'+r.escapeHeaderAttribute(e)+'"',i.output.payload.attributes.error=e):i.isMissing=!0}else{const e=t;for(let t=0;t<e.length;++t)t&&(o+=", "),o+=e[t]}return i.output.headers["WWW-Authenticate"]=o,i}static paymentRequired(e,t){return new n.Boom(e,{statusCode:402,data:t,ctor:n.Boom.paymentRequired})}static forbidden(e,t){return new n.Boom(e,{statusCode:403,data:t,ctor:n.Boom.forbidden})}static notFound(e,t){return new n.Boom(e,{statusCode:404,data:t,ctor:n.Boom.notFound})}static methodNotAllowed(e,t,s){const r=new n.Boom(e,{statusCode:405,data:t,ctor:n.Boom.methodNotAllowed});return"string"==typeof s&&(s=[s]),Array.isArray(s)&&(r.output.headers.Allow=s.join(", ")),r}static notAcceptable(e,t){return new n.Boom(e,{statusCode:406,data:t,ctor:n.Boom.notAcceptable})}static proxyAuthRequired(e,t){return new n.Boom(e,{statusCode:407,data:t,ctor:n.Boom.proxyAuthRequired})}static clientTimeout(e,t){return new n.Boom(e,{statusCode:408,data:t,ctor:n.Boom.clientTimeout})}static conflict(e,t){return new n.Boom(e,{statusCode:409,data:t,ctor:n.Boom.conflict})}static resourceGone(e,t){return new n.Boom(e,{statusCode:410,data:t,ctor:n.Boom.resourceGone})}static lengthRequired(e,t){return new n.Boom(e,{statusCode:411,data:t,ctor:n.Boom.lengthRequired})}static preconditionFailed(e,t){return new n.Boom(e,{statusCode:412,data:t,ctor:n.Boom.preconditionFailed})}static entityTooLarge(e,t){return new n.Boom(e,{statusCode:413,data:t,ctor:n.Boom.entityTooLarge})}static uriTooLong(e,t){return new n.Boom(e,{statusCode:414,data:t,ctor:n.Boom.uriTooLong})}static unsupportedMediaType(e,t){return new n.Boom(e,{statusCode:415,data:t,ctor:n.Boom.unsupportedMediaType})}static rangeNotSatisfiable(e,t){return new n.Boom(e,{statusCode:416,data:t,ctor:n.Boom.rangeNotSatisfiable})}static expectationFailed(e,t){return new n.Boom(e,{statusCode:417,data:t,ctor:n.Boom.expectationFailed})}static teapot(e,t){return new n.Boom(e,{statusCode:418,data:t,ctor:n.Boom.teapot})}static badData(e,t){return new n.Boom(e,{statusCode:422,data:t,ctor:n.Boom.badData})}static locked(e,t){return new n.Boom(e,{statusCode:423,data:t,ctor:n.Boom.locked})}static failedDependency(e,t){return new n.Boom(e,{statusCode:424,data:t,ctor:n.Boom.failedDependency})}static preconditionRequired(e,t){return new n.Boom(e,{statusCode:428,data:t,ctor:n.Boom.preconditionRequired})}static tooManyRequests(e,t){return new n.Boom(e,{statusCode:429,data:t,ctor:n.Boom.tooManyRequests})}static illegal(e,t){return new n.Boom(e,{statusCode:451,data:t,ctor:n.Boom.illegal})}static internal(e,t,s=500){return n.serverError(e,t,s,n.Boom.internal)}static notImplemented(e,t){return n.serverError(e,t,501,n.Boom.notImplemented)}static badGateway(e,t){return n.serverError(e,t,502,n.Boom.badGateway)}static serverUnavailable(e,t){return n.serverError(e,t,503,n.Boom.serverUnavailable)}static gatewayTimeout(e,t){return n.serverError(e,t,504,n.Boom.gatewayTimeout)}static badImplementation(e,t){const s=n.serverError(e,t,500,n.Boom.badImplementation);return s.isDeveloperError=!0,s}},n.initialize=function(e,t,s){const i=parseInt(t,10);return r.assert(!isNaN(i)&&i>=400,"First argument must be a number (400+):",t),e.isBoom=!0,e.isServer=i>=500,e.hasOwnProperty("data")||(e.data=null),e.output={statusCode:i,payload:{},headers:{}},e.reformat=n.reformat,s||e.message||(e.reformat(),s=e.output.payload.error),s&&(e.message=s+(e.message?": "+e.message:""),e.output.payload.message=e.message),e.reformat(),e},n.reformat=function(e=!1){this.output.payload.statusCode=this.output.statusCode,this.output.payload.error=n.codes.get(this.output.statusCode)||"Unknown",500===this.output.statusCode&&!0!==e?this.output.payload.message="An internal server error occurred":this.message&&(this.output.payload.message=this.message)},n.serverError=function(e,t,s,r){return t instanceof Error&&!t.isBoom?n.Boom.boomify(t,{statusCode:s,message:e}):new n.Boom(e,{statusCode:s,data:t,ctor:r})}},function(e,t,s){"use strict";const r=s(0),n=s(2);t.schema=function(e,t){return null!=t&&"object"==typeof t?t.isJoi?t:Array.isArray(t)?e.alternatives().try(t):t instanceof RegExp?e.string().regex(t):t instanceof Date?e.date().valid(t):e.object().keys(t):"string"==typeof t?e.string().valid(t):"number"==typeof t?e.number().valid(t):"boolean"==typeof t?e.boolean().valid(t):n.isRef(t)?e.valid(t):(r.assert(null===t,"Invalid schema content:",t),e.valid(null))},t.ref=function(e){return n.isRef(e)?e:n.create(e)}},function(e,t,s){"use strict";e.exports={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),EMPTY_BUFFER:Buffer.alloc(0),NOOP:()=>{}}},function(e,t,s){"use strict";const r=s(62),n=s(63),i=s(15),o=s(7),a=Buffer.from([0,0,255,255]),c=Buffer.from([0]),l=Symbol("permessage-deflate"),u=Symbol("write-in-progress"),h=Symbol("pending-close"),f=Symbol("total-length"),p=Symbol("callback"),d=Symbol("buffers"),m=Symbol("error");let g;function y(e){this[d].push(e),this[f]+=e.length}function _(e){this[f]+=e.length,this[l]._maxPayload<1||this[f]<=this[l]._maxPayload?this[d].push(e):(this[m]=new RangeError("Max payload size exceeded"),this[m][o.kStatusCode]=1009,this.removeListener("data",_),this.reset())}function b(e){this[l]._inflate=null,e[o.kStatusCode]=1007,this[p](e)}e.exports=class{constructor(e,t,s){if(this._maxPayload=0|s,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!g){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;g=new r({concurrency:e})}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){this._inflate&&(this._inflate[u]?this._inflate[h]=!0:(this._inflate.close(),this._inflate=null)),this._deflate&&(this._deflate[u]?this._deflate[h]=!0:(this._deflate.close(),this._deflate=null))}acceptAsServer(e){const t=this._options,s=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(s.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?s.client_max_window_bits=t.clientMaxWindowBits:!0!==s.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete s.client_max_window_bits,s}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{var s=e[t];if(s.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(s=s[0],"client_max_window_bits"===t){if(!0!==s){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}else if("server_max_window_bits"===t){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==s)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}e[t]=s})}),e}decompress(e,t,s){g.push(r=>{this._decompress(e,t,(e,t)=>{r(),s(e,t)})})}compress(e,t,s){g.push(r=>{this._compress(e,t,(e,t)=>{r(),s(e,t)})})}_decompress(e,t,s){const r=this._isServer?"client":"server";if(!this._inflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=n.createInflateRaw(Object.assign({},this._options.zlibInflateOptions,{windowBits:t})),this._inflate[l]=this,this._inflate[f]=0,this._inflate[d]=[],this._inflate.on("error",b),this._inflate.on("data",_)}this._inflate[p]=s,this._inflate[u]=!0,this._inflate.write(e),t&&this._inflate.write(a),this._inflate.flush(()=>{const e=this._inflate[m];if(e)return this._inflate.close(),this._inflate=null,void s(e);const n=i.concat(this._inflate[d],this._inflate[f]);t&&this.params[`${r}_no_context_takeover`]||this._inflate[h]?(this._inflate.close(),this._inflate=null):(this._inflate[u]=!1,this._inflate[f]=0,this._inflate[d]=[]),s(null,n)})}_compress(e,t,s){if(!e||0===e.length)return void process.nextTick(s,null,c);const r=this._isServer?"server":"client";if(!this._deflate){const e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=n.createDeflateRaw(Object.assign({memLevel:this._options.memLevel,level:this._options.level},this._options.zlibDeflateOptions,{windowBits:t})),this._deflate[f]=0,this._deflate[d]=[],this._deflate.on("data",y)}this._deflate[u]=!0,this._deflate.write(e),this._deflate.flush(n.Z_SYNC_FLUSH,()=>{var e=i.concat(this._deflate[d],this._deflate[f]);t&&(e=e.slice(0,e.length-4)),t&&this.params[`${r}_no_context_takeover`]||this._deflate[h]?(this._deflate.close(),this._deflate=null):(this._deflate[u]=!1,this._deflate[f]=0,this._deflate[d]=[]),s(null,e)})}}},function(e,t,s){"use strict";const r=s(3),n=s(5),i={};t.randomString=function(e){return t.randomBits(6*(e+1)).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"").slice(0,e)},t.randomDigits=function(e){const t=[];let s=i.random(2*e),r=0;for(;t.length<e;)r>=s.length&&(s=i.random(2*e),r=0),s[r]<250&&t.push(s[r]%10),++r;return t.join("")},t.randomBits=function(e){if(!e||e<0)throw n.internal("Invalid random bits count");const t=Math.ceil(e/8);return i.random(t)},t.fixedTimeComparison=function(e,t){try{return r.timingSafeEqual(Buffer.from(e),Buffer.from(t))}catch(e){return!1}},i.random=function(e){try{return r.randomBytes(e)}catch(e){throw n.internal("Failed generating random bits: "+e.message)}}},function(e,t){e.exports=require("assert")},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("stream")},function(e,t,s){"use strict";const r=s(0),n=s(1),i=s(6),o=s(14),a=s(46),c=s(2),l=s(18),u={alternatives:s(20),array:s(47),boolean:s(48),binary:s(49),date:s(21),func:s(50),number:s(52),object:s(22),string:s(53),symbol:s(58),callWithDefaults:function(e,t){return r.assert(this,"Must be invoked on a Joi instance."),this._defaults&&(e=this._defaults(e)),e._currentJoi=this,e._init(...t)},root:function(){const e=new n,t=e.clone();return n.prototype._currentJoi=t,t._currentJoi=t,t.any=function(...t){return r.assert(0===t.length,"Joi.any() does not allow arguments."),u.callWithDefaults.call(this,e,t)},t.alternatives=t.alt=function(...e){return u.callWithDefaults.call(this,u.alternatives,e)},t.array=function(...e){return r.assert(0===e.length,"Joi.array() does not allow arguments."),u.callWithDefaults.call(this,u.array,e)},t.boolean=t.bool=function(...e){return r.assert(0===e.length,"Joi.boolean() does not allow arguments."),u.callWithDefaults.call(this,u.boolean,e)},t.binary=function(...e){return r.assert(0===e.length,"Joi.binary() does not allow arguments."),u.callWithDefaults.call(this,u.binary,e)},t.date=function(...e){return r.assert(0===e.length,"Joi.date() does not allow arguments."),u.callWithDefaults.call(this,u.date,e)},t.func=function(...e){return r.assert(0===e.length,"Joi.func() does not allow arguments."),u.callWithDefaults.call(this,u.func,e)},t.number=function(...e){return r.assert(0===e.length,"Joi.number() does not allow arguments."),u.callWithDefaults.call(this,u.number,e)},t.object=function(...e){return u.callWithDefaults.call(this,u.object,e)},t.string=function(...e){return r.assert(0===e.length,"Joi.string() does not allow arguments."),u.callWithDefaults.call(this,u.string,e)},t.symbol=function(...e){return r.assert(0===e.length,"Joi.symbol() does not allow arguments."),u.callWithDefaults.call(this,u.symbol,e)},t.ref=function(...e){return c.create(...e)},t.isRef=function(e){return c.isRef(e)},t.validate=function(s,...r){const n=r[r.length-1],i="function"==typeof n?n:null,o=r.length-(i?1:0);if(0===o)return e.validate(s,i);const a=2===o?r[1]:void 0;return t.compile(r[0])._validateWithOptions(s,a,i)},t.describe=function(...s){return(s.length?t.compile(s[0]):e).describe()},t.compile=function(e){try{return i.schema(this,e)}catch(e){throw e.hasOwnProperty("path")&&(e.message=e.message+"("+e.path+")"),e}},t.assert=function(e,s,r){t.attempt(e,s,r)},t.attempt=function(e,s,r){const n=t.validate(e,s),i=n.error;if(i){if(!r)throw"function"==typeof i.annotate&&(i.message=i.annotate()),i;if(!(r instanceof Error))throw"function"==typeof i.annotate&&(i.message=`${r} ${i.annotate()}`),i;throw r}return n.value},t.reach=function(e,t){r.assert(e&&e instanceof n,"you must provide a joi schema"),r.assert(Array.isArray(t)||"string"==typeof t,"path must be a string or an array of strings");const s=(e,t)=>{if(!t.length)return e;const r=e._inner.children;if(!r)return;const n=t.shift();for(let e=0;e<r.length;++e){const i=r[e];if(i.key===n)return s(i.schema,t)}},i="string"==typeof t?t?t.split("."):[]:t.slice();return s(e,i)},t.lazy=function(e){return a.set(e)},t.defaults=function(e){r.assert("function"==typeof e,"Defaults must be a function");let t=Object.create(this.any());return t=e(t),r.assert(t&&t instanceof this.constructor,"defaults() must return a schema"),Object.assign(t,this,t.clone()),t._defaults=(t=>(this._defaults&&(t=this._defaults(t),r.assert(t instanceof this.constructor,"defaults() must return a schema")),t=e(t),r.assert(t instanceof this.constructor,"defaults() must return a schema"),t)),t},t.extend=function(...e){const s=r.flatten(e);r.assert(s.length>0,"You need to provide at least one extension"),this.assert(s,t.extensionsSchema);const a=Object.create(this.any());Object.assign(a,this);for(let e=0;e<s.length;++e){let h=s[e];"function"==typeof h&&(h=h(a)),this.assert(h,t.extensionSchema);const f=(h.base||this.any()).clone(),p=f.constructor,d=class extends p{constructor(){super(),h.base&&Object.assign(this,f),this._type=h.name,h.language&&(this._settings=l.concat(this._settings,{language:{[h.name]:h.language}}))}};if(h.coerce&&(d.prototype._coerce=function(e,t,s){if(p.prototype._coerce){const r=p.prototype._coerce.call(this,e,t,s);if(r.errors)return r;e=r.value}const r=h.coerce.call(this,e,t,s);return r instanceof o.Err?{value:e,errors:r}:{value:r}}),h.pre&&(d.prototype._base=function(e,t,s){if(p.prototype._base){const r=p.prototype._base.call(this,e,t,s);if(r.errors)return r;e=r.value}const r=h.pre.call(this,e,t,s);return r instanceof o.Err?{value:e,errors:r}:{value:r}}),h.rules)for(let e=0;e<h.rules.length;++e){const t=h.rules[e],s=t.params?t.params instanceof n?t.params._inner.children.map(e=>e.key):Object.keys(t.params):[],o=t.params?i.schema(this,t.params):null;d.prototype[t.name]=function(...e){if(e.length>s.length)throw new Error("Unexpected number of arguments");let i,l=!1,u={};for(let t=0;t<s.length;++t)u[s[t]]=e[t],!l&&c.isRef(e[t])&&(l=!0);if(o&&(u=a.attempt(u,o)),t.validate){const e=function(e,s,r){return t.validate.call(this,u,e,s,r)};i=this._test(t.name,u,e,{description:t.description,hasRef:l})}else i=this.clone();if(t.setup){const e=t.setup.call(i,u);void 0!==e&&(r.assert(e instanceof n,`Setup of extension Joi.${this._type}().${t.name}() must return undefined or a Joi object`),i=e)}return i}}h.describe&&(d.prototype.describe=function(){const e=p.prototype.describe.call(this);return h.describe.call(this,e)});const m=new d;a[h.name]=function(...e){return u.callWithDefaults.call(this,m,e)}}return a},t.extensionSchema=u.object.keys({base:u.object.type(n,"Joi object"),name:u.string.required(),coerce:u.func.arity(3),pre:u.func.arity(3),language:u.object,describe:u.func.arity(1),rules:u.array.items(u.object.keys({name:u.string.required(),setup:u.func.arity(1),validate:u.func.arity(4),params:[u.object.pattern(/.*/,u.object.type(n,"Joi object")),u.object.type(u.object.constructor,"Joi object")],description:[u.string,u.func.arity(1)]}).or("setup","validate"))}).strict(),t.extensionsSchema=u.array.items([u.object,u.func.arity(1)]).strict(),t.version=s(59).version,t}};e.exports=u.root()},function(e,t,s){"use strict";const r=s(0),n=s(44),i={annotations:Symbol("joi-annotations"),stringify:function(e,s){const r=typeof e;if(null===e)return"null";if("string"===r)return e;if(e instanceof t.Err||"function"===r||"symbol"===r)return e.toString();if("object"===r){if(Array.isArray(e)){let t="";for(let r=0;r<e.length;++r)t=t+(t.length?", ":"")+i.stringify(e[r],s);return s?"["+t+"]":t}return e.toString()}return JSON.stringify(e)}};t.Err=class{constructor(e,t,s,r,i,o,a){this.isJoi=!0,this.type=e,this.context=t||{},this.context.key=s.path[s.path.length-1],this.context.label=s.key,this.path=s.path,this.options=r,this.flags=i,this.message=o,this.template=a;const c=this.options.language;this.flags.label?this.context.label=this.flags.label:!c||""!==this.context.label&&null!==this.context.label||(this.context.label=c.root||n.errors.root)}toString(){if(this.message)return this.message;let e;this.template&&(e=this.template);const t=this.options.language;if(void 0===(e=e||r.reach(t,this.type)||r.reach(n.errors,this.type)))return`Error code "${this.type}" is not defined, your custom type is missing the correct language definition`;let s=r.reach(t,"messages.wrapArrays");if("boolean"!=typeof s&&(s=n.errors.messages.wrapArrays),null===e){const e=i.stringify(this.context.reason,s);return s?e.slice(1,-1):e}const o=/\{\{\!?label\}\}/.test(e),a=e.length>2&&"!"===e[0]&&"!"===e[1];if(a&&(e=e.slice(2)),!o&&!a){const s=r.reach(t,"key");e="string"==typeof s?s+e:r.reach(n.errors,"key")+e}return e.replace(/\{\{(\!?)([^}]+)\}\}/g,(e,t,n)=>{const o=r.reach(this.context,n),a=i.stringify(o,s);return t&&this.options.escapeHtml?r.escapeHtml(a):a})}},t.create=function(e,s,r,n,i,o,a){return new t.Err(e,s,r,n,i,o,a)},t.process=function(e,t){if(!e||!e.length)return null;let s="";const r=[],n=function(e,t){for(let i=0;i<e.length;++i){const o=e[i];if(o instanceof Error)return o;if(o.flags.error&&"function"!=typeof o.flags.error)return o.flags.error;let a;if(void 0===t&&(a=o.toString(),s=s+(s?". ":"")+a),o.context.reason&&o.context.reason.length){const e=n(o.context.reason,o.path);if(e)return e}else r.push({message:a||o.toString(),path:o.path,type:o.type,context:o.context})}},o=n(e);if(o)return o;const a=new Error(s);return a.isJoi=!0,a.name="ValidationError",a.details=r,a._object=t,a.annotate=i.annotate,a},i.safeStringify=function(e,t){return JSON.stringify(e,i.serializer(),t)},i.serializer=function(){const e=[],t=[];return function(s,r){if(t.length>0){const n=t.indexOf(this);~n?(t.length=n+1,e.length=n+1,e[n]=s):(t.push(this),e.push(s)),~t.indexOf(r)&&(r=((s,r)=>t[0]===r?"[Circular ~]":"[Circular ~."+e.slice(0,t.indexOf(r)).join(".")+"]").call(this,s,r))}else t.push(r);if(r){const e=r[i.annotations];if(e){if(Array.isArray(r)){const t=[];for(let s=0;s<r.length;++s)e.errors[s]&&t.push(`_$idx$_${e.errors[s].sort().join(", ")}_$end$_`),t.push(r[s]);r=t}else{const t=Object.keys(e.errors);for(let s=0;s<t.length;++s){const n=t[s];r[`${n}_$key$_${e.errors[n].sort().join(", ")}_$end$_`]=r[n],r[n]=void 0}const s=Object.keys(e.missing);for(let t=0;t<s.length;++t){const n=s[t];r[`_$miss$_${n}|${e.missing[n]}_$end$_`]="__missing__"}}return r}}return r===1/0||r===-1/0||Number.isNaN(r)||"function"==typeof r||"symbol"==typeof r?"["+r.toString()+"]":r}},i.annotate=function(e){const t=e?"":"[31m",s=e?"":"[41m",n=e?"":"[0m";if("object"!=typeof this._object)return this.details[0].message;const o=r.clone(this._object||{});for(let e=this.details.length-1;e>=0;--e){const t=e+1,s=this.details[e],r=s.path;let n=o;for(let e=0;;++e){const o=r[e];if(n.isImmutable&&(n=n.clone()),!(e+1<r.length&&n[o]&&"string"!=typeof n[o])){const e=n[i.annotations]=n[i.annotations]||{errors:{},missing:{}},r=n[o],a=o||s.context.label;void 0!==r?(e.errors[a]=e.errors[a]||[],e.errors[a].push(t)):e.missing[a]=t;break}n=n[o]}}const a=/_\$key\$_([, \d]+)_\$end\$_\"/g,c=/\"_\$miss\$_([^\|]+)\|(\d+)_\$end\$_\"\: \"__missing__\"/g,l=/\s*\"_\$idx\$_([, \d]+)_\$end\$_\",?\n(.*)/g,u=/"\[(NaN|Symbol.*|-?Infinity|function.*|\(.*)\]"/g;let h=i.safeStringify(o,2).replace(a,(e,s)=>`" ${t}[${s}]${n}`).replace(c,(e,r,i)=>`${s}"${r}"${n}${t} [${i}]: -- missing --${n}`).replace(l,(e,s,r)=>`\n${r} ${t}[${s}]${n}`).replace(u,(e,t)=>t);h=`${h}\n${t}`;for(let e=0;e<this.details.length;++e){h=`${h}\n[${e+1}] ${this.details[e].message}`}return h+=n}},function(e,t,s){"use strict";function r(e,t){const s=Buffer.allocUnsafe(t);for(var r=0,n=0;n<e.length;n++){const t=e[n];t.copy(s,r),r+=t.length}return s}function n(e,t,s,r,n){for(var i=0;i<n;i++)s[r+i]=e[i]^t[3&i]}function i(e,t){const s=e.length;for(var r=0;r<s;r++)e[r]^=t[3&r]}try{const t=s(!function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()),o=t.BufferUtil||t;e.exports={mask(e,t,s,r,i){i<48?n(e,t,s,r,i):o.mask(e,t,s,r,i)},unmask(e,t){e.length<32?i(e,t):o.unmask(e,t)},concat:r}}catch(t){e.exports={concat:r,mask:n,unmask:i}}},function(e,t){e.exports=require("path")},function(e,t,s){"use strict";const r=s(3),n=s(41),i=s(5),o=s(9),a=s(4),c={};t.defaults={encryption:{saltBits:256,algorithm:"aes-256-cbc",iterations:1,minPasswordlength:32},integrity:{saltBits:256,algorithm:"sha256",iterations:1,minPasswordlength:32},ttl:0,timestampSkewSec:60,localtimeOffsetMsec:0},t.algorithms={"aes-128-ctr":{keyBits:128,ivBits:128},"aes-256-cbc":{keyBits:256,ivBits:128},sha256:{keyBits:256}},t.macFormatVersion="2",t.macPrefix="Fe26."+t.macFormatVersion,t.generateKey=async function(e,s){if(!e)throw new i("Empty password");if(!s||"object"!=typeof s)throw new i("Bad options");const r=t.algorithms[s.algorithm];if(!r)throw new i("Unknown algorithm: "+s.algorithm);const n={};if(Buffer.isBuffer(e)){if(e.length<r.keyBits/8)throw new i("Key buffer (password) too small");n.key=e,n.salt=""}else{if(e.length<s.minPasswordlength)throw new i("Password string too short (min "+s.minPasswordlength+" characters required)");let t=s.salt;if(!t){if(!s.saltBits)throw new i("Missing salt and saltBits options");t=o.randomBits(s.saltBits).toString("hex")}const a=await c.pbkdf2(e,t,s.iterations,r.keyBits/8,"sha1");n.key=a,n.salt=t}return s.iv?n.iv=s.iv:r.ivBits&&(n.iv=o.randomBits(r.ivBits)),n},t.encrypt=async function(e,s,n){const i=await t.generateKey(e,s),o=r.createCipheriv(s.algorithm,i.key,i.iv);return{encrypted:Buffer.concat([o.update(n,"utf8"),o.final()]),key:i}},t.decrypt=async function(e,s,n){const i=await t.generateKey(e,s),o=r.createDecipheriv(s.algorithm,i.key,i.iv);let a=o.update(n,null,"utf8");return a+=o.final("utf8")},t.hmacWithPassword=async function(e,s,n){const i=await t.generateKey(e,s);return{digest:r.createHmac(s.algorithm,i.key).update(n).digest("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,""),salt:i.salt}},c.normalizePassword=function(e){const t={};return e instanceof Object&&!Buffer.isBuffer(e)?(t.id=e.id,t.encryption=e.secret||e.encryption,t.integrity=e.secret||e.integrity):(t.encryption=e,t.integrity=e),t},t.seal=async function(e,s,r){r=Object.assign({},r);const o=Date.now()+(r.localtimeOffsetMsec||0),a=c.stringify(e);let l="";if((s=c.normalizePassword(s)).id){if(!/^\w+$/.test(s.id))throw new i("Invalid password id");l=s.id}const{encrypted:u,key:h}=await t.encrypt(s.encryption,r.encryption,a),f=n.base64urlEncode(u),p=n.base64urlEncode(h.iv),d=r.ttl?o+r.ttl:"",m=t.macPrefix+"*"+l+"*"+h.salt+"*"+p+"*"+f+"*"+d,g=await t.hmacWithPassword(s.integrity,r.integrity,m);return m+"*"+g.salt+"*"+g.digest},t.unseal=async function(e,s,r){r=Object.assign({},r);const l=Date.now()+(r.localtimeOffsetMsec||0),u=e.split("*");if(8!==u.length)throw new i("Incorrect number of sealed components");const h=u[0],f=u[1],p=u[2],d=u[3],m=u[4],g=u[5],y=u[6],_=u[7],b=h+"*"+f+"*"+p+"*"+d+"*"+m+"*"+g;if(h!==t.macPrefix)throw new i("Wrong mac prefix");if(g){if(!g.match(/^\d+$/))throw new i("Invalid expiration");if(parseInt(g,10)<=l-1e3*r.timestampSkewSec)throw new i("Expired seal")}if(s instanceof Object&&!Buffer.isBuffer(s)&&!(s=s[f||"default"]))throw new i("Cannot find password: "+f);s=c.normalizePassword(s);const v=a.clone(r.integrity);v.salt=y;const w=await t.hmacWithPassword(s.integrity,v,b);if(!o.fixedTimeComparison(w.digest,_))throw new i("Bad hmac value");try{var k=n.base64urlDecode(m,"buffer")}catch(e){throw i.boomify(e)}const x=a.clone(r.encryption);x.salt=p;try{x.iv=n.base64urlDecode(d,"buffer")}catch(e){throw i.boomify(e)}const S=await t.decrypt(s.encryption,x,k);let E=null;try{E=JSON.parse(S)}catch(e){throw new i("Failed parsing sealed object JSON: "+e.message)}return E},c.stringify=function(e){try{return JSON.stringify(e)}catch(e){throw new i("Failed to stringify object: "+e.message)}},c.pbkdf2=function(...e){return new Promise((t,s)=>{e.push((e,r)=>{if(e)return s(i.boomify(e));t(r)}),r.pbkdf2(...e)})}},function(e,t,s){"use strict";const r=s(0);t.concat=function(e,t){if(!t)return e;const s=Object.assign({},e),n=Object.keys(t);for(let e=0;e<n.length;++e){const i=n[e];"language"===i&&s.hasOwnProperty(i)?s[i]=r.applyToDefaults(s[i],t[i]):s[i]=t[i]}return s}},function(e,t,s){"use strict";const r=s(2),n={extendedCheckForValue:function(e,t){const s=typeof e;if("object"===s){if(e instanceof Date)return t=>t instanceof Date&&e.getTime()===t.getTime();if(Buffer.isBuffer(e))return t=>Buffer.isBuffer(t)&&e.length===t.length&&e.toString("binary")===t.toString("binary")}else if(t&&"string"===s){const t=e.toLowerCase();return e=>"string"==typeof e&&t===e.toLowerCase()}return null}};e.exports=class e{constructor(e){this._set=new Set(e),this._hasRef=!1}add(e,t){const s=r.isRef(e);return!s&&this.has(e,null,null,!1)?this:(void 0!==t&&r.push(t,e),this._set.add(e),this._hasRef|=s,this)}merge(e,t){for(const t of e._set)this.add(t);for(const e of t._set)this.remove(e);return this}remove(e){return this._set.delete(e),this}has(e,t,s,i){if(!this._set.size)return!1;const o=this._set.has(e);if(o)return o;const a=n.extendedCheckForValue(e,i);if(!a){if(t&&this._hasRef)for(let n of this._set)if(r.isRef(n)&&(e===(n=n(t.reference||t.parent,s))||Array.isArray(n)&&n.includes(e)))return!0;return!1}return this._has(e,t,s,a)}_has(e,t,s,n){const i=!(!t||!this._hasRef),o=function(t){return e===t||n(t)};for(let e of this._set)if(i&&r.isRef(e)&&(e=e(t.reference||t.parent,s),Array.isArray(e))){if(e.find(o))return!0}else if(o(e))return!0;return!1}values(e){if(e&&e.stripUndefined){const e=[];for(const t of this._set)void 0!==t&&e.push(t);return e}return Array.from(this._set)}slice(){const t=new e(this._set);return t._hasRef=this._hasRef,t}concat(t){const s=new e([...this._set,...t._set]);return s._hasRef=!!(this._hasRef|t._hasRef),s}}},function(e,t,s){"use strict";const r=s(0),n=s(1),i=s(6),o=s(2),a={};a.Alternatives=class extends n{constructor(){super(),this._type="alternatives",this._invalids.remove(null),this._inner.matches=[]}_init(...e){return e.length?this.try(...e):this}_base(e,t,s){let r=[];const n=this._inner.matches.length,i=this._baseType;for(let o=0;o<n;++o){const a=this._inner.matches[o];if(!a.schema){const r=a.peek||a.is,c=a.is?a.ref(t.reference||t.parent,s):e;if(r._validate(c,null,s,t.parent).errors){if(a.otherwise)return a.otherwise._validate(e,t,s)}else if(a.then)return a.then._validate(e,t,s);if(o===n-1&&i)return i._validate(e,t,s);continue}const c=a.schema._validate(e,t,s);if(!c.errors)return c;r=r.concat(c.errors)}return r.length?{errors:this.createError("alternatives.child",{reason:r},t,s)}:{errors:this.createError("alternatives.base",null,t,s)}}try(...e){e=r.flatten(e),r.assert(e.length,"Cannot add other alternatives without at least one schema");const t=this.clone();for(let s=0;s<e.length;++s){const r=i.schema(this._currentJoi,e[s]);r._refs.length&&(t._refs=t._refs.concat(r._refs)),t._inner.matches.push({schema:r})}return t}when(e,t){let s=!1;r.assert(o.isRef(e)||"string"==typeof e||(s=e instanceof n),"Invalid condition:",e),r.assert(t,"Missing options"),r.assert("object"==typeof t,"Invalid options"),s?r.assert(!t.hasOwnProperty("is"),'"is" can not be used with a schema condition'):r.assert(t.hasOwnProperty("is"),'Missing "is" directive'),r.assert(void 0!==t.then||void 0!==t.otherwise,'options must have at least one of "then" or "otherwise"');const a=this.clone();let c;s||(c=i.schema(this._currentJoi,t.is),null!==t.is&&(o.isRef(t.is)||t.is instanceof n)||(c=c.required()));const l={ref:s?null:i.ref(e),peek:s?e:null,is:c,then:void 0!==t.then?i.schema(this._currentJoi,t.then):void 0,otherwise:void 0!==t.otherwise?i.schema(this._currentJoi,t.otherwise):void 0};return a._baseType&&(l.then=l.then&&a._baseType.concat(l.then),l.otherwise=l.otherwise&&a._baseType.concat(l.otherwise)),s||(o.push(a._refs,l.ref),a._refs=a._refs.concat(l.is._refs)),l.then&&l.then._refs&&(a._refs=a._refs.concat(l.then._refs)),l.otherwise&&l.otherwise._refs&&(a._refs=a._refs.concat(l.otherwise._refs)),a._inner.matches.push(l),a}describe(){const e=super.describe(),t=[];for(let e=0;e<this._inner.matches.length;++e){const s=this._inner.matches[e];if(s.schema)t.push(s.schema.describe());else{const e=s.is?{ref:s.ref.toString(),is:s.is.describe()}:{peek:s.peek.describe()};s.then&&(e.then=s.then.describe()),s.otherwise&&(e.otherwise=s.otherwise.describe()),t.push(e)}}return e.alternatives=t,e}},e.exports=new a.Alternatives},function(e,t,s){"use strict";const r=s(1),n=s(2),i=s(0),o={isoDate:/^(?:[-+]\d{2})?(?:\d{4}(?!\d{2}\b))(?:(-?)(?:(?:0[1-9]|1[0-2])(?:\1(?:[12]\d|0[1-9]|3[01]))?|W(?:[0-4]\d|5[0-2])(?:-?[1-7])?|(?:00[1-9]|0[1-9]\d|[12]\d{2}|3(?:[0-5]\d|6[1-6])))(?![T]$|[T][\d]+Z$)(?:[T\s](?:(?:(?:[01]\d|2[0-3])(?:(:?)[0-5]\d)?|24\:?00)(?:[.,]\d+(?!:))?)(?:\2[0-5]\d(?:[.,]\d+)?)?(?:[Z]|(?:[+-])(?:[01]\d|2[0-3])(?::?[0-5]\d)?)?)?)?$/};o.invalidDate=new Date(""),o.isIsoDate=(()=>{const e=o.isoDate.toString();return t=>t&&t.toString()===e})(),o.Date=class extends r{constructor(){super(),this._type="date"}_base(e,t,s){const r={value:s.convert&&o.Date.toDate(e,this._flags.format,this._flags.timestamp,this._flags.multiplier)||e};if(r.value instanceof Date&&!isNaN(r.value.getTime()))r.errors=null;else if(s.convert){let e;e=o.isIsoDate(this._flags.format)?"isoDate":this._flags.timestamp?`timestamp.${this._flags.timestamp}`:"base",r.errors=this.createError(`date.${e}`,null,t,s)}else r.errors=this.createError("date.strict",null,t,s);return r}static toDate(e,t,s,r){if(e instanceof Date)return e;if("string"==typeof e||"number"==typeof e&&!isNaN(e)&&isFinite(e)){let n;if("string"==typeof e&&/^[+-]?\d+(\.\d+)?$/.test(e)&&(e=parseFloat(e)),n=t&&o.isIsoDate(t)?t.test(e)?new Date(e):o.invalidDate:s&&r?/^\s*$/.test(e)?o.invalidDate:new Date(e*r):new Date(e),!isNaN(n.getTime()))return n}return null}iso(){if(this._flags.format===o.isoDate)return this;const e=this.clone();return e._flags.format=o.isoDate,e}timestamp(e="javascript"){const t=["javascript","unix"];if(i.assert(t.includes(e),'"type" must be one of "'+t.join('", "')+'"'),this._flags.timestamp===e)return this;const s=this.clone();return s._flags.timestamp=e,s._flags.multiplier="unix"===e?1e3:1,s}_isIsoDate(e){return o.isoDate.test(e)}},o.compare=function(e,t){return function(s){const r="now"===s,a=n.isRef(s);return r||a||(s=o.Date.toDate(s)),i.assert(s,"Invalid date format"),this._test(e,s,function(n,i,c){let l;if(r)l=Date.now();else if(a){if(!(l=o.Date.toDate(s(i.reference||i.parent,c))))return this.createError("date.ref",{ref:s.key},i,c);l=l.getTime()}else l=s.getTime();return t(n.getTime(),l)?n:this.createError("date."+e,{limit:new Date(l)},i,c)})}},o.Date.prototype.min=o.compare("min",(e,t)=>e>=t),o.Date.prototype.max=o.compare("max",(e,t)=>e<=t),o.Date.prototype.greater=o.compare("greater",(e,t)=>e>t),o.Date.prototype.less=o.compare("less",(e,t)=>e<t),e.exports=new o.Date},function(e,t,s){"use strict";const r=s(0),n=s(51),i=s(1),o=s(14),a=s(6),c={};c.Object=class extends i{constructor(){super(),this._type="object",this._inner.children=null,this._inner.renames=[],this._inner.dependencies=[],this._inner.patterns=[]}_init(...e){return e.length?this.keys(...e):this}_base(e,t,s){let n=e;const i=[],a=()=>({value:n,errors:i.length?i:null});"string"==typeof e&&s.convert&&(e=c.safeParse(e));const l=this._flags.func?"function":"object";if(!e||typeof e!==l||Array.isArray(e))return i.push(this.createError(l+".base",null,t,s)),a();if(!(this._inner.renames.length||this._inner.dependencies.length||this._inner.children||this._inner.patterns.length))return n=e,a();if(n===e){"object"===l?n=Object.create(Object.getPrototypeOf(e)):(n=function(...t){return e.apply(this,t)}).prototype=r.clone(e.prototype);const t=Object.keys(e);for(let s=0;s<t.length;++s)n[t[s]]=e[t[s]]}else n=e;const u={};for(let e=0;e<this._inner.renames.length;++e){const r=this._inner.renames[e];if(r.isRegExp){const e=Object.keys(n),o=[];for(let t=0;t<e.length;++t)r.from.test(e[t])&&o.push(e[t]);const c=o.every(e=>void 0===n[e]);if(r.options.ignoreUndefined&&c)continue;if(!r.options.multiple&&u[r.to]&&(i.push(this.createError("object.rename.regex.multiple",{from:o,to:r.to},t,s)),s.abortEarly))return a();if(Object.prototype.hasOwnProperty.call(n,r.to)&&!r.options.override&&!u[r.to]&&(i.push(this.createError("object.rename.regex.override",{from:o,to:r.to},t,s)),s.abortEarly))return a();if(c?delete n[r.to]:n[r.to]=n[o[o.length-1]],u[r.to]=!0,!r.options.alias)for(let e=0;e<o.length;++e)delete n[o[e]]}else{if(r.options.ignoreUndefined&&void 0===n[r.from])continue;if(!r.options.multiple&&u[r.to]&&(i.push(this.createError("object.rename.multiple",{from:r.from,to:r.to},t,s)),s.abortEarly))return a();if(Object.prototype.hasOwnProperty.call(n,r.to)&&!r.options.override&&!u[r.to]&&(i.push(this.createError("object.rename.override",{from:r.from,to:r.to},t,s)),s.abortEarly))return a();void 0===n[r.from]?delete n[r.to]:n[r.to]=n[r.from],u[r.to]=!0,r.options.alias||delete n[r.from]}}if(!this._inner.children&&!this._inner.patterns.length&&!this._inner.dependencies.length)return a();const h=new Set(Object.keys(n));if(this._inner.children){const e=[];for(let r=0;r<this._inner.children.length;++r){const o=this._inner.children[r],c=o.key,l=n[c];h.delete(c);const u={key:c,path:t.path.concat(c),parent:n,reference:t.reference},f=o.schema._validate(l,u,s);if(f.errors){if(i.push(this.createError("object.child",{key:c,child:o.schema._getLabel(c),reason:f.errors},u,s)),s.abortEarly)return a()}else o.schema._flags.strip||void 0===f.value&&f.value!==l?(e.push(c),n[c]=f.finalValue):void 0!==f.value&&(n[c]=f.value)}for(let t=0;t<e.length;++t)delete n[e[t]]}if(h.size&&this._inner.patterns.length)for(const e of h){const r={key:e,path:t.path.concat(e),parent:n,reference:t.reference},o=n[e];for(let t=0;t<this._inner.patterns.length;++t){const c=this._inner.patterns[t];if(c.regex?c.regex.test(e):!c.schema.validate(e).error){h.delete(e);const t=c.rule._validate(o,r,s);if(t.errors&&(i.push(this.createError("object.child",{key:e,child:c.rule._getLabel(e),reason:t.errors},r,s)),s.abortEarly))return a();n[e]=t.value}}}if(h.size&&(this._inner.children||this._inner.patterns.length)){if(s.stripUnknown&&!0!==this._flags.allowUnknown||s.skipFunctions){const e=!!s.stripUnknown&&(!0===s.stripUnknown||!!s.stripUnknown.objects);for(const t of h)e?(delete n[t],h.delete(t)):"function"==typeof n[t]&&h.delete(t)}if(void 0!==this._flags.allowUnknown?!this._flags.allowUnknown:!s.allowUnknown)for(const e of h)i.push(this.createError("object.allowUnknown",{child:e},{key:e,path:t.path.concat(e)},s,{}))}for(let e=0;e<this._inner.dependencies.length;++e){const r=this._inner.dependencies[e],l=c[r.type].call(this,null!==r.key&&n[r.key],r.peers,n,{key:r.key,path:null===r.key?t.path:t.path.concat(r.key)},s);if(l instanceof o.Err&&(i.push(l),s.abortEarly))return a()}return a()}keys(e){r.assert(null==e||"object"==typeof e,"Object schema must be a valid object"),r.assert(!(e&&e instanceof i),"Object schema cannot be a joi schema");const t=this.clone();if(!e)return t._inner.children=null,t;const s=Object.keys(e);if(!s.length)return t._inner.children=[],t;const o=new n;if(t._inner.children)for(let e=0;e<t._inner.children.length;++e){const r=t._inner.children[e];s.includes(r.key)||o.add(r,{after:r._refs,group:r.key})}for(let t=0;t<s.length;++t){const r=s[t],n=e[r];try{const e=a.schema(this._currentJoi,n);o.add({key:r,schema:e},{after:e._refs,group:r})}catch(e){throw e.hasOwnProperty("path")?e.path=r+"."+e.path:e.path=r,e}}return t._inner.children=o.nodes,t}append(e){return null==e||0===Object.keys(e).length?this:this.keys(e)}unknown(e){const t=!1!==e;if(this._flags.allowUnknown===t)return this;const s=this.clone();return s._flags.allowUnknown=t,s}length(e){return r.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("length",e,function(t,s,r){return Object.keys(t).length===e?t:this.createError("object.length",{limit:e},s,r)})}min(e){return r.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("min",e,function(t,s,r){return Object.keys(t).length>=e?t:this.createError("object.min",{limit:e},s,r)})}max(e){return r.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("max",e,function(t,s,r){return Object.keys(t).length<=e?t:this.createError("object.max",{limit:e},s,r)})}pattern(e,t){const s=e instanceof RegExp;r.assert(s||e instanceof i,"pattern must be a regex or schema"),r.assert(void 0!==t,"Invalid rule"),s&&(e=new RegExp(e.source,e.ignoreCase?"i":void 0));try{t=a.schema(this._currentJoi,t)}catch(e){throw e.hasOwnProperty("path")&&(e.message=e.message+"("+e.path+")"),e}const n=this.clone();return s?n._inner.patterns.push({regex:e,rule:t}):n._inner.patterns.push({schema:e,rule:t}),n}schema(){return this._test("schema",null,function(e,t,s){return e instanceof i?e:this.createError("object.schema",null,t,s)})}with(e,t){return r.assert(2===arguments.length,"Invalid number of arguments, expected 2."),this._dependency("with",e,t)}without(e,t){return r.assert(2===arguments.length,"Invalid number of arguments, expected 2."),this._dependency("without",e,t)}xor(...e){return e=r.flatten(e),this._dependency("xor",null,e)}or(...e){return e=r.flatten(e),this._dependency("or",null,e)}and(...e){return e=r.flatten(e),this._dependency("and",null,e)}nand(...e){return e=r.flatten(e),this._dependency("nand",null,e)}requiredKeys(...e){return e=r.flatten(e),this.applyFunctionToChildren(e,"required")}optionalKeys(...e){return e=r.flatten(e),this.applyFunctionToChildren(e,"optional")}forbiddenKeys(...e){return e=r.flatten(e),this.applyFunctionToChildren(e,"forbidden")}rename(e,t,s){r.assert("string"==typeof e||e instanceof RegExp,"Rename missing the from argument"),r.assert("string"==typeof t,"Rename missing the to argument"),r.assert(t!==e,"Cannot rename key to same name:",e);for(let t=0;t<this._inner.renames.length;++t)r.assert(this._inner.renames[t].from!==e,"Cannot rename the same key multiple times");const n=this.clone();return n._inner.renames.push({from:e,to:t,options:r.applyToDefaults(c.renameDefaults,s||{}),isRegExp:e instanceof RegExp}),n}applyFunctionToChildren(e,t,s,n){e=[].concat(e),r.assert(e.length>0,"expected at least one children");const i=c.groupChildren(e);let o;if(""in i?(o=this[t].apply(this,s),delete i[""]):o=this.clone(),o._inner.children){n=n?n+".":"";for(let e=0;e<o._inner.children.length;++e){const r=o._inner.children[e],a=i[r.key];a&&(o._inner.children[e]={key:r.key,_refs:r._refs,schema:r.schema.applyFunctionToChildren(a,t,s,n+r.key)},delete i[r.key])}}const a=Object.keys(i);return r.assert(0===a.length,"unknown key(s)",a.join(", ")),o}_dependency(e,t,s){s=[].concat(s);for(let t=0;t<s.length;++t)r.assert("string"==typeof s[t],e,"peers must be a string or array of strings");const n=this.clone();return n._inner.dependencies.push({type:e,key:t,peers:s}),n}describe(e){const t=super.describe();if(t.rules)for(let e=0;e<t.rules.length;++e){const s=t.rules[e];s.arg&&"object"==typeof s.arg&&s.arg.schema&&s.arg.ref&&(s.arg={schema:s.arg.schema.describe(),ref:s.arg.ref.toString()})}if(this._inner.children&&!e){t.children={};for(let e=0;e<this._inner.children.length;++e){const s=this._inner.children[e];t.children[s.key]=s.schema.describe()}}if(this._inner.dependencies.length&&(t.dependencies=r.clone(this._inner.dependencies)),this._inner.patterns.length){t.patterns=[];for(let e=0;e<this._inner.patterns.length;++e){const s=this._inner.patterns[e];s.regex?t.patterns.push({regex:s.regex.toString(),rule:s.rule.describe()}):t.patterns.push({schema:s.schema.describe(),rule:s.rule.describe()})}}return this._inner.renames.length>0&&(t.renames=r.clone(this._inner.renames)),t}assert(e,t,s){e=a.ref(e),r.assert(e.isContext||e.depth>1,"Cannot use assertions for root level references - use direct key rules instead"),s=s||"pass the assertion test";try{t=a.schema(this._currentJoi,t)}catch(e){throw e.hasOwnProperty("path")&&(e.message=e.message+"("+e.path+")"),e}const n=e.path[e.path.length-1],i=e.path.join(".");return this._test("assert",{schema:t,ref:e},function(o,a,c){if(!t._validate(e(o),null,c,o).errors)return o;const l=r.merge({},a);return l.key=n,l.path=e.path,this.createError("object.assert",{ref:i,message:s},l,c)})}type(e,t=e.name){r.assert("function"==typeof e,"type must be a constructor function");const s={name:t,ctor:e};return this._test("type",s,function(t,r,n){return t instanceof e?t:this.createError("object.type",{type:s.name},r,n)})}},c.safeParse=function(e){try{return JSON.parse(e)}catch(e){}return e},c.renameDefaults={alias:!1,multiple:!1,override:!1},c.groupChildren=function(e){e.sort();const t={};for(let s=0;s<e.length;++s){const n=e[s];r.assert("string"==typeof n,"children must be strings");const i=n.split(".")[0];(t[i]=t[i]||[]).push(n.substring(i.length+1))}return t},c.keysToLabels=function(e,t){const s=e._inner.children;if(!s)return t;const r=function(e){const t=s.find(t=>t.key===e);return t?t.schema._getLabel(e):e};return Array.isArray(t)?t.map(r):r(t)},c.with=function(e,t,s,r,n){if(void 0===e)return e;for(let e=0;e<t.length;++e){const i=t[e];if(!Object.prototype.hasOwnProperty.call(s,i)||void 0===s[i])return this.createError("object.with",{main:r.key,mainWithLabel:c.keysToLabels(this,r.key),peer:i,peerWithLabel:c.keysToLabels(this,i)},r,n)}return e},c.without=function(e,t,s,r,n){if(void 0===e)return e;for(let e=0;e<t.length;++e){const i=t[e];if(Object.prototype.hasOwnProperty.call(s,i)&&void 0!==s[i])return this.createError("object.without",{main:r.key,mainWithLabel:c.keysToLabels(this,r.key),peer:i,peerWithLabel:c.keysToLabels(this,i)},r,n)}return e},c.xor=function(e,t,s,r,n){const i=[];for(let e=0;e<t.length;++e){const r=t[e];Object.prototype.hasOwnProperty.call(s,r)&&void 0!==s[r]&&i.push(r)}if(1===i.length)return e;const o={peers:t,peersWithLabels:c.keysToLabels(this,t)};return 0===i.length?this.createError("object.missing",o,r,n):this.createError("object.xor",o,r,n)},c.or=function(e,t,s,r,n){for(let r=0;r<t.length;++r){const n=t[r];if(Object.prototype.hasOwnProperty.call(s,n)&&void 0!==s[n])return e}return this.createError("object.missing",{peers:t,peersWithLabels:c.keysToLabels(this,t)},r,n)},c.and=function(e,t,s,r,n){const i=[],o=[],a=t.length;for(let e=0;e<a;++e){const r=t[e];Object.prototype.hasOwnProperty.call(s,r)&&void 0!==s[r]?o.push(r):i.push(r)}if(!(i.length===a||o.length===a))return this.createError("object.and",{present:o,presentWithLabels:c.keysToLabels(this,o),missing:i,missingWithLabels:c.keysToLabels(this,i)},r,n)},c.nand=function(e,t,s,n,i){const o=[];for(let e=0;e<t.length;++e){const r=t[e];Object.prototype.hasOwnProperty.call(s,r)&&void 0!==s[r]&&o.push(r)}const a=r.clone(t),l=a.splice(0,1)[0];return o.length===t.length?this.createError("object.nand",{main:l,mainWithLabel:c.keysToLabels(this,l),peers:a,peersWithLabels:c.keysToLabels(this,a)},n,i):null},e.exports=new c.Object},function(e,t){e.exports=require("net")},function(e,t,s){"use strict";const r={rfc3986:{},generate:function(){const e="|";r.rfc3986.ipv4Cidr="[0-9]|[1-2][0-9]|3[0-2]",r.rfc3986.ipv6Cidr="(?:0?0?[0-9]|0?[1-9][0-9]|1[01][0-9]|12[0-8])";const t="a-zA-Z0-9-\\._~",s="!\\$&'\\(\\)\\*\\+,;=",n=t+"%0-9A-Fa-f"+s+":@",i="["+n+"]",o="(?:0?0?[0-9]|0?[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])";r.rfc3986.IPv4address="(?:"+o+"\\.){3}"+o;const a="[0-9A-Fa-f]{1,4}",c="(?:"+a+":"+a+"|"+r.rfc3986.IPv4address+")",l="(?:"+a+":){6}"+c,u="::(?:"+a+":){5}"+c,h="(?:"+a+")?::(?:"+a+":){4}"+c,f="(?:(?:"+a+":){0,1}"+a+")?::(?:"+a+":){3}"+c,p="(?:(?:"+a+":){0,2}"+a+")?::(?:"+a+":){2}"+c,d="(?:(?:"+a+":){0,3}"+a+")?::"+a+":"+c,m="(?:(?:"+a+":){0,4}"+a+")?::"+c;r.rfc3986.IPv6address="(?:"+l+e+u+e+h+e+f+e+p+e+d+e+m+e+"(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}"+e+"(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)",r.rfc3986.IPvFuture="v[0-9A-Fa-f]+\\.["+t+s+":]+",r.rfc3986.scheme="[a-zA-Z][a-zA-Z0-9+-\\.]*";const g="(?:[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:]*@)?"+("(?:"+("\\[(?:"+r.rfc3986.IPv6address+e+r.rfc3986.IPvFuture+")\\]")+e+r.rfc3986.IPv4address+e+"[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=]{0,255})")+"(?::[0-9]*)?",y=i+"+",_="(?:\\/[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*",b="\\/(?:"+y+_+")?";r.rfc3986.hierPart="(?:(?:\\/\\/"+g+_+")"+e+b+e+"[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]+(?:\\/[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*)",r.rfc3986.relativeRef="(?:(?:\\/\\/"+g+_+")"+e+b+e+"[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=@]+(?:\\/[a-zA-Z0-9-\\._~%0-9A-Fa-f!\\$&'\\(\\)\\*\\+,;=:@]*)*"+e+")",r.rfc3986.query="["+n+"\\/\\?]*(?=#|$)",r.rfc3986.queryWithSquareBrackets="["+n+"\\[\\]\\/\\?]*(?=#|$)",r.rfc3986.fragment="["+n+"\\/\\?]*"}};r.generate(),e.exports=r.rfc3986},function(e,t,s){"use strict";const r=s(26);r.Server=s(65),r.Receiver=s(31),r.Sender=s(33),e.exports=r},function(e,t,s){"use strict";const r=s(27),n=s(3),i=s(60),o=s(28),a=s(23),c=s(61),l=s(29),u=s(8),h=s(64),f=s(30),p=s(7),d=s(31),m=s(33),g=["CONNECTING","OPEN","CLOSING","CLOSED"],y=p.kWebSocket,_=[8,13],b=3e4;class v extends r{constructor(e,t,s){super(),this.readyState=v.CONNECTING,this.protocol="",this._binaryType=p.BINARY_TYPES[0],this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage="",this._closeTimer=null,this._closeCode=1006,this._extensions={},this._isServer=!0,this._receiver=null,this._sender=null,this._socket=null,null!==e&&(Array.isArray(t)?t=t.join(", "):"object"==typeof t&&null!==t&&(s=t,t=void 0),function(e,t,s){if(s=Object.assign({protocolVersion:_[1],perMessageDeflate:!0},s,{createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,auth:void 0,host:void 0,path:void 0,port:void 0}),-1===_.indexOf(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} `+`(supported versions: ${_.join(", ")})`);var r;this._isServer=!1,"object"==typeof e&&void 0!==e.href?(r=e,this.url=e.href):(r=l.parse(e),this.url=e);const a="ws+unix:"===r.protocol;if(!(r.host||a&&r.pathname))throw new Error(`Invalid URL: ${this.url}`);const c="wss:"===r.protocol||"https:"===r.protocol,h=n.randomBytes(16).toString("base64"),d=c?i:o,m=r.search?`${r.pathname||"/"}${r.search}`:r.pathname||"/";var g;s.createConnection=c?k:w,s.port=r.port||(c?443:80),s.host=r.hostname.startsWith("[")?r.hostname.slice(1,-1):r.hostname,s.headers=Object.assign({"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},s.headers),s.path=m,s.perMessageDeflate&&(g=new u(!0!==s.perMessageDeflate?s.perMessageDeflate:{},!1),s.headers["Sec-WebSocket-Extensions"]=f.format({[u.extensionName]:g.offer()}));t&&(s.headers["Sec-WebSocket-Protocol"]=t);s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin);r.auth?s.auth=r.auth:(r.username||r.password)&&(s.auth=`${r.username}:${r.password}`);if(a){const e=m.split(":");null==s.agent&&process.versions.modules<57?s._socketPath=e[0]:s.socketPath=e[0],s.path=e[1]}var y=this._req=d.get(s);s.handshakeTimeout&&y.setTimeout(s.handshakeTimeout,()=>x(this,y,"Opening handshake has timed out"));y.on("error",e=>{this._req.aborted||(y=this._req=null,this.readyState=v.CLOSING,this.emit("error",e),this.emitClose())}),y.on("response",e=>{this.emit("unexpected-response",y,e)||x(this,y,`Unexpected server response: ${e.statusCode}`)}),y.on("upgrade",(e,s,r)=>{if(this.emit("upgrade",e),this.readyState!==v.CONNECTING)return;y=this._req=null;const i=n.createHash("sha1").update(h+p.GUID,"binary").digest("base64");if(e.headers["sec-websocket-accept"]!==i)return void x(this,s,"Invalid Sec-WebSocket-Accept header");const o=e.headers["sec-websocket-protocol"],a=(t||"").split(/, */);var c;if(!t&&o?c="Server sent a subprotocol but none was requested":t&&!o?c="Server sent no subprotocol":o&&-1===a.indexOf(o)&&(c="Server sent an invalid subprotocol"),c)x(this,s,c);else{if(o&&(this.protocol=o),g)try{const t=f.parse(e.headers["sec-websocket-extensions"]);t[u.extensionName]&&(g.accept(t[u.extensionName]),this._extensions[u.extensionName]=g)}catch(e){return void x(this,s,"Invalid Sec-WebSocket-Extensions header")}this.setSocket(s,r,0)}})}.call(this,e,t,s))}get CONNECTING(){return v.CONNECTING}get CLOSING(){return v.CLOSING}get CLOSED(){return v.CLOSED}get OPEN(){return v.OPEN}get binaryType(){return this._binaryType}set binaryType(e){p.BINARY_TYPES.indexOf(e)<0||(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?(this._socket.bufferSize||0)+this._sender._bufferedBytes:0}get extensions(){return Object.keys(this._extensions).join()}setSocket(e,t,s){const r=new d(this._binaryType,this._extensions,s);this._sender=new m(e,this._extensions),this._receiver=r,this._socket=e,r[y]=this,e[y]=this,r.on("conclude",S),r.on("drain",E),r.on("error",C),r.on("message",A),r.on("ping",O),r.on("pong",T),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",B),e.on("data",R),e.on("end",L),e.on("error",P),this.readyState=v.OPEN,this.emit("open")}emitClose(){this.readyState=v.CLOSED,this._socket?(this._extensions[u.extensionName]&&this._extensions[u.extensionName].cleanup(),this._receiver.removeAllListeners(),this.emit("close",this._closeCode,this._closeMessage)):this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==v.CLOSED){if(this.readyState===v.CONNECTING){const e="WebSocket was closed before the connection was established";return x(this,this._req,e)}this.readyState!==v.CLOSING?(this.readyState=v.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,this._socket.writable&&(this._closeFrameReceived&&this._socket.end(),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),b)))})):this._closeFrameSent&&this._closeFrameReceived&&this._socket.end()}}ping(e,t,s){if("function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),this.readyState!==v.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${g[this.readyState]})`);if(s)return s(e);throw e}"number"==typeof e&&(e=e.toString()),void 0===t&&(t=!this._isServer),this._sender.ping(e||p.EMPTY_BUFFER,t,s)}pong(e,t,s){if("function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),this.readyState!==v.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${g[this.readyState]})`);if(s)return s(e);throw e}"number"==typeof e&&(e=e.toString()),void 0===t&&(t=!this._isServer),this._sender.pong(e||p.EMPTY_BUFFER,t,s)}send(e,t,s){if("function"==typeof t&&(s=t,t={}),this.readyState!==v.OPEN){const e=new Error(`WebSocket is not open: readyState ${this.readyState} `+`(${g[this.readyState]})`);if(s)return s(e);throw e}"number"==typeof e&&(e=e.toString());const r=Object.assign({binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0},t);this._extensions[u.extensionName]||(r.compress=!1),this._sender.send(e||p.EMPTY_BUFFER,r,s)}terminate(){if(this.readyState!==v.CLOSED){if(this.readyState===v.CONNECTING){const e="WebSocket was closed before the connection was established";return x(this,this._req,e)}this._socket&&(this.readyState=v.CLOSING,this._socket.destroy())}}}function w(e){return e.path=e.socketPath||e._socketPath||void 0,a.connect(e)}function k(e){return e.path=e.socketPath||e._socketPath||void 0,e.servername=e.servername||e.host,c.connect(e)}function x(e,t,s){e.readyState=v.CLOSING;const r=new Error(s);Error.captureStackTrace(r,x),t.setHeader?(t.abort(),t.once("abort",e.emitClose.bind(e)),e.emit("error",r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function S(e,t){const s=this[y];s._socket.removeListener("data",R),s._socket.resume(),s._closeFrameReceived=!0,s._closeMessage=t,s._closeCode=e,1005===e?s.close():s.close(e,t)}function E(){this[y]._socket.resume()}function C(e){const t=this[y];t._socket.removeListener("data",R),t.readyState=v.CLOSING,t._closeCode=e[p.kStatusCode],t.emit("error",e),t._socket.destroy()}function j(){this[y].emitClose()}function A(e){this[y].emit("message",e)}function O(e){const t=this[y];t.pong(e,!t._isServer,p.NOOP),t.emit("ping",e)}function T(e){this[y].emit("pong",e)}function B(){const e=this[y];this.removeListener("close",B),this.removeListener("end",L),e.readyState=v.CLOSING,e._socket.read(),e._receiver.end(),this.removeListener("data",R),this[y]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",j),e._receiver.on("finish",j))}function R(e){this[y]._receiver.write(e)||this.pause()}function L(){const e=this[y];e.readyState=v.CLOSING,e._receiver.end(),this.end()}function P(){const e=this[y];this.removeListener("error",P),this.on("error",p.NOOP),e&&(e.readyState=v.CLOSING,this.destroy())}g.forEach((e,t)=>{v[g[t]]=t}),["open","error","close","message"].forEach(e=>{Object.defineProperty(v.prototype,`on${e}`,{get(){const t=this.listeners(e);for(var s=0;s<t.length;s++)if(t[s]._listener)return t[s]._listener},set(t){const s=this.listeners(e);for(var r=0;r<s.length;r++)s[r]._listener&&this.removeListener(e,s[r]);this.addEventListener(e,t)}})}),v.prototype.addEventListener=h.addEventListener,v.prototype.removeEventListener=h.removeEventListener,e.exports=v},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("url")},function(e,t,s){"use strict";const r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function n(e,t,s){Object.prototype.hasOwnProperty.call(e,t)?e[t].push(s):e[t]=[s]}e.exports={format:function(e){return Object.keys(e).map(t=>{var s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>[t].concat(Object.keys(e).map(t=>{var s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t={};if(void 0===e||""===e)return t;for(var s,i,o={},a=!1,c=!1,l=!1,u=-1,h=-1,f=0;f<e.length;f++){const d=e.charCodeAt(f);if(void 0===s)if(-1===h&&1===r[d])-1===u&&(u=f);else if(32===d||9===d)-1===h&&-1!==u&&(h=f);else{if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${f}`);{if(-1===u)throw new SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);const r=e.slice(u,h);44===d?(n(t,r,o),o={}):s=r,u=h=-1}}else if(void 0===i)if(-1===h&&1===r[d])-1===u&&(u=f);else if(32===d||9===d)-1===h&&-1!==u&&(h=f);else if(59===d||44===d){if(-1===u)throw new SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f),n(o,e.slice(u,h),!0),44===d&&(n(t,s,o),o={},s=void 0),u=h=-1}else{if(61!==d||-1===u||-1!==h)throw new SyntaxError(`Unexpected character at index ${f}`);i=e.slice(u,f),u=h=-1}else if(c){if(1!==r[d])throw new SyntaxError(`Unexpected character at index ${f}`);-1===u?u=f:a||(a=!0),c=!1}else if(l)if(1===r[d])-1===u&&(u=f);else if(34===d&&-1!==u)l=!1,h=f;else{if(92!==d)throw new SyntaxError(`Unexpected character at index ${f}`);c=!0}else if(34===d&&61===e.charCodeAt(f-1))l=!0;else if(-1===h&&1===r[d])-1===u&&(u=f);else if(-1===u||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${f}`);if(-1===u)throw new SyntaxError(`Unexpected character at index ${f}`);-1===h&&(h=f);var p=e.slice(u,h);a&&(p=p.replace(/\\/g,""),a=!1),n(o,i,p),44===d&&(n(t,s,o),o={},s=void 0),i=void 0,u=h=-1}else-1===h&&(h=f)}if(-1===u||l)throw new SyntaxError("Unexpected end of input");-1===h&&(h=f);const d=e.slice(u,h);return void 0===s?n(t,d,{}):(void 0===i?n(o,d,!0):n(o,i,a?d.replace(/\\/g,""):d),n(t,s,o)),t}}},function(e,t,s){"use strict";const r=s(12),n=s(8),i=s(15),o=s(32),a=s(7),c=0,l=1,u=2,h=3,f=4,p=5;function d(e,t,s,r){const n=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(n,d),n[a.kStatusCode]=r,n}function m(e,t){return 1===e.length?e[0]:e.length>1?i.concat(e,t):a.EMPTY_BUFFER}e.exports=class extends r.Writable{constructor(e,t,s){super(),this._binaryType=e||a.BINARY_TYPES[0],this[a.kWebSocket]=void 0,this._extensions=t||{},this._maxPayload=0|s,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=c,this._loop=!1}_write(e,t,s){if(8===this._opcode)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const s=this._buffers[0];e>=s.length?this._buffers.shift().copy(t,t.length-e):(s.copy(t,t.length-e,0,e),this._buffers[0]=s.slice(e)),e-=s.length}while(e>0);return t}startLoop(e){var t;this._loop=!0;do{switch(this._state){case c:t=this.getInfo();break;case l:t=this.getPayloadLength16();break;case u:t=this.getPayloadLength64();break;case h:this.getMask();break;case f:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,d(RangeError,"RSV2 and RSV3 must be clear",!0,1002);const t=64==(64&e[0]);if(t&&!this._extensions[n.extensionName])return this._loop=!1,d(RangeError,"RSV1 must be clear",!0,1002);if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,d(RangeError,"RSV1 must be clear",!0,1002);if(!this._fragmented)return this._loop=!1,d(RangeError,"invalid opcode 0",!0,1002);this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,d(RangeError,`invalid opcode ${this._opcode}`,!0,1002);this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,d(RangeError,`invalid opcode ${this._opcode}`,!0,1002);if(!this._fin)return this._loop=!1,d(RangeError,"FIN must be set",!0,1002);if(t)return this._loop=!1,d(RangeError,"RSV1 must be clear",!0,1002);if(this._payloadLength>125)return this._loop=!1,d(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002)}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),126===this._payloadLength)this._state=l;else{if(127!==this._payloadLength)return this.haveLength();this._state=u}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,d(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009)):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,d(RangeError,"Max payload size exceeded",!1,1009);this._masked?this._state=h:this._state=f}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=f)}getData(e){var t=a.EMPTY_BUFFER;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&i.unmask(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=p,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[n.extensionName].decompress(e,this._fin,(e,s)=>{if(e)return t(e);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(d(RangeError,"Max payload size exceeded",!1,1009));this._fragments.push(s)}const r=this.dataMessage();if(r)return t(r);this.startLoop(t)})}dataMessage(){if(this._fin){const s=this._messageLength,r=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){var e;e="nodebuffer"===this._binaryType?m(r,s):"arraybuffer"===this._binaryType?0===(t=m(r,s)).byteOffset&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength):r,this.emit("message",e)}else{const e=m(r,s);if(!o.isValidUTF8(e))return this._loop=!1,d(Error,"invalid UTF-8 sequence",!0,1007);this.emit("message",e.toString())}}var t;this._state=c}controlMessage(e){if(8!==this._opcode)9===this._opcode?this.emit("ping",e):this.emit("pong",e),this._state=c;else if(this._loop=!1,0===e.length)this.emit("conclude",1005,""),this.end();else{if(1===e.length)return d(RangeError,"invalid payload length 1",!0,1002);{const t=e.readUInt16BE(0);if(!o.isValidStatusCode(t))return d(RangeError,`invalid status code ${t}`,!0,1002);const s=e.slice(2);if(!o.isValidUTF8(s))return d(Error,"invalid UTF-8 sequence",!0,1007);this.emit("conclude",t,s.toString()),this.end()}}}}},function(e,t,s){"use strict";try{const e=s(!function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}());t.isValidUTF8="object"==typeof e?e.Validation.isValidUTF8:e}catch(e){t.isValidUTF8=(()=>!0)}t.isValidStatusCode=(e=>e>=1e3&&e<=1013&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999)},function(e,t,s){"use strict";const r=s(3),n=s(8),i=s(15),o=s(32),a=s(7);class c{constructor(e,t){this._extensions=t||{},this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){const s=e.length<1024||t.mask&&t.readOnly;var n=t.mask?6:2,o=e.length;e.length>=65536?(n+=8,o=127):e.length>125&&(n+=2,o=126);const a=Buffer.allocUnsafe(s?e.length+n:n);if(a[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(a[0]|=64),126===o?a.writeUInt16BE(e.length,2):127===o&&(a.writeUInt32BE(0,2),a.writeUInt32BE(e.length,6)),!t.mask)return a[1]=o,s?(e.copy(a,n),[a]):[a,e];const c=r.randomBytes(4);return a[1]=128|o,a[n-4]=c[0],a[n-3]=c[1],a[n-2]=c[2],a[n-1]=c[3],s?(i.mask(e,c,a,n,e.length),[a]):(i.mask(e,c,e,0,e.length),[a,e])}close(e,t,s,r){var n;if(void 0===e)n=a.EMPTY_BUFFER;else{if("number"!=typeof e||!o.isValidStatusCode(e))throw new TypeError("First argument must be a valid error code number");void 0===t||""===t?(n=Buffer.allocUnsafe(2)).writeUInt16BE(e,0):((n=Buffer.allocUnsafe(2+Buffer.byteLength(t))).writeUInt16BE(e,0),n.write(t,2))}this._deflating?this.enqueue([this.doClose,n,s,r]):this.doClose(n,s,r)}doClose(e,t,s){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,readOnly:!1}),s)}ping(e,t,s){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=l(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPing,e,t,r,s]):this.doPing(e,t,r,s)}doPing(e,t,s,r){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,readOnly:s}),r)}pong(e,t,s){var r=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=l(e):(e=Buffer.from(e),r=!1)),this._deflating?this.enqueue([this.doPong,e,t,r,s]):this.doPong(e,t,r,s)}doPong(e,t,s,r){this.sendFrame(c.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,readOnly:s}),r)}send(e,t,s){var r=t.binary?2:1,i=t.compress,o=!0;Buffer.isBuffer(e)||(e instanceof ArrayBuffer?e=Buffer.from(e):ArrayBuffer.isView(e)?e=l(e):(e=Buffer.from(e),o=!1));const a=this._extensions[n.extensionName];if(this._firstFragment?(this._firstFragment=!1,i&&a&&(i=e.length>=a._threshold),this._compress=i):(i=!1,r=0),t.fin&&(this._firstFragment=!0),a){const n={fin:t.fin,rsv1:i,opcode:r,mask:t.mask,readOnly:o};this._deflating?this.enqueue([this.dispatch,e,this._compress,n,s]):this.dispatch(e,this._compress,n,s)}else this.sendFrame(c.frame(e,{fin:t.fin,rsv1:!1,opcode:r,mask:t.mask,readOnly:o}),s)}dispatch(e,t,s,r){if(!t)return void this.sendFrame(c.frame(e,s),r);const i=this._extensions[n.extensionName];this._deflating=!0,i.compress(e,s.fin,(e,t)=>{s.readOnly=!1,this.sendFrame(c.frame(t,s),r),this._deflating=!1,this.dequeue()})}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,e[0].apply(this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.write(e[0]),this._socket.write(e[1],t)):this._socket.write(e[0],t)}}function l(e){const t=Buffer.from(e.buffer);return e.byteLength!==e.buffer.byteLength?t.slice(e.byteOffset,e.byteOffset+e.byteLength):t}e.exports=c},function(e,t,s){"use strict";const r=s(10),n=s(5),i=s(4),o={system:[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,r.AssertionError]};t.rethrow=function(e,t,s={}){return o.catch(e,t,s,!0)},t.ignore=function(e,t,s={}){return o.catch(e,t,s,!1)},o.catch=function(e,t,s,r){if(o.match(e,t)===r){if(s.override&&(e=s.override),s.decorate&&Object.assign(e,s.decorate),s.return)return e;throw e}},t.background=async function(e,s="rethrow",r="system",n={}){try{"function"==typeof e?await e():await e}catch(e){t[s](e,r,n)}},t.isBoom=function(e){return n.isBoom(e)},t.isError=function(e){return e instanceof Error},t.isSystem=function(e){if(!e)return!1;if(e.isBoom)return!1;for(let t=0;t<o.system.length;++t)if(e instanceof o.system[t])return!0;return!1},o.rules={system:t.isSystem,boom:t.isBoom},o.match=function(e,t){if(!t)return!0;t=Array.isArray(t)?t:[t];for(let s=0;s<t.length;++s){const r=t[s];if("string"==typeof r){if(o.rules[r](e))return!0}else if("object"==typeof r){if(i.contain(e,r,{deep:!0,part:!0}))return!0}else if(e instanceof r)return!0}return!1}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constantTree=function e(t,s=""){for(let r in t){const n=`${s}${""!==s?".":""}${r}`;"string"==typeof t[r]&&0===t[r].length?t[r]=n:"object"==typeof t[r]&&e(t[r],n)}return t}},function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))(function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):new s(function(t){t(e.value)}).then(o,a)}c((r=r.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const n=s(37);s(74).connect(class{constructor(){}entryPoint(e){return r(this,void 0,void 0,function*(){e.Service.registerService("nes","com.nucleus",{serviceDefinition:n})})}})},function(e,t,s){"use strict";const r=s(9),n=s(0),i=s(17),o=s(13),a=s(25),c=s(66),l=s(67),u={defaults:{auth:{endpoint:"/nes/auth",id:"nes.auth",type:"direct",cookie:"nes",isSecure:!0,isHttpOnly:!0,isSameSite:"Strict",path:"/",index:!1,timeout:5e3,maxConnectionsPerUser:!1},headers:null,payload:{maxChunkChars:!1},heartbeat:{interval:15e3,timeout:5e3},maxConnections:!1}};u.schema=o.object({onConnection:o.func(),onDisconnection:o.func(),onMessage:o.func(),auth:o.object({endpoint:o.string().required(),id:o.string(),type:o.valid("cookie","token","direct").required(),route:[o.object(),o.string()],cookie:o.string().required(),isSecure:o.boolean(),isHttpOnly:o.boolean(),isSameSite:o.valid("Strict","Lax").allow(!1),path:o.string().allow(null),domain:o.string().allow(null),ttl:o.number().allow(null),iron:o.object(),password:o.alternatives([o.string(),o.binary(),o.object()]),index:o.boolean(),timeout:o.number().integer().min(1).allow(!1),maxConnectionsPerUser:o.number().integer().min(1).allow(!1).when("index",{is:!0,otherwise:o.valid(!1)}),minAuthVerifyInterval:o.number().integer().allow(!1)}).allow(!1).required(),headers:o.array().items(o.string().lowercase()).min(1).allow("*",null),payload:{maxChunkChars:o.number().integer().min(1).allow(!1)},heartbeat:o.object({interval:o.number().integer().min(1).required(),timeout:o.number().integer().min(1).less(o.ref("interval")).required()}).allow(!1),maxConnections:o.number().integer().min(1).allow(!1),origin:o.array().items(o.string()).single().min(1)}).assert("auth.minAuthVerifyInterval",o.when("heartbeat",{is:!1,then:o.number().min(1),otherwise:o.number().min(o.ref("heartbeat.interval"))})),t.plugin={pkg:s(73),requirements:{hapi:">=18.0.0"},register:function(e,t){const s=n.applyToDefaults(u.defaults,t);Array.isArray(s.headers)&&(s.headers=s.headers.map(e=>e.toLowerCase())),s.auth&&void 0===s.auth.minAuthVerifyInterval&&(s.auth.minAuthVerifyInterval=s.heartbeat?s.heartbeat.interval:u.defaults.heartbeat.interval),o.assert(s,u.schema,"Invalid nes configuration"),u.auth(e,s);const r=new l(e,s);e.ext("onPreStart",()=>{r._beat(),r._stopped=!1}),e.ext("onPreStop",()=>r._close()),e.decorate("server","broadcast",l.broadcast),e.decorate("server","subscription",l.subscription),e.decorate("server","publish",l.publish),e.decorate("server","eachSocket",l.eachSocket),e.decorate("request","socket",u.socket,{apply:!0})}},c.Client.WebSocket=a,t.Client=c.Client,u.auth=function(e,t){const s=t.auth;if(s){if("direct"===s.type||s.password||(s.password=r.randomString(32)),"cookie"===s.type){const t={isSecure:s.isSecure,isHttpOnly:s.isHttpOnly,isSameSite:s.isSameSite,path:s.path,domain:s.domain,ttl:s.ttl,encoding:"iron",password:s.password,iron:s.iron};e.state(s.cookie,t)}e.route({method:"direct"===s.type?"auth":"GET",path:s.endpoint,config:{id:s.id,isInternal:"direct"===s.type,auth:s.route,handler:async(e,t)=>{if(!e.auth.isAuthenticated)return{status:"unauthenticated"};const r={credentials:e.auth.credentials,artifacts:e.auth.artifacts,strategy:e.auth.strategy};if("direct"===s.type)return r;const n={status:"authenticated"};if("cookie"===s.type)return t.response(n).state(s.cookie,r);const o=await i.seal(r,s.password,s.iron||i.defaults);return n.token=o,n}}})}},u.socket=function(e){return e.plugins.nes?e.plugins.nes.socket:null}},function(e,t,s){"use strict";const r={arrayType:Symbol("array"),bufferType:Symbol("buffer"),dateType:Symbol("date"),errorType:Symbol("error"),genericType:Symbol("generic"),mapType:Symbol("map"),regexType:Symbol("regex"),setType:Symbol("set"),weakMapType:Symbol("weak-map"),weakSetType:Symbol("weak-set"),mismatched:Symbol("mismatched")};r.typeMap={"[object Array]":r.arrayType,"[object Date]":r.dateType,"[object Error]":r.errorType,"[object Map]":r.mapType,"[object RegExp]":r.regexType,"[object Set]":r.setType,"[object WeakMap]":r.weakMapType,"[object WeakSet]":r.weakSetType},r.SeenEntry=class{constructor(e,t){this.obj=e,this.ref=t}isSame(e,t){return this.obj===e&&this.ref===t}},r.getInternalType=function(e){const{typeMap:t,bufferType:s,genericType:n}=r;return e instanceof Buffer?s:t[Object.prototype.toString.call(e)]||n},r.getSharedType=function(e,t,s){if(s)return Object.getPrototypeOf(e)!==Object.getPrototypeOf(t)?r.mismatched:r.getInternalType(e);const n=r.getInternalType(e);return n!==r.getInternalType(t)?r.mismatched:n},r.valueOf=function(e){const t=e.valueOf;if(void 0===t)return e;try{return t.call(e)}catch(e){return e}},r.hasOwnEnumerableProperty=function(e,t){return Object.prototype.propertyIsEnumerable.call(e,t)},r.isSetSimpleEqual=function(e,t){for(const s of e)if(!t.has(s))return!1;return!0},r.isDeepEqualObj=function(e,t,s,n,i){const{isDeepEqual:o,valueOf:a,hasOwnEnumerableProperty:c}=r,{keys:l,getOwnPropertySymbols:u}=Object;if(e===r.arrayType){if(!n.part){if(t.length!==s.length)return!1;for(let e=0;e<t.length;++e)if(!o(t[e],s[e],n,i))return!1;return!0}for(let e=0;e<t.length;++e){const r=t[e];for(let e=0;e<s.length;++e)if(o(r,s[e],n,i))return!0}}else if(e===r.setType){if(t.size!==s.size)return!1;if(!r.isSetSimpleEqual(t,s)){const e=new Set(s);for(const s of t){if(e.delete(s))continue;let t=!1;for(const r of e)if(o(s,r,n,i)){e.delete(r),t=!0;break}if(!t)return!1}}}else if(e===r.mapType){if(t.size!==s.size)return!1;for(const[e,r]of t){if(void 0===r&&!s.has(e))return!1;if(!o(r,s.get(e),n,i))return!1}}else if(e===r.errorType&&(t.name!==s.name||t.message!==s.message))return!1;const h=a(t),f=a(s);if((t!==h||s!==f)&&!o(h,f,n,i))return!1;const p=l(t);if(!n.part&&p.length!==l(s).length)return!1;for(let e=0;e<p.length;++e){const r=p[e];if(!c(s,r))return!1;if(!o(t[r],s[r],n,i))return!1}if(n.symbols){const e=u(t),r=new Set(u(s));for(let a=0;a<e.length;++a){const l=e[a];if(c(t,l)){if(!c(s,l))return!1;if(!o(t[l],s[l],n,i))return!1}else if(c(s,l))return!1;r.delete(l)}for(const e of r)if(c(s,e))return!1}return!0},r.isDeepEqual=function(e,t,s,n){if(e===t)return 0!==e||1/e==1/t;const i=typeof e;if(i!==typeof t)return!1;if("object"!==i||null===e||null===t)return e!=e&&t!=t;const o=r.getSharedType(e,t,!!s.prototype);switch(o){case r.bufferType:return Buffer.prototype.equals.call(e,t);case r.regexType:return e.toString()===t.toString();case r.mismatched:return!1}for(let s=n.length-1;s>=0;--s)if(n[s].isSame(e,t))return!0;n.push(new r.SeenEntry(e,t));try{return!!r.isDeepEqualObj(o,e,t,s,n)}finally{n.pop()}},e.exports=function(e,t,s){return s=s||{prototype:!0},!!r.isDeepEqual(e,t,s,[])}},function(e,t,s){"use strict";const r={};t.escapeHtml=function(e){if(!e)return"";let t="";for(let s=0;s<e.length;++s){const n=e.charCodeAt(s);r.isSafe(n)?t+=e[s]:t+=r.escapeHtmlChar(n)}return t},t.escapeJson=function(e){if(!e)return"";let t;return e.replace(/[<>&\u2028\u2029]/g,e=>60===(t=e.charCodeAt(0))?"\\u003c":62===t?"\\u003e":38===t?"\\u0026":8232===t?"\\u2028":"\\u2029")},r.escapeHtmlChar=function(e){const t=r.namedHtml[e];return void 0!==t?t:e>=256?"&#"+e+";":`&#x${Buffer.from(String.fromCharCode(e),"ascii").toString("hex")};`},r.isSafe=function(e){return void 0!==r.safeCharCodes[e]},r.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"},r.safeCharCodes=function(){const e={};for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&(e[t]=null);return e}()},function(e,t,s){"use strict";const r={};t.escapeJavaScript=function(e){if(!e)return"";let t="";for(let s=0;s<e.length;++s){const n=e.charCodeAt(s);r.isSafe(n)?t+=e[s]:t+=r.escapeJavaScriptChar(n)}return t},t.escapeHtml=function(e){if(!e)return"";let t="";for(let s=0;s<e.length;++s){const n=e.charCodeAt(s);r.isSafe(n)?t+=e[s]:t+=r.escapeHtmlChar(n)}return t},t.escapeJson=function(e){if(!e)return"";let t;return e.replace(/[<>&\u2028\u2029]/g,e=>60===(t=e.charCodeAt(0))?"\\u003c":62===t?"\\u003e":38===t?"\\u0026":8232===t?"\\u2028":"\\u2029")},r.escapeJavaScriptChar=function(e){if(e>=256)return"\\u"+r.padLeft(""+e,4);const t=Buffer.from(String.fromCharCode(e),"ascii").toString("hex");return"\\x"+r.padLeft(t,2)},r.escapeHtmlChar=function(e){const t=r.namedHtml[e];if(void 0!==t)return t;if(e>=256)return"&#"+e+";";const s=Buffer.from(String.fromCharCode(e),"ascii").toString("hex");return"&#x"+r.padLeft(s,2)+";"},r.padLeft=function(e,t){for(;e.length<t;)e="0"+e;return e},r.isSafe=function(e){return void 0!==r.safeCharCodes[e]},r.namedHtml={38:"&amp;",60:"&lt;",62:"&gt;",34:"&quot;",160:"&nbsp;",162:"&cent;",163:"&pound;",164:"&curren;",169:"&copy;",174:"&reg;"},r.safeCharCodes=function(){const e={};for(let t=32;t<123;++t)(t>=97||t>=65&&t<=90||t>=48&&t<=57||32===t||46===t||44===t||45===t||58===t||95===t)&&(e[t]=null);return e}()},function(e,t,s){"use strict";const r=s(4),n=s(42),i=s(43);t.decode=n.decode,t.encode=i.encode,t.Decoder=n.Decoder,t.Encoder=i.Encoder,t.base64urlEncode=function(e,t){return r.assert("string"==typeof e||Buffer.isBuffer(e),"value must be string or buffer"),(Buffer.isBuffer(e)?e:Buffer.from(e,t||"binary")).toString("base64").replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")},t.base64urlDecode=function(e,t){if("string"!=typeof e)throw new Error("Value not a string");if(!/^[\w\-]*$/.test(e))throw new Error("Invalid character");const s=Buffer.from(e,"base64");return"buffer"===t?s:s.toString(t||"binary")}},function(e,t,s){"use strict";const r=s(12),n=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];t.decode=function(e){const t=n,s=e.length,r=3*Math.ceil(s/4),i=Buffer.alloc(r);let o,a,c,l,u=0;for(let r=0;r<s;){do{o=t[255&e[r++]]}while(r<s&&-1===o);if(-1===o)break;do{a=t[255&e[r++]]}while(r<s&&-1===a);if(-1===a)break;i[u++]=o<<2|(48&a)>>4;do{if(61===(c=255&e[r++]))return i.slice(0,u);c=t[c]}while(r<s&&-1===c);if(-1===c)break;i[u++]=(15&a)<<4|(60&c)>>2;do{if(61===(l=255&e[r++]))return i.slice(0,u);l=t[l]}while(r<s&&-1===l);-1!==l&&(i[u++]=(3&c)<<6|l)}return u===r?i:i.slice(0,u)},t.Decoder=class extends r.Transform{constructor(){super(),this._reminder=null}_transform(e,s,r){let n=this._reminder?Buffer.concat([this._reminder,e]):e;const i=n.length%4;return i?(this._reminder=n.slice(n.length-i),n=n.slice(0,n.length-i)):this._reminder=null,this.push(t.decode(n)),r()}_flush(e){return this._reminder&&this.push(t.decode(this._reminder)),e()}}},function(e,t,s){"use strict";const r=s(12);t.encode=function(e){return Buffer.from(e.toString("base64"))},t.Encoder=class extends r.Transform{constructor(){super(),this._reminder=null}_transform(e,s,r){let n=this._reminder?Buffer.concat([this._reminder,e]):e;const i=n.length%3;return i?(this._reminder=n.slice(n.length-i),n=n.slice(0,n.length-i)):this._reminder=null,this.push(t.encode(n)),r()}_flush(e){return this._reminder&&this.push(t.encode(this._reminder)),e()}}},function(e,t,s){"use strict";t.errors={root:"value",key:'"{{!label}}" ',messages:{wrapArrays:!0},any:{unknown:"is not allowed",invalid:"contains an invalid value",empty:"is not allowed to be empty",required:"is required",allowOnly:"must be one of {{valids}}",default:"threw an error when running default method"},alternatives:{base:"not matching any of the allowed alternatives",child:null},array:{base:"must be an array",includes:"at position {{pos}} does not match any of the allowed types",includesSingle:'single value of "{{!label}}" does not match any of the allowed types',includesOne:"at position {{pos}} fails because {{reason}}",includesOneSingle:'single value of "{{!label}}" fails because {{reason}}',includesRequiredUnknowns:"does not contain {{unknownMisses}} required value(s)",includesRequiredKnowns:"does not contain {{knownMisses}}",includesRequiredBoth:"does not contain {{knownMisses}} and {{unknownMisses}} other required value(s)",excludes:"at position {{pos}} contains an excluded value",excludesSingle:'single value of "{{!label}}" contains an excluded value',min:"must contain at least {{limit}} items",max:"must contain less than or equal to {{limit}} items",length:"must contain {{limit}} items",ordered:"at position {{pos}} fails because {{reason}}",orderedLength:"at position {{pos}} fails because array must contain at most {{limit}} items",ref:'references "{{ref}}" which is not a positive integer',sparse:"must not be a sparse array",unique:"position {{pos}} contains a duplicate value"},boolean:{base:"must be a boolean"},binary:{base:"must be a buffer or a string",min:"must be at least {{limit}} bytes",max:"must be less than or equal to {{limit}} bytes",length:"must be {{limit}} bytes"},date:{base:"must be a number of milliseconds or valid date string",format:"must be a string with one of the following formats {{format}}",strict:"must be a valid date",min:'must be larger than or equal to "{{limit}}"',max:'must be less than or equal to "{{limit}}"',less:'must be less than "{{limit}}"',greater:'must be greater than "{{limit}}"',isoDate:"must be a valid ISO 8601 date",timestamp:{javascript:"must be a valid timestamp or number of milliseconds",unix:"must be a valid timestamp or number of seconds"},ref:'references "{{ref}}" which is not a date'},function:{base:"must be a Function",arity:"must have an arity of {{n}}",minArity:"must have an arity greater or equal to {{n}}",maxArity:"must have an arity lesser or equal to {{n}}",ref:"must be a Joi reference",class:"must be a class"},lazy:{base:"!!schema error: lazy schema must be set",schema:"!!schema error: lazy schema function must return a schema"},object:{base:"must be an object",child:'!!child "{{!child}}" fails because {{reason}}',min:"must have at least {{limit}} children",max:"must have less than or equal to {{limit}} children",length:"must have {{limit}} children",allowUnknown:'!!"{{!child}}" is not allowed',with:'!!"{{mainWithLabel}}" missing required peer "{{peerWithLabel}}"',without:'!!"{{mainWithLabel}}" conflict with forbidden peer "{{peerWithLabel}}"',missing:"must contain at least one of {{peersWithLabels}}",xor:"contains a conflict between exclusive peers {{peersWithLabels}}",or:"must contain at least one of {{peersWithLabels}}",and:"contains {{presentWithLabels}} without its required peers {{missingWithLabels}}",nand:'!!"{{mainWithLabel}}" must not exist simultaneously with {{peersWithLabels}}',assert:'!!"{{ref}}" validation failed because "{{ref}}" failed to {{message}}',rename:{multiple:'cannot rename child "{{from}}" because multiple renames are disabled and another key was already renamed to "{{to}}"',override:'cannot rename child "{{from}}" because override is disabled and target "{{to}}" exists',regex:{multiple:'cannot rename children {{from}} because multiple renames are disabled and another key was already renamed to "{{to}}"',override:'cannot rename children {{from}} because override is disabled and target "{{to}}" exists'}},type:'must be an instance of "{{type}}"',schema:"must be a Joi instance"},number:{base:"must be a number",min:"must be larger than or equal to {{limit}}",max:"must be less than or equal to {{limit}}",less:"must be less than {{limit}}",greater:"must be greater than {{limit}}",float:"must be a float or double",integer:"must be an integer",negative:"must be a negative number",positive:"must be a positive number",precision:"must have no more than {{limit}} decimal places",ref:'references "{{ref}}" which is not a number',multiple:"must be a multiple of {{multiple}}",port:"must be a valid port"},string:{base:"must be a string",min:"length must be at least {{limit}} characters long",max:"length must be less than or equal to {{limit}} characters long",length:"length must be {{limit}} characters long",alphanum:"must only contain alpha-numeric characters",token:"must only contain alpha-numeric and underscore characters",regex:{base:'with value "{{!value}}" fails to match the required pattern: {{pattern}}',name:'with value "{{!value}}" fails to match the {{name}} pattern',invert:{base:'with value "{{!value}}" matches the inverted pattern: {{pattern}}',name:'with value "{{!value}}" matches the inverted {{name}} pattern'}},email:"must be a valid email",uri:"must be a valid uri",uriRelativeOnly:"must be a valid relative uri",uriCustomScheme:"must be a valid uri with a scheme matching the {{scheme}} pattern",isoDate:"must be a valid ISO 8601 date",guid:"must be a valid GUID",hex:"must only contain hexadecimal characters",hexAlign:"hex decoded representation must be byte aligned",base64:"must be a valid base64 string",dataUri:"must be a valid dataUri string",hostname:"must be a valid hostname",normalize:"must be unicode normalized in the {{form}} form",lowercase:"must only contain lowercase characters",uppercase:"must only contain uppercase characters",trim:"must not have leading or trailing whitespace",creditCard:"must be a credit card",ref:'references "{{ref}}" which is not a number',ip:"must be a valid ip address with a {{cidr}} CIDR",ipVersion:"must be a valid ip address of one of the following versions {{version}} with a {{cidr}} CIDR"},symbol:{base:"must be a symbol",map:"must be one of {{map}}"}}},function(e,t,s){"use strict";const r=s(13);t.options=r.object({abortEarly:r.boolean(),convert:r.boolean(),allowUnknown:r.boolean(),skipFunctions:r.boolean(),stripUnknown:[r.boolean(),r.object({arrays:r.boolean(),objects:r.boolean()}).or("arrays","objects")],language:r.object(),presence:r.string().only("required","optional","forbidden","ignore"),raw:r.boolean(),context:r.object(),strip:r.boolean(),noDefaults:r.boolean(),escapeHtml:r.boolean()}).strict()},function(e,t,s){"use strict";const r=s(1),n=s(0),i={};i.Lazy=class extends r{constructor(){super(),this._type="lazy"}_base(e,t,s){const n={value:e},i=this._flags.lazy;if(!i)return n.errors=this.createError("lazy.base",null,t,s),n;const o=i();return o instanceof r?o._validate(e,t,s):(n.errors=this.createError("lazy.schema",null,t,s),n)}set(e){n.assert("function"==typeof e,"You must provide a function as first argument");const t=this.clone();return t._flags.lazy=e,t}},e.exports=new i.Lazy},function(e,t,s){"use strict";const r=s(1),n=s(6),i=s(2),o=s(0),a={fastSplice:function(e,t){let s=t;for(;s<e.length;)e[s++]=e[s];--e.length}};a.Array=class extends r{constructor(){super(),this._type="array",this._inner.items=[],this._inner.ordereds=[],this._inner.inclusions=[],this._inner.exclusions=[],this._inner.requireds=[],this._flags.sparse=!1}_base(e,t,s){const r={value:e};"string"==typeof e&&s.convert&&a.safeParse(e,r);let n=Array.isArray(r.value);const i=n;if(s.convert&&this._flags.single&&!n&&(r.value=[r.value],n=!0),!n)return r.errors=this.createError("array.base",null,t,s),r;if((this._inner.inclusions.length||this._inner.exclusions.length||this._inner.requireds.length||this._inner.ordereds.length||!this._flags.sparse)&&(i&&(r.value=r.value.slice(0)),r.errors=this._checkItems.call(this,r.value,i,t,s),r.errors&&i&&s.convert&&this._flags.single)){const e=r.errors;r.value=[r.value],r.errors=this._checkItems.call(this,r.value,i,t,s),r.errors&&(r.errors=e,r.value=r.value[0])}return r}_checkItems(e,t,s,r){const n=[];let i;const o=this._inner.requireds.slice(),c=this._inner.ordereds.slice(),l=this._inner.inclusions.concat(o);let u=e.length;for(let h=0;h<u;++h){i=!1;const f=e[h];let p=!1;const d={key:t?h:s.key,path:t?s.path.concat(h):s.path,parent:s.parent,reference:s.reference};let m;if(!this._flags.sparse&&void 0===f){if(n.push(this.createError("array.sparse",null,{key:s.key,path:d.path,pos:h},r)),r.abortEarly)return n;c.shift();continue}for(let e=0;e<this._inner.exclusions.length;++e)if(!(m=this._inner.exclusions[e]._validate(f,d,{})).errors){if(n.push(this.createError(t?"array.excludes":"array.excludesSingle",{pos:h,value:f},{key:s.key,path:d.path},r)),i=!0,r.abortEarly)return n;c.shift();break}if(i)continue;if(this._inner.ordereds.length){if(c.length>0){const t=c.shift();if((m=t._validate(f,d,r)).errors){if(n.push(this.createError("array.ordered",{pos:h,reason:m.errors,value:f},{key:s.key,path:d.path},r)),r.abortEarly)return n}else if(t._flags.strip)a.fastSplice(e,h),--h,--u;else{if(!this._flags.sparse&&void 0===m.value){if(n.push(this.createError("array.sparse",null,{key:s.key,path:d.path,pos:h},r)),r.abortEarly)return n;continue}e[h]=m.value}continue}if(!this._inner.items.length){if(n.push(this.createError("array.orderedLength",{pos:h,limit:this._inner.ordereds.length},{key:s.key,path:d.path},r)),r.abortEarly)return n;continue}}const g=[];let y=o.length;for(let t=0;t<y;++t)if(!(m=g[t]=o[t]._validate(f,d,r)).errors){if(e[h]=m.value,p=!0,a.fastSplice(o,t),--t,--y,!this._flags.sparse&&void 0===m.value&&(n.push(this.createError("array.sparse",null,{key:s.key,path:d.path,pos:h},r)),r.abortEarly))return n;break}if(p)continue;const _=!!r.stripUnknown&&(!0===r.stripUnknown||!!r.stripUnknown.arrays);y=l.length;for(let c=0;c<y;++c){const b=l[c],v=o.indexOf(b);if(-1!==v)m=g[v];else if(!(m=b._validate(f,d,r)).errors){b._flags.strip?(a.fastSplice(e,h),--h,--u):this._flags.sparse||void 0!==m.value?e[h]=m.value:(n.push(this.createError("array.sparse",null,{key:s.key,path:d.path,pos:h},r)),i=!0),p=!0;break}if(1===y){if(_){a.fastSplice(e,h),--h,--u,p=!0;break}if(n.push(this.createError(t?"array.includesOne":"array.includesOneSingle",{pos:h,reason:m.errors,value:f},{key:s.key,path:d.path},r)),i=!0,r.abortEarly)return n;break}}if(!i&&(this._inner.inclusions.length&&!p)){if(_){a.fastSplice(e,h),--h,--u;continue}if(n.push(this.createError(t?"array.includes":"array.includesSingle",{pos:h,value:f},{key:s.key,path:d.path},r)),r.abortEarly)return n}}return o.length&&this._fillMissedErrors.call(this,n,o,s,r),c.length&&this._fillOrderedErrors.call(this,n,c,s,r),n.length?n:null}describe(){const e=super.describe();if(this._inner.ordereds.length){e.orderedItems=[];for(let t=0;t<this._inner.ordereds.length;++t)e.orderedItems.push(this._inner.ordereds[t].describe())}if(this._inner.items.length){e.items=[];for(let t=0;t<this._inner.items.length;++t)e.items.push(this._inner.items[t].describe())}return e}items(...e){const t=this.clone();return o.flatten(e).forEach((e,s)=>{try{e=n.schema(this._currentJoi,e)}catch(e){throw e.hasOwnProperty("path")?e.path=s+"."+e.path:e.path=s,e.message=e.message+"("+e.path+")",e}t._inner.items.push(e),"required"===e._flags.presence?t._inner.requireds.push(e):"forbidden"===e._flags.presence?t._inner.exclusions.push(e.optional()):t._inner.inclusions.push(e)}),t}ordered(...e){const t=this.clone();return o.flatten(e).forEach((e,s)=>{try{e=n.schema(this._currentJoi,e)}catch(e){throw e.hasOwnProperty("path")?e.path=s+"."+e.path:e.path=s,e.message=e.message+"("+e.path+")",e}t._inner.ordereds.push(e)}),t}min(e){const t=i.isRef(e);return o.assert(Number.isSafeInteger(e)&&e>=0||t,"limit must be a positive integer or reference"),this._test("min",e,function(s,r,n){let i;if(t){if(i=e(r.reference||r.parent,n),!(Number.isSafeInteger(i)&&i>=0))return this.createError("array.ref",{ref:e.key},r,n)}else i=e;return s.length>=i?s:this.createError("array.min",{limit:e,value:s},r,n)})}max(e){const t=i.isRef(e);return o.assert(Number.isSafeInteger(e)&&e>=0||t,"limit must be a positive integer or reference"),this._test("max",e,function(s,r,n){let i;if(t){if(i=e(r.reference||r.parent,n),!(Number.isSafeInteger(i)&&i>=0))return this.createError("array.ref",{ref:e.key},r,n)}else i=e;return s.length<=i?s:this.createError("array.max",{limit:e,value:s},r,n)})}length(e){const t=i.isRef(e);return o.assert(Number.isSafeInteger(e)&&e>=0||t,"limit must be a positive integer or reference"),this._test("length",e,function(s,r,n){let i;if(t){if(i=e(r.reference||r.parent,n),!(Number.isSafeInteger(i)&&i>=0))return this.createError("array.ref",{ref:e.key},r,n)}else i=e;return s.length===i?s:this.createError("array.length",{limit:e,value:s},r,n)})}unique(e,t){o.assert(void 0===e||"function"==typeof e||"string"==typeof e,"comparator must be a function or a string"),o.assert(void 0===t||"object"==typeof t,"configs must be an object");const s={ignoreUndefined:t&&t.ignoreUndefined||!1};return"string"==typeof e?s.path=e:"function"==typeof e&&(s.comparator=e),this._test("unique",s,function(e,t,r){const n={string:Object.create(null),number:Object.create(null),undefined:Object.create(null),boolean:Object.create(null),object:new Map,function:new Map,custom:new Map},i=s.comparator||o.deepEqual,a=s.ignoreUndefined;for(let c=0;c<e.length;++c){const l=s.path?o.reach(e[c],s.path):e[c],u=s.comparator?n.custom:n[typeof l];if(u)if(u instanceof Map){const n=u.entries();let o;for(;!(o=n.next()).done;)if(i(o.value[0],l)){const n={key:t.key,path:t.path.concat(c),parent:t.parent,reference:t.reference},i={pos:c,value:e[c],dupePos:o.value[1],dupeValue:e[o.value[1]]};return s.path&&(i.path=s.path),this.createError("array.unique",i,n,r)}u.set(l,c)}else{if((!a||void 0!==l)&&void 0!==u[l]){const n={key:t.key,path:t.path.concat(c),parent:t.parent,reference:t.reference},i={pos:c,value:e[c],dupePos:u[l],dupeValue:e[u[l]]};return s.path&&(i.path=s.path),this.createError("array.unique",i,n,r)}u[l]=c}}return e})}sparse(e){const t=void 0===e||!!e;if(this._flags.sparse===t)return this;const s=this.clone();return s._flags.sparse=t,s}single(e){const t=void 0===e||!!e;if(this._flags.single===t)return this;const s=this.clone();return s._flags.single=t,s}_fillMissedErrors(e,t,s,r){const n=[];let i=0;for(let e=0;e<t.length;++e){const s=t[e]._getLabel();s?n.push(s):++i}n.length?i?e.push(this.createError("array.includesRequiredBoth",{knownMisses:n,unknownMisses:i},{key:s.key,path:s.path},r)):e.push(this.createError("array.includesRequiredKnowns",{knownMisses:n},{key:s.key,path:s.path},r)):e.push(this.createError("array.includesRequiredUnknowns",{unknownMisses:i},{key:s.key,path:s.path},r))}_fillOrderedErrors(e,t,s,r){const n=[];for(let e=0;e<t.length;++e){"required"===o.reach(t[e],"_flags.presence")&&n.push(t[e])}n.length&&this._fillMissedErrors.call(this,e,n,s,r)}},a.safeParse=function(e,t){try{const s=JSON.parse(e);Array.isArray(s)&&(t.value=s)}catch(e){}},e.exports=new a.Array},function(e,t,s){"use strict";const r=s(1),n=s(0),i={Set:s(19)};i.Boolean=class extends r{constructor(){super(),this._type="boolean",this._flags.insensitive=!0,this._inner.truthySet=new i.Set,this._inner.falsySet=new i.Set}_base(e,t,s){const r={value:e};if("string"==typeof e&&s.convert){const t=this._flags.insensitive?e.toLowerCase():e;r.value="true"===t||"false"!==t&&e}return"boolean"!=typeof r.value&&(r.value=!!this._inner.truthySet.has(e,null,null,this._flags.insensitive)||!this._inner.falsySet.has(e,null,null,this._flags.insensitive)&&e),r.errors="boolean"==typeof r.value?null:this.createError("boolean.base",null,t,s),r}truthy(...e){const t=this.clone();e=n.flatten(e);for(let s=0;s<e.length;++s){const r=e[s];n.assert(void 0!==r,"Cannot call truthy with undefined"),t._inner.truthySet.add(r)}return t}falsy(...e){const t=this.clone();e=n.flatten(e);for(let s=0;s<e.length;++s){const r=e[s];n.assert(void 0!==r,"Cannot call falsy with undefined"),t._inner.falsySet.add(r)}return t}insensitive(e){const t=void 0===e||!!e;if(this._flags.insensitive===t)return this;const s=this.clone();return s._flags.insensitive=t,s}describe(){const e=super.describe();return e.truthy=[!0].concat(this._inner.truthySet.values()),e.falsy=[!1].concat(this._inner.falsySet.values()),e}},e.exports=new i.Boolean},function(e,t,s){"use strict";const r=s(1),n=s(0),i={};i.Binary=class extends r{constructor(){super(),this._type="binary"}_base(e,t,s){const r={value:e};if("string"==typeof e&&s.convert)try{r.value=Buffer.from(e,this._flags.encoding)}catch(e){}return r.errors=Buffer.isBuffer(r.value)?null:this.createError("binary.base",null,t,s),r}encoding(e){if(n.assert(Buffer.isEncoding(e),"Invalid encoding:",e),this._flags.encoding===e)return this;const t=this.clone();return t._flags.encoding=e,t}min(e){return n.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("min",e,function(t,s,r){return t.length>=e?t:this.createError("binary.min",{limit:e,value:t},s,r)})}max(e){return n.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("max",e,function(t,s,r){return t.length<=e?t:this.createError("binary.max",{limit:e,value:t},s,r)})}length(e){return n.assert(Number.isSafeInteger(e)&&e>=0,"limit must be a positive integer"),this._test("length",e,function(t,s,r){return t.length===e?t:this.createError("binary.length",{limit:e,value:t},s,r)})}},e.exports=new i.Binary},function(e,t,s){"use strict";const r=s(0),n=s(22),i=s(2),o={};o.Func=class extends n.constructor{constructor(){super(),this._flags.func=!0}arity(e){return r.assert(Number.isSafeInteger(e)&&e>=0,"n must be a positive integer"),this._test("arity",e,function(t,s,r){return t.length===e?t:this.createError("function.arity",{n:e},s,r)})}minArity(e){return r.assert(Number.isSafeInteger(e)&&e>0,"n must be a strict positive integer"),this._test("minArity",e,function(t,s,r){return t.length>=e?t:this.createError("function.minArity",{n:e},s,r)})}maxArity(e){return r.assert(Number.isSafeInteger(e)&&e>=0,"n must be a positive integer"),this._test("maxArity",e,function(t,s,r){return t.length<=e?t:this.createError("function.maxArity",{n:e},s,r)})}ref(){return this._test("ref",null,function(e,t,s){return i.isRef(e)?e:this.createError("function.ref",null,t,s)})}class(){return this._test("class",null,function(e,t,s){return/^\s*class\s/.test(e.toString())?e:this.createError("function.class",null,t,s)})}},e.exports=new o.Func},function(e,t,s){"use strict";const r=s(4),n={};e.exports=class{constructor(){this._items=[],this.nodes=[]}add(e,t){const s=[].concat((t=t||{}).before||[]),n=[].concat(t.after||[]),i=t.group||"?",o=t.sort||0;r.assert(!s.includes(i),`Item cannot come before itself: ${i}`),r.assert(!s.includes("?"),"Item cannot come before unassociated items"),r.assert(!n.includes(i),`Item cannot come after itself: ${i}`),r.assert(!n.includes("?"),"Item cannot come after unassociated items"),[].concat(e).forEach((e,t)=>{const r={seq:this._items.length,sort:o,before:s,after:n,group:i,node:e};this._items.push(r)});const a=this._sort();return r.assert(!a,"item","?"!==i?`added into group ${i}`:"","created a dependencies error"),this.nodes}merge(e){e=[].concat(e);for(let t=0;t<e.length;++t){const s=e[t];if(s)for(let e=0;e<s._items.length;++e){const t=Object.assign({},s._items[e]);this._items.push(t)}}this._items.sort(n.mergeSort);for(let e=0;e<this._items.length;++e)this._items[e].seq=e;const t=this._sort();return r.assert(!t,"merge created a dependencies error"),this.nodes}_sort(){const e={},t=Object.create(null),s=Object.create(null);for(let r=0;r<this._items.length;++r){const n=this._items[r],i=n.seq,o=n.group;s[o]=s[o]||[],s[o].push(i),e[i]=n.before;const a=n.after;for(let e=0;e<a.length;++e)t[a[e]]=(t[a[e]]||[]).concat(i)}let r=Object.keys(e);for(let t=0;t<r.length;++t){const n=r[t],i=[],o=Object.keys(e[n]);for(let t=0;t<o.length;++t){const r=e[n][o[t]];s[r]=s[r]||[];for(let e=0;e<s[r].length;++e)i.push(s[r][e])}e[n]=i}const n=Object.keys(t);for(let r=0;r<n.length;++r){const i=n[r];if(s[i])for(let r=0;r<s[i].length;++r){const n=s[i][r];e[n]=e[n].concat(t[i])}}let i;const o={};r=Object.keys(e);for(let t=0;t<r.length;++t){const s=r[t];i=e[s];for(let e=0;e<i.length;++e)o[i[e]]=(o[i[e]]||[]).concat(s)}const a={},c=[];for(let e=0;e<this._items.length;++e){let t=e;if(o[e]){t=null;for(let e=0;e<this._items.length;++e){if(!0===a[e])continue;o[e]||(o[e]=[]);const s=o[e].length;let r=0;for(let t=0;t<s;++t)a[o[e][t]]&&++r;if(r===s){t=e;break}}}null!==t&&(a[t]=!0,c.push(t))}if(c.length!==this._items.length)return new Error("Invalid dependencies");const l={};for(let e=0;e<this._items.length;++e){const t=this._items[e];l[t.seq]=t}const u=[];this._items=c.map(e=>{const t=l[e];return u.push(t.node),t}),this.nodes=u}},n.mergeSort=((e,t)=>e.sort===t.sort?0:e.sort<t.sort?-1:1)},function(e,t,s){"use strict";const r=s(1),n=s(2),i=s(0),o={precisionRx:/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/};o.Number=class extends r{constructor(){super(),this._type="number",this._invalids.add(1/0),this._invalids.add(-1/0)}_base(e,t,s){const r={errors:null,value:e};if("string"==typeof e&&s.convert){const t=parseFloat(e);r.value=isNaN(t)||!isFinite(e)?NaN:t}const n="number"==typeof r.value&&!isNaN(r.value);if(s.convert&&"precision"in this._flags&&n){const e=Math.pow(10,this._flags.precision);r.value=Math.round(r.value*e)/e}return r.errors=n?null:this.createError("number.base",{value:e},t,s),r}multiple(e){const t=n.isRef(e);return t||(i.assert("number"==typeof e&&isFinite(e),"multiple must be a number"),i.assert(e>0,"multiple must be greater than 0")),this._test("multiple",e,function(s,r,n){const i=t?e(r.reference||r.parent,n):e;return!t||"number"==typeof i&&isFinite(i)?s%i==0?s:this.createError("number.multiple",{multiple:e,value:s},r,n):this.createError("number.ref",{ref:e.key},r,n)})}integer(){return this._test("integer",void 0,function(e,t,s){return Number.isSafeInteger(e)?e:this.createError("number.integer",{value:e},t,s)})}negative(){return this._test("negative",void 0,function(e,t,s){return e<0?e:this.createError("number.negative",{value:e},t,s)})}positive(){return this._test("positive",void 0,function(e,t,s){return e>0?e:this.createError("number.positive",{value:e},t,s)})}precision(e){i.assert(Number.isSafeInteger(e),"limit must be an integer"),i.assert(!("precision"in this._flags),"precision already set");const t=this._test("precision",e,function(t,s,r){const n=t.toString().match(o.precisionRx);return Math.max((n[1]?n[1].length:0)-(n[2]?parseInt(n[2],10):0),0)<=e?t:this.createError("number.precision",{limit:e,value:t},s,r)});return t._flags.precision=e,t}port(){return this._test("port",void 0,function(e,t,s){return!Number.isSafeInteger(e)||e<0||e>65535?this.createError("number.port",{value:e},t,s):e})}},o.compare=function(e,t){return function(s){const r=n.isRef(s),o="number"==typeof s&&!isNaN(s);return i.assert(o||r,"limit must be a number or reference"),this._test(e,s,function(n,i,o){let a;if(r){if("number"!=typeof(a=s(i.reference||i.parent,o))||isNaN(a))return this.createError("number.ref",{ref:s.key},i,o)}else a=s;return t(n,a)?n:this.createError("number."+e,{limit:a,value:n},i,o)})}},o.Number.prototype.min=o.compare("min",(e,t)=>e>=t),o.Number.prototype.max=o.compare("max",(e,t)=>e<=t),o.Number.prototype.greater=o.compare("greater",(e,t)=>e>t),o.Number.prototype.less=o.compare("less",(e,t)=>e<t),e.exports=new o.Number},function(e,t,s){"use strict";const r=s(23),n=s(0);let i;const o=s(1),a=s(2),c=s(21),l=s(54),u=s(55),h={uriRegex:l.createUriRegex(),ipRegex:u.createIpRegex(["ipv4","ipv6","ipvfuture"],"optional"),guidBrackets:{"{":"}","[":"]","(":")","":""},guidVersions:{uuidv1:"1",uuidv2:"2",uuidv3:"3",uuidv4:"4",uuidv5:"5"},cidrPresences:["required","optional","forbidden"],normalizationForms:["NFC","NFD","NFKC","NFKD"]};h.String=class extends o{constructor(){super(),this._type="string",this._invalids.add("")}_base(e,t,s){if("string"==typeof e&&s.convert){if(this._flags.normalize&&(e=e.normalize(this._flags.normalize)),this._flags.case&&(e="upper"===this._flags.case?e.toLocaleUpperCase():e.toLocaleLowerCase()),this._flags.trim&&(e=e.trim()),this._inner.replacements)for(let t=0;t<this._inner.replacements.length;++t){const s=this._inner.replacements[t];e=e.replace(s.pattern,s.replacement)}if(this._flags.truncate)for(let t=0;t<this._tests.length;++t){const s=this._tests[t];if("max"===s.name){e=e.slice(0,s.arg);break}}this._flags.byteAligned&&e.length%2!=0&&(e=`0${e}`)}return{value:e,errors:"string"==typeof e?null:this.createError("string.base",{value:e},t,s)}}insensitive(){if(this._flags.insensitive)return this;const e=this.clone();return e._flags.insensitive=!0,e}creditCard(){return this._test("creditCard",void 0,function(e,t,s){let r=e.length,n=0,i=1;for(;r--;){const t=e.charAt(r)*i;n+=t-9*(t>9),i^=3}return n%10==0&&n>0?e:this.createError("string.creditCard",{value:e},t,s)})}regex(e,t){n.assert(e instanceof RegExp,"pattern must be a RegExp");const s={pattern:new RegExp(e.source,e.ignoreCase?"i":void 0)};"string"==typeof t?s.name=t:"object"==typeof t&&(s.invert=!!t.invert,t.name&&(s.name=t.name));const r=["string.regex",s.invert?".invert":"",s.name?".name":".base"].join("");return this._test("regex",s,function(e,t,n){return s.pattern.test(e)^s.invert?e:this.createError(r,{name:s.name,pattern:s.pattern,value:e},t,n)})}alphanum(){return this._test("alphanum",void 0,function(e,t,s){return/^[a-zA-Z0-9]+$/.test(e)?e:this.createError("string.alphanum",{value:e},t,s)})}token(){return this._test("token",void 0,function(e,t,s){return/^\w+$/.test(e)?e:this.createError("string.token",{value:e},t,s)})}email(e){return e&&(n.assert("object"==typeof e,"email options must be an object"),n.assert(void 0===e.checkDNS,"checkDNS option is not supported"),n.assert(void 0===e.tldWhitelist||"object"==typeof e.tldWhitelist,"tldWhitelist must be an array or object"),n.assert(void 0===e.minDomainAtoms||Number.isSafeInteger(e.minDomainAtoms)&&e.minDomainAtoms>0,"minDomainAtoms must be a positive integer"),n.assert(void 0===e.errorLevel||"boolean"==typeof e.errorLevel||Number.isSafeInteger(e.errorLevel)&&e.errorLevel>=0,"errorLevel must be a non-negative integer or boolean")),this._test("email",e,function(t,r,n){i=i||s(56);try{const s=i.validate(t,e);if(!0===s||0===s)return t}catch(e){}return this.createError("string.email",{value:t},r,n)})}ip(e={}){let t,s=h.ipRegex;if(n.assert("object"==typeof e,"options must be an object"),e.cidr?(n.assert("string"==typeof e.cidr,"cidr must be a string"),e.cidr=e.cidr.toLowerCase(),n.assert(n.contain(h.cidrPresences,e.cidr),"cidr must be one of "+h.cidrPresences.join(", ")),e.version||"optional"===e.cidr||(s=u.createIpRegex(["ipv4","ipv6","ipvfuture"],e.cidr))):e.cidr="optional",e.version){Array.isArray(e.version)||(e.version=[e.version]),n.assert(e.version.length>=1,"version must have at least 1 version specified"),t=[];for(let s=0;s<e.version.length;++s){let r=e.version[s];n.assert("string"==typeof r,"version at position "+s+" must be a string"),r=r.toLowerCase(),n.assert(u.versions[r],"version at position "+s+" must be one of "+Object.keys(u.versions).join(", ")),t.push(r)}t=n.unique(t),s=u.createIpRegex(t,e.cidr)}return this._test("ip",e,function(r,n,i){return s.test(r)?r:t?this.createError("string.ipVersion",{value:r,cidr:e.cidr,version:t},n,i):this.createError("string.ip",{value:r,cidr:e.cidr},n,i)})}uri(e){let t="",s=!1,r=!1,i=!1,o=h.uriRegex;if(e){n.assert("object"==typeof e,"options must be an object");const o=Object.keys(e).filter(e=>!["scheme","allowRelative","relativeOnly","allowQuerySquareBrackets"].includes(e));if(n.assert(0===o.length,`options contain unknown keys: ${o}`),e.scheme){n.assert(e.scheme instanceof RegExp||"string"==typeof e.scheme||Array.isArray(e.scheme),"scheme must be a RegExp, String, or Array"),Array.isArray(e.scheme)||(e.scheme=[e.scheme]),n.assert(e.scheme.length>=1,"scheme must have at least 1 scheme specified");for(let s=0;s<e.scheme.length;++s){const r=e.scheme[s];n.assert(r instanceof RegExp||"string"==typeof r,"scheme at position "+s+" must be a RegExp or String"),t+=t?"|":"",r instanceof RegExp?t+=r.source:(n.assert(/[a-zA-Z][a-zA-Z0-9+-\.]*/.test(r),"scheme at position "+s+" must be a valid scheme"),t+=n.escapeRegex(r))}}e.allowRelative&&(s=!0),e.relativeOnly&&(r=!0),e.allowQuerySquareBrackets&&(i=!0)}return(t||s||r||i)&&(o=l.createUriRegex(t,s,r,i)),this._test("uri",e,function(e,s,n){return o.test(e)?e:r?this.createError("string.uriRelativeOnly",{value:e},s,n):t?this.createError("string.uriCustomScheme",{scheme:t,value:e},s,n):this.createError("string.uri",{value:e},s,n)})}isoDate(){return this._test("isoDate",void 0,function(e,t,s){if(c._isIsoDate(e)){if(!s.convert)return e;const t=new Date(e);if(!isNaN(t.getTime()))return t.toISOString()}return this.createError("string.isoDate",{value:e},t,s)})}guid(e){let t="";if(e&&e.version){Array.isArray(e.version)||(e.version=[e.version]),n.assert(e.version.length>=1,"version must have at least 1 valid version specified");const s=new Set;for(let r=0;r<e.version.length;++r){let i=e.version[r];n.assert("string"==typeof i,"version at position "+r+" must be a string"),i=i.toLowerCase();const o=h.guidVersions[i];n.assert(o,"version at position "+r+" must be one of "+Object.keys(h.guidVersions).join(", ")),n.assert(!s.has(o),"version at position "+r+" must not be a duplicate."),t+=o,s.add(o)}}const s=new RegExp(`^([\\[{\\(]?)[0-9A-F]{8}([:-]?)[0-9A-F]{4}\\2?[${t||"0-9A-F"}][0-9A-F]{3}\\2?[${t?"89AB":"0-9A-F"}][0-9A-F]{3}\\2?[0-9A-F]{12}([\\]}\\)]?)$`,"i");return this._test("guid",e,function(e,t,r){const n=s.exec(e);return n?h.guidBrackets[n[1]]!==n[n.length-1]?this.createError("string.guid",{value:e},t,r):e:this.createError("string.guid",{value:e},t,r)})}hex(e={}){n.assert("object"==typeof e,"hex options must be an object"),n.assert(void 0===e.byteAligned||"boolean"==typeof e.byteAligned,"byteAligned must be boolean");const t=!0===e.byteAligned,s=/^[a-f0-9]+$/i,r=this._test("hex",s,function(e,r,n){return s.test(e)?t&&e.length%2!=0?this.createError("string.hexAlign",{value:e},r,n):e:this.createError("string.hex",{value:e},r,n)});return t&&(r._flags.byteAligned=!0),r}base64(e={}){n.assert("object"==typeof e,"base64 options must be an object"),n.assert(void 0===e.paddingRequired||"boolean"==typeof e.paddingRequired,"paddingRequired must be boolean");const t=(!1===e.paddingRequired?e.paddingRequired:e.paddingRequired||!0)?/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/:/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/;return this._test("base64",t,function(e,s,r){return t.test(e)?e:this.createError("string.base64",{value:e},s,r)})}dataUri(e={}){const t=/^data:[\w\/\+]+;((charset=[\w-]+|base64),)?(.*)$/,s=(!1===e.paddingRequired?e.paddingRequired:e.paddingRequired||!0)?/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/:/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}(==)?|[A-Za-z0-9+\/]{3}=?)?$/;return this._test("dataUri",t,function(e,r,n){const i=e.match(t);if(i){if(!i[2])return e;if("base64"!==i[2])return e;if(s.test(i[3]))return e}return this.createError("string.dataUri",{value:e},r,n)})}hostname(){const e=/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/;return this._test("hostname",void 0,function(t,s,n){return t.length<=255&&e.test(t)||r.isIPv6(t)?t:this.createError("string.hostname",{value:t},s,n)})}normalize(e="NFC"){n.assert(n.contain(h.normalizationForms,e),"normalization form must be one of "+h.normalizationForms.join(", "));const t=this._test("normalize",e,function(t,s,r){return r.convert||t===t.normalize(e)?t:this.createError("string.normalize",{value:t,form:e},s,r)});return t._flags.normalize=e,t}lowercase(){const e=this._test("lowercase",void 0,function(e,t,s){return s.convert||e===e.toLocaleLowerCase()?e:this.createError("string.lowercase",{value:e},t,s)});return e._flags.case="lower",e}uppercase(){const e=this._test("uppercase",void 0,function(e,t,s){return s.convert||e===e.toLocaleUpperCase()?e:this.createError("string.uppercase",{value:e},t,s)});return e._flags.case="upper",e}trim(e=!0){if(n.assert("boolean"==typeof e,"option must be a boolean"),this._flags.trim&&e||!this._flags.trim&&!e)return this;let t;return e?t=this._test("trim",void 0,function(e,t,s){return s.convert||e===e.trim()?e:this.createError("string.trim",{value:e},t,s)}):(t=this.clone())._tests=t._tests.filter(e=>"trim"!==e.name),t._flags.trim=e,t}replace(e,t){"string"==typeof e&&(e=new RegExp(n.escapeRegex(e),"g")),n.assert(e instanceof RegExp,"pattern must be a RegExp"),n.assert("string"==typeof t,"replacement must be a String");const s=this.clone();return s._inner.replacements||(s._inner.replacements=[]),s._inner.replacements.push({pattern:e,replacement:t}),s}truncate(e){const t=void 0===e||!!e;if(this._flags.truncate===t)return this;const s=this.clone();return s._flags.truncate=t,s}},h.compare=function(e,t){return function(s,r){const i=a.isRef(s);return n.assert(Number.isSafeInteger(s)&&s>=0||i,"limit must be a positive integer or reference"),n.assert(!r||Buffer.isEncoding(r),"Invalid encoding:",r),this._test(e,s,function(n,o,a){let c;if(i){if(c=s(o.reference||o.parent,a),!Number.isSafeInteger(c))return this.createError("string.ref",{ref:s.key},o,a)}else c=s;return t(n,c,r)?n:this.createError("string."+e,{limit:c,value:n,encoding:r},o,a)})}},h.String.prototype.min=h.compare("min",(e,t,s)=>{return(s?Buffer.byteLength(e,s):e.length)>=t}),h.String.prototype.max=h.compare("max",(e,t,s)=>{return(s?Buffer.byteLength(e,s):e.length)<=t}),h.String.prototype.length=h.compare("length",(e,t,s)=>{return(s?Buffer.byteLength(e,s):e.length)===t}),h.String.prototype.uuid=h.String.prototype.guid,e.exports=new h.String},function(e,t,s){"use strict";const r=s(24),n={Uri:{createUriRegex:function(e,t,s,n){let i,o=r.scheme;if(s)i="(?:"+r.relativeRef+")";else{e&&(o="(?:"+e+")");const s="(?:"+o+":"+r.hierPart+")";i=t?"(?:"+s+"|"+r.relativeRef+")":s}return new RegExp("^"+i+"(?:\\?"+(n?r.queryWithSquareBrackets:r.query)+")?(?:#"+r.fragment+")?$")}}};e.exports=n.Uri},function(e,t,s){"use strict";const r=s(24),n={Ip:{cidrs:{ipv4:{required:"\\/(?:"+r.ipv4Cidr+")",optional:"(?:\\/(?:"+r.ipv4Cidr+"))?",forbidden:""},ipv6:{required:"\\/"+r.ipv6Cidr,optional:"(?:\\/"+r.ipv6Cidr+")?",forbidden:""},ipvfuture:{required:"\\/"+r.ipv6Cidr,optional:"(?:\\/"+r.ipv6Cidr+")?",forbidden:""}},versions:{ipv4:r.IPv4address,ipv6:r.IPv6address,ipvfuture:r.IPvFuture}}};n.Ip.createIpRegex=function(e,t){let s;for(let r=0;r<e.length;++r){const i=e[r];s?s+="|"+n.Ip.versions[i]+n.Ip.cidrs[i][t]:s="^(?:"+n.Ip.versions[i]+n.Ip.cidrs[i][t]}return new RegExp(s+")$")},e.exports=n.Ip},function(e,t,s){"use strict";const r=s(57),n=s(11),i={hasOwn:Object.prototype.hasOwnProperty,indexOf:Array.prototype.indexOf,defaultThreshold:16,maxIPv6Groups:8,categories:{valid:1,dnsWarn:7,rfc5321:15,cfws:31,deprecated:63,rfc5322:127,error:255},diagnoses:{valid:0,rfc5321TLD:9,rfc5321TLDNumeric:10,rfc5321QuotedString:11,rfc5321AddressLiteral:12,cfwsComment:17,cfwsFWS:18,undesiredNonAscii:25,deprecatedLocalPart:33,deprecatedFWS:34,deprecatedQTEXT:35,deprecatedQP:36,deprecatedComment:37,deprecatedCTEXT:38,deprecatedIPv6:39,deprecatedCFWSNearAt:49,rfc5322Domain:65,rfc5322TooLong:66,rfc5322LocalTooLong:67,rfc5322DomainTooLong:68,rfc5322LabelTooLong:69,rfc5322DomainLiteral:70,rfc5322DomainLiteralOBSDText:71,rfc5322IPv6GroupCount:72,rfc5322IPv62x2xColon:73,rfc5322IPv6BadCharacter:74,rfc5322IPv6MaxGroups:75,rfc5322IPv6ColonStart:76,rfc5322IPv6ColonEnd:77,errExpectingDTEXT:129,errNoLocalPart:130,errNoDomain:131,errConsecutiveDots:132,errATEXTAfterCFWS:133,errATEXTAfterQS:134,errATEXTAfterDomainLiteral:135,errExpectingQPair:136,errExpectingATEXT:137,errExpectingQTEXT:138,errExpectingCTEXT:139,errBackslashEnd:140,errDotStart:141,errDotEnd:142,errDomainHyphenStart:143,errDomainHyphenEnd:144,errUnclosedQuotedString:145,errUnclosedComment:146,errUnclosedDomainLiteral:147,errFWSCRLFx2:148,errFWSCRLFEnd:149,errCRNoLF:150,errUnknownTLD:160,errDomainTooShort:161,errDotAfterDomainLiteral:162},components:{localpart:0,domain:1,literal:2,contextComment:3,contextFWS:4,contextQuotedString:5,contextQuotedPair:6}};i.specials=function(){const e=new Array(256);e.fill(!1);for(let t=0;t<'()<>[]:;@\\,."'.length;++t)e['()<>[]:;@\\,."'.codePointAt(t)]=!0;return function(t){return e[t]}}(),i.c0Controls=function(){const e=new Array(256);e.fill(!1);for(let t=0;t<33;++t)e[t]=!0;return function(t){return e[t]}}(),i.c1Controls=function(){const e=new Array(256);e.fill(!1);for(let t=127;t<160;++t)e[t]=!0;return function(t){return e[t]}}(),i.regex={ipV4:/\b(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipV6:/^[a-fA-F\d]{0,4}$/},i.normalizeSupportsNul="\0"==="\0".normalize("NFC"),i.nulNormalize=function(e){return e.split("\0").map(e=>e.normalize("NFC")).join("\0")},i.normalize=function(e){return e.normalize("NFC")},i.normalizeSupportsNul||(i.normalize=function(e){return e.indexOf("\0")>=0?i.nulNormalize(e):e.normalize("NFC")}),i.checkIpV6=function(e){return e.every(e=>i.regex.ipV6.test(e))},i.isIterable=Array.isArray,"undefined"!=typeof Symbol&&(i.isIterable=(e=>Array.isArray(e)||!!e&&"object"==typeof e&&"function"==typeof e[Symbol.iterator])),i._isSet=(e=>e instanceof Set),i._isMap=(e=>e instanceof Map),i.isSet=n.types&&n.types.isSet||i._isSet,i.isMap=n.types&&n.types.isMap||i._isMap,i.normalizeTable=function(e){return i.isSet(e)||Array.isArray(e)?e:i.isMap(e)?e.keys():Object.keys(e)},i.canonicalizeAtom=function(e){return r.toASCII(e).toLowerCase()},i.includesMapped=function(e,t,s){for(const r of e)if(s===t(r))return!0;return!1},i.validDomain=function(e,t){const s=i.canonicalizeAtom(e);return t.tldBlacklist?!i.includesMapped(i.normalizeTable(t.tldBlacklist),i.canonicalizeAtom,s):i.includesMapped(i.normalizeTable(t.tldWhitelist),i.canonicalizeAtom,s)},i.hasDomainLiteralThenAtom=function(e){let t=!1;for(let s=0;s<e.length;++s)if("["===e[s][0])t=!0;else if(t)return!0;return!1},t.validate=i.validate=function(e,t,s){if(t=t||{},"string"!=typeof e)throw new TypeError("expected string email");let n,o;if(e=i.normalize(e),"function"==typeof t&&(s=t,t={}),"function"!=typeof s&&(s=null),"number"==typeof t.errorLevel?(n=!0,o=t.errorLevel):(n=!!t.errorLevel,o=i.diagnoses.valid),t.tldWhitelist)if("string"==typeof t.tldWhitelist)t.tldWhitelist=[t.tldWhitelist];else if("object"!=typeof t.tldWhitelist)throw new TypeError("expected array or object tldWhitelist");if(t.tldBlacklist)if("string"==typeof t.tldBlacklist)t.tldBlacklist=[t.tldBlacklist];else if("object"!=typeof t.tldBlacklist)throw new TypeError("expected array or object tldBlacklist");if(t.minDomainAtoms&&(t.minDomainAtoms!==(0|+t.minDomainAtoms)||t.minDomainAtoms<0))throw new TypeError("expected positive integer minDomainAtoms");if(t.excludeDiagnoses){if(!i.isIterable(t.excludeDiagnoses))throw new TypeError("expected iterable excludeDiagnoses");i.isSet(t.excludeDiagnoses)||(t.excludeDiagnoses=new Set(t.excludeDiagnoses))}let a=i.diagnoses.valid;const c=e=>{!(e>a)||t.excludeDiagnoses&&t.excludeDiagnoses.has(e)||(a=e)};!(void 0===t.allowUnicode||!!t.allowUnicode)&&/[^\x00-\x7f]/.test(e)&&c(i.diagnoses.undesiredNonAscii);const l={now:i.components.localpart,prev:i.components.localpart,stack:[i.components.localpart]};let u="";const h={local:"",domain:""},f={locals:[""],domains:[""]};let p,d=0,m=0,g=0,y=!1,_=!1;const b=e.length;let v;for(let t=0;t<b;t+=v.length){switch(v=String.fromCodePoint(e.codePointAt(t)),l.now){case i.components.localpart:switch(v){case"(":0===m?c(0===d?i.diagnoses.cfwsComment:i.diagnoses.deprecatedComment):(c(i.diagnoses.cfwsComment),_=!0),l.stack.push(l.now),l.now=i.components.contextComment;break;case".":0===m?c(0===d?i.diagnoses.errDotStart:i.diagnoses.errConsecutiveDots):(_&&c(i.diagnoses.deprecatedLocalPart),_=!1,m=0,++d,h.local+=v,f.locals[d]="");break;case'"':0===m?(c(0===d?i.diagnoses.rfc5321QuotedString:i.diagnoses.deprecatedLocalPart),h.local+=v,f.locals[d]+=v,m+=Buffer.byteLength(v,"utf8"),_=!0,l.stack.push(l.now),l.now=i.components.contextQuotedString):c(i.diagnoses.errExpectingATEXT);break;case"\r":if(b===++t||"\n"!==e[t]){c(i.diagnoses.errCRNoLF);break}case" ":case"\t":0===m?c(0===d?i.diagnoses.cfwsFWS:i.diagnoses.deprecatedFWS):_=!0,l.stack.push(l.now),l.now=i.components.contextFWS,u=v;break;case"@":if(1!==l.stack.length)throw new Error("unexpected item on context stack");0===h.local.length?c(i.diagnoses.errNoLocalPart):0===m?c(i.diagnoses.errDotEnd):Buffer.byteLength(h.local,"utf8")>64?c(i.diagnoses.rfc5322LocalTooLong):l.prev!==i.components.contextComment&&l.prev!==i.components.contextFWS||c(i.diagnoses.deprecatedCFWSNearAt),l.now=i.components.domain,l.stack[0]=i.components.domain,d=0,m=0,_=!1;break;default:if(_)switch(l.prev){case i.components.contextComment:case i.components.contextFWS:c(i.diagnoses.errATEXTAfterCFWS);break;case i.components.contextQuotedString:c(i.diagnoses.errATEXTAfterQS);break;default:throw new Error("more atext found where none is allowed, but unrecognized prev context: "+l.prev)}else l.prev=l.now,p=v.codePointAt(0),(i.specials(p)||i.c0Controls(p)||i.c1Controls(p))&&c(i.diagnoses.errExpectingATEXT),h.local+=v,f.locals[d]+=v,m+=Buffer.byteLength(v,"utf8")}break;case i.components.domain:switch(v){case"(":0===m?c(0===d?i.diagnoses.deprecatedCFWSNearAt:i.diagnoses.deprecatedComment):(_=!0,c(i.diagnoses.cfwsComment)),l.stack.push(l.now),l.now=i.components.contextComment;break;case".":const s=r.toASCII(f.domains[d]).length;0===m?c(0===d?i.diagnoses.errDotStart:i.diagnoses.errConsecutiveDots):y?c(i.diagnoses.errDomainHyphenEnd):s>63&&c(i.diagnoses.rfc5322LabelTooLong),_=!1,m=0,++d,f.domains[d]="",h.domain+=v;break;case"[":0===f.domains[d].length?(h.domain.length&&c(i.diagnoses.errDotAfterDomainLiteral),_=!0,m+=Buffer.byteLength(v,"utf8"),l.stack.push(l.now),l.now=i.components.literal,h.domain+=v,f.domains[d]+=v,h.literal=""):c(i.diagnoses.errExpectingATEXT);break;case"\r":if(b===++t||"\n"!==e[t]){c(i.diagnoses.errCRNoLF);break}case" ":case"\t":0===m?c(0===d?i.diagnoses.deprecatedCFWSNearAt:i.diagnoses.deprecatedFWS):(c(i.diagnoses.cfwsFWS),_=!0),l.stack.push(l.now),l.now=i.components.contextFWS,u=v;break;default:if(_)switch(l.prev){case i.components.contextComment:case i.components.contextFWS:c(i.diagnoses.errATEXTAfterCFWS);break;case i.components.literal:c(i.diagnoses.errATEXTAfterDomainLiteral);break;default:throw new Error("more atext found where none is allowed, but unrecognized prev context: "+l.prev)}p=v.codePointAt(0),y=!1,i.specials(p)||i.c0Controls(p)||i.c1Controls(p)?c(i.diagnoses.errExpectingATEXT):"-"===v?(0===m&&c(i.diagnoses.errDomainHyphenStart),y=!0):(p<48||p>122&&p<192||p>57&&p<65||p>90&&p<97)&&c(i.diagnoses.rfc5322Domain),h.domain+=v,f.domains[d]+=v,m+=Buffer.byteLength(v,"utf8")}break;case i.components.literal:switch(v){case"]":if(a<i.categories.deprecated){let e=-1,t=h.literal;const s=i.regex.ipV4.exec(t);if(s&&0!==(e=s.index)&&(t=t.slice(0,e)+"0:0"),0===e)c(i.diagnoses.rfc5321AddressLiteral);else if("ipv6:"!==t.slice(0,5).toLowerCase())c(i.diagnoses.rfc5322DomainLiteral);else{const s=t.slice(5);let r=i.maxIPv6Groups;const n=s.split(":");~(e=s.indexOf("::"))?e!==s.lastIndexOf("::")?c(i.diagnoses.rfc5322IPv62x2xColon):(0!==e&&e!==s.length-2||++r,n.length>r?c(i.diagnoses.rfc5322IPv6MaxGroups):n.length===r&&c(i.diagnoses.deprecatedIPv6)):n.length!==r&&c(i.diagnoses.rfc5322IPv6GroupCount),":"===s[0]&&":"!==s[1]?c(i.diagnoses.rfc5322IPv6ColonStart):":"===s[s.length-1]&&":"!==s[s.length-2]?c(i.diagnoses.rfc5322IPv6ColonEnd):i.checkIpV6(n)?c(i.diagnoses.rfc5321AddressLiteral):c(i.diagnoses.rfc5322IPv6BadCharacter)}}else c(i.diagnoses.rfc5322DomainLiteral);h.domain+=v,f.domains[d]+=v,m+=Buffer.byteLength(v,"utf8"),l.prev=l.now,l.now=l.stack.pop();break;case"\\":c(i.diagnoses.rfc5322DomainLiteralOBSDText),l.stack.push(l.now),l.now=i.components.contextQuotedPair;break;case"\r":if(b===++t||"\n"!==e[t]){c(i.diagnoses.errCRNoLF);break}case" ":case"\t":c(i.diagnoses.cfwsFWS),l.stack.push(l.now),l.now=i.components.contextFWS,u=v;break;default:if(127!==(p=v.codePointAt(0))&&i.c1Controls(p)||0===p||"["===v){c(i.diagnoses.errExpectingDTEXT);break}(i.c0Controls(p)||127===p)&&c(i.diagnoses.rfc5322DomainLiteralOBSDText),h.literal+=v,h.domain+=v,f.domains[d]+=v,m+=Buffer.byteLength(v,"utf8")}break;case i.components.contextQuotedString:switch(v){case"\\":l.stack.push(l.now),l.now=i.components.contextQuotedPair;break;case"\r":if(b===++t||"\n"!==e[t]){c(i.diagnoses.errCRNoLF);break}case"\t":h.local+=" ",f.locals[d]+=" ",m+=Buffer.byteLength(v,"utf8"),c(i.diagnoses.cfwsFWS),l.stack.push(l.now),l.now=i.components.contextFWS,u=v;break;case'"':h.local+=v,f.locals[d]+=v,m+=Buffer.byteLength(v,"utf8"),l.prev=l.now,l.now=l.stack.pop();break;default:127!==(p=v.codePointAt(0))&&i.c1Controls(p)||0===p||10===p?c(i.diagnoses.errExpectingQTEXT):(i.c0Controls(p)||127===p)&&c(i.diagnoses.deprecatedQTEXT),h.local+=v,f.locals[d]+=v,m+=Buffer.byteLength(v,"utf8")}break;case i.components.contextQuotedPair:127!==(p=v.codePointAt(0))&&i.c1Controls(p)?c(i.diagnoses.errExpectingQPair):(p<31&&9!==p||127===p)&&c(i.diagnoses.deprecatedQP),l.prev=l.now,l.now=l.stack.pop();const s="\\"+v;switch(l.now){case i.components.contextComment:break;case i.components.contextQuotedString:h.local+=s,f.locals[d]+=s,m+=2;break;case i.components.literal:h.domain+=s,f.domains[d]+=s,m+=2;break;default:throw new Error("quoted pair logic invoked in an invalid context: "+l.now)}break;case i.components.contextComment:switch(v){case"(":l.stack.push(l.now),l.now=i.components.contextComment;break;case")":l.prev=l.now,l.now=l.stack.pop();break;case"\\":l.stack.push(l.now),l.now=i.components.contextQuotedPair;break;case"\r":if(b===++t||"\n"!==e[t]){c(i.diagnoses.errCRNoLF);break}case" ":case"\t":c(i.diagnoses.cfwsFWS),l.stack.push(l.now),l.now=i.components.contextFWS,u=v;break;default:if(0===(p=v.codePointAt(0))||10===p||127!==p&&i.c1Controls(p)){c(i.diagnoses.errExpectingCTEXT);break}(i.c0Controls(p)||127===p)&&c(i.diagnoses.deprecatedCTEXT)}break;case i.components.contextFWS:if("\r"===u){if("\r"===v){c(i.diagnoses.errFWSCRLFx2);break}++g>1?c(i.diagnoses.deprecatedFWS):g=1}switch(v){case"\r":b!==++t&&"\n"===e[t]||c(i.diagnoses.errCRNoLF);break;case" ":case"\t":break;default:"\r"===u&&c(i.diagnoses.errFWSCRLFEnd),g=0,l.prev=l.now,l.now=l.stack.pop(),--t}u=v;break;default:throw new Error("unknown context: "+l.now)}if(a>i.categories.rfc5322)break}if(a<i.categories.rfc5322){const e=r.toASCII(h.domain).length;if(l.now===i.components.contextQuotedString)c(i.diagnoses.errUnclosedQuotedString);else if(l.now===i.components.contextQuotedPair)c(i.diagnoses.errBackslashEnd);else if(l.now===i.components.contextComment)c(i.diagnoses.errUnclosedComment);else if(l.now===i.components.literal)c(i.diagnoses.errUnclosedDomainLiteral);else if("\r"===v)c(i.diagnoses.errFWSCRLFEnd);else if(0===h.domain.length)c(i.diagnoses.errNoDomain);else if(0===m)c(i.diagnoses.errDotEnd);else if(y)c(i.diagnoses.errDomainHyphenEnd);else if(e>255)c(i.diagnoses.rfc5322DomainTooLong);else if(Buffer.byteLength(h.local,"utf8")+e+1>254)c(i.diagnoses.rfc5322TooLong);else if(m>63)c(i.diagnoses.rfc5322LabelTooLong);else if(t.minDomainAtoms&&f.domains.length<t.minDomainAtoms&&(1!==f.domains.length||"["!==f.domains[0][0]))c(i.diagnoses.errDomainTooShort);else if(i.hasDomainLiteralThenAtom(f.domains))c(i.diagnoses.errDotAfterDomainLiteral);else if(t.tldWhitelist||t.tldBlacklist){const e=f.domains[d];i.validDomain(e,t)||c(i.diagnoses.errUnknownTLD)}}if(a<i.categories.dnsWarn){f.domains[d].codePointAt(0)<=57&&c(i.diagnoses.rfc5321TLDNumeric)}a<o&&(a=i.diagnoses.valid);const w=n?a:a<i.defaultThreshold;return s&&s(w),w},t.diagnoses=i.validate.diagnoses=function(){const e={},t=Object.keys(i.diagnoses);for(let s=0;s<t.length;++s){const r=t[s];e[r]=i.diagnoses[r]}return e}(),t.normalize=i.normalize},function(e,t){e.exports=require("punycode")},function(e,t,s){"use strict";const r=s(11),n=s(1),i=s(0),o={};o.Map=class extends Map{slice(){return new o.Map(this)}toString(){return r.inspect(this)}},o.Symbol=class extends n{constructor(){super(),this._type="symbol",this._inner.map=new o.Map}_base(e,t,s){if(s.convert){const r=this._inner.map.get(e);if(r&&(e=r),this._flags.allowOnly)return{value:e,errors:"symbol"==typeof e?null:this.createError("symbol.map",{map:this._inner.map},t,s)}}return{value:e,errors:"symbol"==typeof e?null:this.createError("symbol.base",null,t,s)}}map(e){e&&!e[Symbol.iterator]&&"object"==typeof e&&(e=Object.entries(e)),i.assert(e&&e[Symbol.iterator],"Iterable must be an iterable or object");const t=this.clone(),s=[];for(const r of e){i.assert(r&&r[Symbol.iterator],"Entry must be an iterable");const[e,n]=r;i.assert("object"!=typeof e&&"function"!=typeof e&&"symbol"!=typeof e,"Key must not be an object, function, or Symbol"),i.assert("symbol"==typeof n,"Value must be a Symbol"),t._inner.map.set(e,n),s.push(n)}return t.valid(...s)}describe(){const e=super.describe();return e.map=new Map(this._inner.map),e}},e.exports=new o.Symbol},function(e){e.exports={name:"joi",description:"Object schema validation",version:"13.7.0",homepage:"https://github.com/hapijs/joi",repository:"git://github.com/hapijs/joi",main:"lib/index.js",keywords:["hapi","schema","validation"],engines:{node:">=8.9.0"},dependencies:{hoek:"5.x.x",isemail:"3.x.x",topo:"3.x.x"},devDependencies:{code:"5.x.x",hapitoc:"1.x.x",lab:"15.x.x"},scripts:{test:"lab -t 100 -a code -L","test-debug":"lab -a code","test-cov-html":"lab -r html -o coverage.html -a code",toc:"hapitoc",version:"npm run toc && git add API.md README.md"},license:"BSD-3-Clause"}},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("tls")},function(e,t,s){"use strict";function r(e){if(!(this instanceof r))return new r(e);e=e||{},this.concurrency=e.concurrency||1/0,this.pending=0,this.jobs=[],this.cbs=[],this._done=function(){this.pending--,this._run()}.bind(this)}["push","unshift","splice"].forEach(function(e){r.prototype[e]=function(){var t=Array.prototype[e].apply(this.jobs,arguments);return this._run(),t}}),Object.defineProperty(r.prototype,"length",{get:function(){return this.pending+this.jobs.length}}),r.prototype._run=function(){if(this.pending!==this.concurrency){if(this.jobs.length){var e=this.jobs.shift();this.pending++,e(this._done),this._run()}if(0===this.pending)for(;0!==this.cbs.length;){var t=this.cbs.pop();process.nextTick(t)}}},r.prototype.onDone=function(e){"function"==typeof e&&(this.cbs.push(e),this._run())},e.exports=r},function(e,t){e.exports=require("zlib")},function(e,t,s){"use strict";class r{constructor(e,t){this.target=t,this.type=e}}class n extends r{constructor(e,t){super("message",t),this.data=e}}class i extends r{constructor(e,t,s){super("close",s),this.wasClean=s._closeFrameReceived&&s._closeFrameSent,this.reason=t,this.code=e}}class o extends r{constructor(e){super("open",e)}}class a extends r{constructor(e,t){super("error",t),this.message=e.message,this.error=e}}const c={addEventListener(e,t){function s(e){t.call(this,new n(e,this))}function r(e,s){t.call(this,new i(e,s,this))}function c(e){t.call(this,new a(e,this))}function l(){t.call(this,new o(this))}"function"==typeof t&&("message"===e?(s._listener=t,this.on(e,s)):"close"===e?(r._listener=t,this.on(e,r)):"error"===e?(c._listener=t,this.on(e,c)):"open"===e?(l._listener=t,this.on(e,l)):this.on(e,t))},removeEventListener(e,t){const s=this.listeners(e);for(var r=0;r<s.length;r++)s[r]!==t&&s[r]._listener!==t||this.removeListener(e,s[r])}};e.exports=c},function(e,t,s){"use strict";const r=s(27),n=s(3),i=s(28),o=s(29),a=s(8),c=s(30),l=s(7),u=s(26);function h(){this.destroy()}function f(e,t,s,r){e.writable&&(s=s||i.STATUS_CODES[t],r=Object.assign({Connection:"close","Content-type":"text/html","Content-Length":Buffer.byteLength(s)},r),e.write(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r\n`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+s)),e.removeListener("error",h),e.destroy()}e.exports=class extends r{constructor(e,t){if(super(),null==(e=Object.assign({maxPayload:104857600,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null},e)).port&&!e.server&&!e.noServer)throw new TypeError('One of the "port", "server", or "noServer" options must be specified');null!=e.port?(this._server=i.createServer((e,t)=>{const s=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),t.end(s)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server&&(this._removeListeners=function(e,t){for(const s of Object.keys(t))e.on(s,t[s]);return function(){for(const s of Object.keys(t))e.removeListener(s,t[s])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(e,t,s)=>{this.handleUpgrade(e,t,s,t=>{this.emit("connection",t,e)})}})),!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set),this.options=e}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(this.clients)for(const e of this.clients)e.terminate();const t=this._server;if(t&&(this._removeListeners(),this._removeListeners=this._server=null,null!=this.options.port))return t.close(e);e&&e()}shouldHandle(e){return!this.options.path||o.parse(e.url).pathname===this.options.path}handleUpgrade(e,t,s,r){t.on("error",h);const n=+e.headers["sec-websocket-version"],i={};if("GET"!==e.method||"websocket"!==e.headers.upgrade.toLowerCase()||!e.headers["sec-websocket-key"]||8!==n&&13!==n||!this.shouldHandle(e))return f(t,400);if(this.options.perMessageDeflate){const s=new a(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const r=c.parse(e.headers["sec-websocket-extensions"]);r[a.extensionName]&&(s.accept(r[a.extensionName]),i[a.extensionName]=s)}catch(e){return f(t,400)}}if(this.options.verifyClient){const o={origin:e.headers[`${8===n?"sec-websocket-origin":"origin"}`],secure:!(!e.connection.authorized&&!e.connection.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(n,o,a,c)=>{if(!n)return f(t,o||401,a,c);this.completeUpgrade(i,e,t,s,r)});if(!this.options.verifyClient(o))return f(t,401)}this.completeUpgrade(i,e,t,s,r)}completeUpgrade(e,t,s,r,i){if(!s.readable||!s.writable)return s.destroy();const o=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${n.createHash("sha1").update(t.headers["sec-websocket-key"]+l.GUID,"binary").digest("base64")}`],f=new u(null);var p=t.headers["sec-websocket-protocol"];if(p&&(p=p.trim().split(/ *, */),(p=this.options.handleProtocols?this.options.handleProtocols(p,t):p[0])&&(o.push(`Sec-WebSocket-Protocol: ${p}`),f.protocol=p)),e[a.extensionName]){const t=e[a.extensionName].params,s=c.format({[a.extensionName]:[t]});o.push(`Sec-WebSocket-Extensions: ${s}`),f._extensions=e}this.emit("headers",o,t),s.write(o.concat("\r\n").join("\r\n")),s.removeListener("error",h),f.setSocket(s,r,this.options.maxPayload),this.clients&&(this.clients.add(f),f.on("close",()=>this.clients.delete(f))),i(f)}}},function(e,t,s){"use strict";var r;"undefined"!=typeof window?window:global,r=(()=>{const e=function(){},t={TIMEOUT:"timeout",DISCONNECT:"disconnect",SERVER:"server",PROTOCOL:"protocol",WS:"ws",USER:"user"},s=function(e,t){"string"==typeof e&&(e=new Error(e)),e.type=t,e.isNes=!0;try{throw e}catch(e){return e}},r={1000:"Normal closure",1001:"Going away",1002:"Protocol error",1003:"Unsupported data",1004:"Reserved",1005:"No status received",1006:"Abnormal closure",1007:"Invalid frame payload data",1008:"Policy violation",1009:"Message too big",1010:"Mandatory extension",1011:"Internal server error",1015:"TLS handshake"},n=function(t,s){s=s||{},this._url=t,this._settings=s,this._heartbeatTimeout=!1,this._ws=null,this._reconnection=null,this._reconnectionTimer=null,this._ids=0,this._requests={},this._subscriptions={},this._heartbeat=null,this._packets=[],this._disconnectListeners=null,this._disconnectRequested=!1,this.onError=(e=>console.error(e)),this.onConnect=e,this.onDisconnect=e,this.onHeartbeatTimeout=e,this.onUpdate=e,this.id=null};return n.WebSocket="undefined"==typeof WebSocket?null:WebSocket,n.prototype.connect=function(e){return e=e||{},this._reconnection?Promise.reject(new s("Cannot connect while client attempts to reconnect",t.USER)):this._ws?Promise.reject(new s("Already connected",t.USER)):(!1!==e.reconnect?this._reconnection={wait:0,delay:e.delay||1e3,maxDelay:e.maxDelay||5e3,retries:e.retries||1/0,settings:{auth:e.auth,timeout:e.timeout}}:this._reconnection=null,new Promise((t,s)=>{this._connect(e,!0,e=>e?s(e):t())}))},n.prototype._connect=function(e,i,o){const a=new n.WebSocket(this._url,this._settings.ws);this._ws=a,clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null;const c=e=>{a.onopen&&l(new s("Connection terminated while waiting to connect",t.WS));const n=this._disconnectRequested;this._cleanup();const i={code:e.code,explanation:r[e.code]||"Unknown",reason:e.reason,wasClean:e.wasClean,willReconnect:this._willReconnect(),wasRequested:n};this.onDisconnect(i.willReconnect,i),this._reconnect()},l=e=>{if(o){const t=o;return o=null,t(e)}return this.onError(e)},u=e.timeout?setTimeout(()=>{if(this._cleanup(),l(new s("Connection timed out",t.TIMEOUT)),i)return this._reconnect()},e.timeout):null;a.onopen=(()=>{clearTimeout(u),a.onopen=null,this._hello(e.auth).then(()=>{this.onConnect(),l()}).catch(e=>{e.path&&delete this._subscriptions[e.path],this._disconnect(()=>(function(e){return t=>{setTimeout(()=>e(t),0)}})(l)(e),!0)})}),a.onerror=(e=>{if(clearTimeout(u),this._willReconnect())return c(e);this._cleanup();const r=new s("Socket error",t.WS);return l(r)}),a.onclose=c,a.onmessage=(e=>this._onMessage(e))},n.prototype.overrideReconnectionAuth=function(e){return!!this._reconnection&&(this._reconnection.settings.auth=e,!0)},n.prototype.reauthenticate=function(e){this.overrideReconnectionAuth(e);const t={type:"reauth",auth:e};return this._send(t,!0)},n.prototype.disconnect=function(){return new Promise(e=>this._disconnect(e,!1))},n.prototype._disconnect=function(e,t){this._reconnection=null,clearTimeout(this._reconnectionTimer),this._reconnectionTimer=null;const s=this._disconnectRequested||!t;return this._disconnectListeners?(this._disconnectRequested=s,void this._disconnectListeners.push(e)):!this._ws||this._ws.readyState!==n.WebSocket.OPEN&&this._ws.readyState!==n.WebSocket.CONNECTING?e():(this._disconnectRequested=s,this._disconnectListeners=[e],void this._ws.close())},n.prototype._cleanup=function(){if(this._ws){const t=this._ws;this._ws=null,t.readyState!==n.WebSocket.CLOSED&&t.readyState!==n.WebSocket.CLOSING&&t.close(),t.onopen=null,t.onclose=null,t.onerror=e,t.onmessage=null}this._packets=[],this.id=null,clearTimeout(this._heartbeat),this._heartbeat=null;const r=new s("Request failed - server disconnected",t.DISCONNECT),i=this._requests;this._requests={};const o=Object.keys(i);for(let e=0;e<o.length;++e){const t=i[o[e]];clearTimeout(t.timeout),t.reject(r)}if(this._disconnectListeners){const e=this._disconnectListeners;this._disconnectListeners=null,this._disconnectRequested=!1,e.forEach(e=>e())}},n.prototype._reconnect=function(){const t=this._reconnection;if(!t)return;if(t.retries<1)return this._disconnect(e,!0);--t.retries,t.wait=t.wait+t.delay;const s=Math.min(t.wait,t.maxDelay);this._reconnectionTimer=setTimeout(()=>{this._connect(t.settings,!1,e=>{if(e)return this.onError(e),this._reconnect()})},s)},n.prototype.request=function(e){"string"==typeof e&&(e={method:"GET",path:e});const t={type:"request",method:e.method||"GET",path:e.path,headers:e.headers,payload:e.payload};return this._send(t,!0)},n.prototype.message=function(e){const t={type:"message",message:e};return this._send(t,!0)},n.prototype._isReady=function(){return this._ws&&this._ws.readyState===n.WebSocket.OPEN},n.prototype._send=function(e,r){if(!this._isReady())return Promise.reject(new s("Failed to send message - server disconnected",t.DISCONNECT));e.id=++this._ids;try{var n=function(e){try{return JSON.stringify(e)}catch(e){throw new s(e,t.USER)}}(e)}catch(e){return Promise.reject(e)}if(!r)try{return this._ws.send(n),Promise.resolve()}catch(e){return Promise.reject(new s(e,t.WS))}const i={resolve:null,reject:null,timeout:null},o=new Promise((e,t)=>{i.resolve=e,i.reject=t});this._settings.timeout&&(i.timeout=setTimeout(()=>(i.timeout=null,i.reject(new s("Request timed out",t.TIMEOUT))),this._settings.timeout)),this._requests[e.id]=i;try{this._ws.send(n)}catch(r){return clearTimeout(this._requests[e.id].timeout),delete this._requests[e.id],Promise.reject(new s(r,t.WS))}return o},n.prototype._hello=function(e){const t={type:"hello",version:"2"};e&&(t.auth=e);const s=this.subscriptions();return s.length&&(t.subs=s),this._send(t,!0)},n.prototype.subscriptions=function(){return Object.keys(this._subscriptions)},n.prototype.subscribe=function(e,r){if(!e||"/"!==e[0])return Promise.reject(new s("Invalid path",t.USER));const n=this._subscriptions[e];if(n)return-1===n.indexOf(r)&&n.push(r),Promise.resolve();if(this._subscriptions[e]=[r],!this._isReady())return Promise.resolve();const i={type:"sub",path:e},o=this._send(i,!0);return o.catch(t=>{delete this._subscriptions[e]}),o},n.prototype.unsubscribe=function(r,n){if(!r||"/"!==r[0])return Promise.reject(new s("Invalid path",t.USER));const i=this._subscriptions[r];if(!i)return Promise.resolve();let o=!1;if(n){const e=i.indexOf(n);if(-1===e)return Promise.resolve();i.splice(e,1),i.length||(delete this._subscriptions[r],o=!0)}else delete this._subscriptions[r],o=!0;if(!o||!this._isReady())return Promise.resolve();const a={type:"unsub",path:r},c=this._send(a,!0);return c.catch(e),c},n.prototype._onMessage=function(r){this._beat();let n=r.data;const i=n[0];if("{"!==i){if(this._packets.push(n.slice(1)),"!"!==i)return;n=this._packets.join(""),this._packets=[]}this._packets.length&&(this._packets=[],this.onError(new s("Received an incomplete message",t.PROTOCOL)));try{var o=JSON.parse(n)}catch(e){return this.onError(new s(e,t.PROTOCOL))}let a=null;if(o.statusCode&&o.statusCode>=400&&((a=new s(o.payload.message||o.payload.error||"Error",t.SERVER)).statusCode=o.statusCode,a.data=o.payload,a.headers=o.headers,a.path=o.path),"ping"===o.type)return this._send({type:"ping"},!1).catch(e);if("update"===o.type)return this.onUpdate(o.message);if("pub"===o.type||"revoke"===o.type){const e=this._subscriptions[o.path];if("revoke"===o.type&&delete this._subscriptions[o.path],e&&void 0!==o.message){const t={};"revoke"===o.type&&(t.revoked=!0);for(let s=0;s<e.length;++s)e[s](o.message,t)}return}const c=this._requests[o.id];if(!c)return this.onError(new s("Received response for unknown request",t.PROTOCOL));clearTimeout(c.timeout),delete this._requests[o.id];const l=(e,t)=>e?c.reject(e):c.resolve(t);return"request"===o.type?l(a,{payload:o.payload,statusCode:o.statusCode,headers:o.headers}):"message"===o.type?l(a,{payload:o.message}):"hello"===o.type?(this.id=o.socket,o.heartbeat&&(this._heartbeatTimeout=o.heartbeat.interval+o.heartbeat.timeout,this._beat()),l(a)):"reauth"===o.type?l(a,!0):"sub"===o.type||"unsub"===o.type?l(a):(l(new s("Received invalid response",t.PROTOCOL)),this.onError(new s("Received unknown response type: "+o.type,t.PROTOCOL)))},n.prototype._beat=function(){this._heartbeatTimeout&&(clearTimeout(this._heartbeat),this._heartbeat=setTimeout(()=>{this.onError(new s("Disconnecting due to heartbeat timeout",t.TIMEOUT)),this.onHeartbeatTimeout(this._willReconnect()),this._ws.close()},this._heartbeatTimeout))},n.prototype._willReconnect=function(){return!!(this._reconnection&&this._reconnection.retries>=1)},{Client:n}}),e.exports=r()},function(e,t,s){"use strict";const r=s(5),n=s(34),i=s(68),o=s(0),a=s(13),c=s(25),l=s(71),u={counter:{min:1e4,max:99999}};e.exports=u.Listener=function(e,t){this._server=e,this._settings=t,this._sockets=new u.Sockets(this),this._router=new i.Router,this._authRoute=this._settings.auth&&this._server.lookup(this._settings.auth.id),this._socketCounter=u.counter.min,this._heartbeat=null,this._beatTimeout=null,this._stopped=!1;const s={server:this._server.listener};t.origin&&(s.verifyClient=(e=>t.origin.indexOf(e.origin)>=0)),this._wss=new c.Server(s),this._wss.on("connection",(e,t)=>{if(e.on("error",o.ignore),this._stopped||this._settings.maxConnections&&this._sockets.length()>=this._settings.maxConnections)return e.close();this._add(e,t)}),this._wss.on("error",o.ignore),this._server.plugins.nes={_listener:this}},u.Listener.prototype._add=function(e,t){const s=new l(e,t,this);this._sockets.add(s),e.once("close",async(e,t)=>{this._sockets.remove(s),clearTimeout(s.auth._initialAuthTimeout),s.auth._initialAuthTimeout=null;const r=Object.keys(s._subscriptions);for(let e=0;e<r.length;++e){const t=r[e],n=s._subscriptions[t];await n.remove(s)}s._subscriptions={},this._settings.onDisconnection&&this._settings.onDisconnection(s),s._removed.attend()})},u.Listener.prototype._close=async function(){this._stopped=!0,clearTimeout(this._heartbeat),clearTimeout(this._beatTimeout),await Promise.all(Object.keys(this._sockets._items).map(e=>this._sockets._items[e].disconnect())),this._wss.close()},u.Listener.prototype._authRequired=function(){if(!this._authRoute)return!1;const e=this._server.auth.lookup(this._authRoute);return!!e&&"required"===e.mode},u.Listener.prototype._beat=function(){if(this._settings.heartbeat){if(this._heartbeat&&this._sockets.length()){const e={type:"ping"};this._sockets._forEach(t=>t._send(e).catch(o.ignore)),this._beatTimeout=setTimeout(()=>{this._sockets._forEach(e=>{e._active()||e.disconnect(),e._pinged=!1})},this._settings.heartbeat.timeout)}this._heartbeat=setTimeout(()=>{this._beat()},this._settings.heartbeat.interval)}},u.Listener.broadcast=function(e,t){t=t||{};const s={type:"update",message:e};this.plugins.nes._listener._broadcast(s,t)},u.Listener.prototype._broadcast=function(e,t){if(o.assert(!t.user||this._settings.auth&&this._settings.auth.index,"Socket auth indexing is disabled"),this._stopped)return;const s=t=>t._send(e).catch(o.ignore);if(t.user){const e=this._sockets._byUser[t.user];if(!e)return;return e.forEach(s)}this._sockets._forEach(s)},u.subSchema=a.object({filter:a.func(),onSubscribe:a.func(),onUnsubscribe:a.func(),auth:a.object({mode:a.string().valid("required","optional"),scope:a.array().items(a.string()).single().min(1),entity:a.valid("user","app","any"),index:a.boolean()}).allow(!1)}),u.Listener.subscription=function(e,t){o.assert(e,"Subscription missing path"),a.assert(t,u.subSchema,"Invalid subscription options: "+e);const s=o.clone(t||{}),r=s.auth;if(r){if(r.scope){"string"==typeof r.scope&&(r.scope=[r.scope]);for(let e=0;e<r.scope.length;++e)if(/{([^}]+)}/.test(r.scope[e])){r.hasScopeParameters=!0;break}}r.mode=r.mode||"required"}const n={method:"sub",path:e},i={subscribers:new u.Subscribers(this.plugins.nes._listener._server,s),filter:s.filter,auth:r};this.plugins.nes._listener._router.add(n,i)},u.Listener.publish=function(e,t,s){o.assert(e&&"/"===e[0],"Missing or invalid subscription path:",e||"empty"),s=s||{};const r={type:"pub",path:e,message:t};return this.plugins.nes._listener._publish(e,r,s)},u.Listener.prototype._publish=function(e,t,s){if(this._stopped)return;const r=this._router.route("sub",e);if(r.isBoom)return;const i=r.route;return i.subscribers._forEachSubscriber(r.paramsArray.length?e:null,s,async a=>{let c=t;if(i.filter){try{var l=await i.filter(e,c.message,{socket:a,credentials:a.auth.credentials,params:r.params,internal:s.internal})}catch(e){n.rethrow(e,"system")}if(!l)return;l.override&&((c=o.shallow(c)).message=l.override)}return a._send(c).catch(o.ignore)})},u.Listener.prototype._subscribe=async function(e,t){if(-1!==e.indexOf("?"))throw r.badRequest("Subscription path cannot contain query");if(t._subscriptions[e])return;const s=this._router.route("sub",e);if(s.isBoom)throw r.notFound("Subscription not found");const n=this._server.auth.lookup({settings:{auth:s.route.auth}});if(n){const e=t.auth.credentials;if(e){if(n.scope){let t=n.scope;if(n.hasScopeParameters){t=[];const e={params:s.params};for(let s=0;s<n.scope.length;++s)t[s]=o.reachTemplate(e,n.scope[s])}if(!e.scope||("string"==typeof e.scope?-1===t.indexOf(e.scope):!o.intersect(t,e.scope).length))throw r.forbidden("Insufficient scope to subscribe, expected any of: "+t)}const t=n.entity||"any";if("user"===t&&!e.user)throw r.forbidden("Application credentials cannot be used on a user subscription");if("app"===t&&e.user)throw r.forbidden("User credentials cannot be used on an application subscription")}else if("required"===n.mode)throw r.unauthorized("Authentication required to subscribe")}await s.route.subscribers.add(t,e,s),t._subscriptions[e]=s.route.subscribers},u.Listener.eachSocket=function(e,t){t=t||{},this.plugins.nes._listener._eachSocket(e,t)},u.Listener.prototype._eachSocket=function(e,t){if(this._stopped)return;if(!t.subscription)return o.assert(!t.user,"Cannot specify user filter without a subscription path"),this._sockets._forEach(e);const s=this._router.route("sub",t.subscription);s.isBoom||s.route.subscribers._forEachSubscriber(s.paramsArray.length?t.subscription:null,t,t=>e(t))},u.Listener.prototype._generateId=function(){const e=Date.now()+":"+this._server.info.id+":"+this._socketCounter++;return this._socketCounter>u.counter.max&&(this._socketCounter=u.counter.min),e},u.Sockets=function(e){this._listener=e,this._items={},this._byUser={}},u.Sockets.prototype.add=function(e){this._items[e.id]=e},u.Sockets.prototype.auth=function(e){if(!this._listener._settings.auth.index)return;if(!e.auth.credentials.user)return;const t=e.auth.credentials.user;if(this._listener._settings.auth.maxConnectionsPerUser&&this._byUser[t]&&this._byUser[t].length>=this._listener._settings.auth.maxConnectionsPerUser)throw r.serverUnavailable("Too many connections for the authenticated user");this._byUser[t]=this._byUser[t]||[],this._byUser[t].push(e)},u.Sockets.prototype.remove=function(e){if(delete this._items[e.id],e.auth.credentials&&e.auth.credentials.user){const t=e.auth.credentials.user;this._byUser[t]&&(this._byUser[t]=this._byUser[t].filter(t=>t!==e),this._byUser[t].length||delete this._byUser[t])}},u.Sockets.prototype._forEach=function(e){const t=Object.keys(this._items);for(let s=0;s<t.length;++s)e(this._items[t[s]])},u.Sockets.prototype.length=function(){return Object.keys(this._items).length},u.Subscribers=function(e,t){this._server=e,this._settings=t,this._items={},this._byUser={}},u.Subscribers.prototype.add=async function(e,t,s){this._settings.onSubscribe&&await this._settings.onSubscribe(e,t,s.params);const r=this._items[e.id];if(r)r.paths.push(t),r.params.push(s.params);else if(this._items[e.id]={socket:e,paths:[t],params:[s.params]},this._settings.auth&&this._settings.auth.index&&e.auth.credentials&&e.auth.credentials.user){const t=e.auth.credentials.user;this._byUser[t]=this._byUser[t]||[],this._byUser[t].push(this._items[e.id])}},u.Subscribers.prototype.remove=async function(e,t){const s=this._items[e.id];if(!s)return;if(!t){if(this._cleanup(e,s),this._settings.onUnsubscribe){for(let t=0;t<s.paths.length;++t){const r=s.paths[t];await this._remove(e,r,s.params[t])}this._cleanup(e,s)}return}const r=s.paths.indexOf(t),n=s.params[r];return 1===s.paths.length?this._cleanup(e,s):(s.paths.splice(r,1),s.params.splice(r,1)),this._settings.onUnsubscribe?this._remove(e,t,n):void 0},u.Subscribers.prototype._remove=async function(e,t,s){try{await this._settings.onUnsubscribe(e,t,s)}catch(e){this._server.log(["nes","onUnsubscribe","error"],e)}},u.Subscribers.prototype._cleanup=function(e,t){if(delete this._items[e.id],e.auth.credentials&&e.auth.credentials.user&&this._byUser[e.auth.credentials.user]){const s=e.auth.credentials.user;this._byUser[s]=this._byUser[s].filter(e=>e!==t),this._byUser[s].length||delete this._byUser[s]}},u.Subscribers.prototype._forEachSubscriber=async function(e,t,s){const r=async t=>{!t||e&&-1===t.paths.indexOf(e)||await s(t.socket)};if(t.user){o.assert(this._settings.auth&&this._settings.auth.index,"Subscription auth indexing is disabled");const e=this._byUser[t.user];if(e)for(let t=0;t<e.length;++t){const s=e[t];await r(s)}}else{const e=Object.keys(this._items);for(let t=0;t<e.length;++t){const s=this._items[e[t]];await r(s)}}}},function(e,t,s){"use strict";const r=s(4),n=s(5),i=s(69),o=s(70),a={pathRegex:i.generate(),defaults:{isCaseSensitive:!0}};t.Router=a.Router=function(e){this.settings=r.applyToDefaults(a.defaults,e||{}),this.routes={},this.ids={},this.vhosts=null,this.specials={badRequest:null,notFound:null,options:null}},a.Router.prototype.add=function(e,t){const s=e.method.toLowerCase(),n=e.vhost||"*";"*"!==n&&(this.vhosts=this.vhosts||{},this.vhosts[n]=this.vhosts[n]||{});const i="*"===n?this.routes:this.vhosts[n];i[s]=i[s]||{routes:[],router:new o};const c=e.analysis||this.analyze(e.path),l={path:e.path,route:t||e.path,segments:c.segments,params:c.params,fingerprint:c.fingerprint,settings:this.settings};return i[s].router.add(c.segments,l),i[s].routes.push(l),i[s].routes.sort(a.sort),l.segments[l.segments.length-1].empty&&i[s].router.add(c.segments.slice(0,-1),l),e.id&&(r.assert(!this.ids[e.id],"Route id",e.id,"for path",e.path,"conflicts with existing path",this.ids[e.id]&&this.ids[e.id].path),this.ids[e.id]=l),l},a.Router.prototype.special=function(e,t){r.assert(-1!==Object.keys(this.specials).indexOf(e),"Unknown special route type:",e),this.specials[e]={route:t}},a.Router.prototype.route=function(e,t,s){const r=t.split("/").slice(1),i=this.vhosts&&s&&this.vhosts[s];return i&&this._lookup(t,r,i,e)||this._lookup(t,r,this.routes,e)||"head"===e&&i&&this._lookup(t,r,i,"get")||"head"===e&&this._lookup(t,r,this.routes,"get")||"options"===e&&this.specials.options||i&&this._lookup(t,r,i,"*")||this._lookup(t,r,this.routes,"*")||this.specials.notFound||n.notFound()},a.Router.prototype._lookup=function(e,t,s,r){const n=s[r];if(!n)return null;const i=n.router.lookup(e,t,this.settings);if(!i)return null;const o={},c=[];for(let e=0;e<i.array.length;++e){const t=i.record.params[e],s=a.decode(i.array[e]);if(s.isBoom)return this.specials.badRequest||s;void 0!==o[t]?o[t]=o[t]+"/"+s:o[t]=s,e+1!==i.array.length&&t===i.record.params[e+1]||c.push(o[t])}return{params:o,paramsArray:c,route:i.record.route}},a.decode=function(e){try{return decodeURIComponent(e)}catch(e){return n.badRequest("Invalid request path")}},a.Router.prototype.normalize=function(e){if(e&&-1!==e.indexOf("%")){const t=e.replace(/%[0-9a-fA-F][0-9a-fA-F]/g,e=>e.toUpperCase());e=t.replace(/%(?:2[146-9A-E]|3[\dABD]|4[\dA-F]|5[\dAF]|6[1-9A-F]|7[\dAE])/g,e=>String.fromCharCode(parseInt(e.substring(1),16)))}if(e&&(-1!==e.indexOf("/.")||"."===e[0])){const t="/"===e[0],s=e.split("/"),r=[];let n;for(let e=0;e<s.length;++e)".."===(n=s[e])?r.pop():"."!==n&&r.push(n);"."!==n&&".."!==n||r.push(""),"/"!==(e=r.join("/"))[0]&&t&&(e="/"+e)}return e},a.Router.prototype.analyze=function(e){r.assert(a.pathRegex.validatePath.test(e),"Invalid path:",e),r.assert(!a.pathRegex.validatePathEncoded.test(e),"Path cannot contain encoded non-reserved path characters:",e);const t=e.split("/"),s=[],n=[],i=[];for(let o=1;o<t.length;++o){let c=t[o];if(-1===c.indexOf("{")){c=this.settings.isCaseSensitive?c:c.toLowerCase(),i.push(c),s.push({literal:c});continue}const l=a.parseParams(c);if(1===l.length){const t=l[0];if(r.assert(-1===n.indexOf(t.name),"Cannot repeat the same parameter name:",t.name,"in:",e),n.push(t.name),t.wilcard)if(t.count)for(let e=0;e<t.count;++e)i.push("?"),s.push({}),e&&n.push(t.name);else i.push("#"),s.push({wildcard:!0});else i.push("?"),s.push({empty:t.empty})}else{const t={length:l.length,first:"string"!=typeof l[0],segments:[]};let o="",a="^";for(let s=0;s<l.length;++s){const i=l[s];"string"==typeof i?(o+=i,a+=r.escapeRegex(i),t.segments.push(i)):(r.assert(-1===n.indexOf(i.name),"Cannot repeat the same parameter name:",i.name,"in:",e),n.push(i.name),o+="?",a=a+"(."+(i.empty?"*":"+")+")")}t.mixed=new RegExp(a+"$",this.settings.isCaseSensitive?"":"i"),i.push(o),s.push(t)}}return{segments:s,fingerprint:"/"+i.join("/"),params:n}},a.parseParams=function(e){const t=[];return e.replace(a.pathRegex.parseParam,(e,s,r,n,i,o)=>(s?t.push(s):t.push({name:r,wilcard:!!n,count:i&&parseInt(i,10),empty:!!o}),"")),t},a.Router.prototype.table=function(e){const t=[],s=e=>{e&&Object.keys(e).forEach(s=>{e[s].routes.forEach(e=>{t.push(e.route)})})};if(this.vhosts){const t=e?[].concat(e):Object.keys(this.vhosts);for(let e=0;e<t.length;++e)s(this.vhosts[t[e]])}return s(this.routes),t},a.sort=function(e,t){const s=e.segments,r=t.segments;if(s.length!==r.length)return s.length>r.length?1:-1;for(let e=0;;++e){if(s[e].literal){if(r[e].literal){if(s[e].literal===r[e].literal)continue;return s[e].literal>r[e].literal?1:-1}return-1}return r[e].literal?1:s[e].wildcard?1:-1}}},function(e,t,s){"use strict";t.generate=function(){return{parseParam:new RegExp("((?:[\\w\\!\\$&'\\(\\)\\*\\+\\,;\\=\\:@\\-\\.~]|%[A-F0-9]{2})+)|(?:\\{(\\w+)(?:(\\*)(\\d+)?)?(\\?)?\\})","g"),validatePath:new RegExp("(?:^\\/$)|(?:^(?:\\/(?:(?:[\\w\\!\\$&'\\(\\)\\*\\+\\,;\\=\\:@\\-\\.~]|%[A-F0-9]{2})+|(?:\\{\\w+(?:\\*[1-9]\\d*)?\\})|(?:(?:(?:[\\w\\!\\$&'\\(\\)\\*\\+\\,;\\=\\:@\\-\\.~]|%[A-F0-9]{2})+(?:\\{\\w+\\??\\}))+(?:[\\w\\!\\$&'\\(\\)\\*\\+\\,;\\=\\:@\\-\\.~]|%[A-F0-9]{2})*)|(?:(?:\\{\\w+\\??\\})(?:(?:[\\w\\!\\$&'\\(\\)\\*\\+\\,;\\=\\:@\\-\\.~]|%[A-F0-9]{2})+(?:\\{\\w+\\??\\}))+(?:[\\w\\!\\$&'\\(\\)\\*\\+\\,;\\=\\:@\\-\\.~]|%[A-F0-9]{2})*)|(?:(?:\\{\\w+\\??\\})(?:[\\w\\!\\$&'\\(\\)\\*\\+\\,;\\=\\:@\\-\\.~]|%[A-F0-9]{2})+)))*(?:\\/(?:\\{\\w+(?:(?:\\*(?:[1-9]\\d*)?)|(?:\\?))?\\})?)?$)"),validatePathEncoded:/%(?:2[146-9A-E]|3[\dABD]|4[\dA-F]|5[\dAF]|6[1-9A-F]|7[\dAE])/g}}},function(e,t,s){"use strict";const r=s(4),n={};e.exports=n.Segment=function(){this._edge=null,this._fulls=null,this._literals=null,this._param=null,this._mixed=null,this._wildcard=null},n.Segment.prototype.add=function(e,t){const s=e[0],i=e.slice(1),o=!i.length,a=[];let c=!0;for(let t=0;t<e.length&&c;++t)c=void 0!==e[t].literal,a.push(e[t].literal);if(c){this._fulls=this._fulls||{};let e="/"+a.join("/");t.settings.isCaseSensitive||(e=e.toLowerCase()),r.assert(!this._fulls[e],"New route",t.path,"conflicts with existing",this._fulls[e]&&this._fulls[e].record.path),this._fulls[e]={segment:s,record:t}}else if(void 0!==s.literal){this._literals=this._literals||{};const e=t.settings.isCaseSensitive?s.literal:s.literal.toLowerCase();this._literals[e]=this._literals[e]||new n.Segment,this._literals[e].add(i,t)}else if(s.wildcard)r.assert(!this._wildcard,"New route",t.path,"conflicts with existing",this._wildcard&&this._wildcard.record.path),r.assert(!this._param||!this._param._wildcard,"New route",t.path,"conflicts with existing",this._param&&this._param._wildcard&&this._param._wildcard.record.path),this._wildcard={segment:s,record:t};else if(s.mixed){this._mixed=this._mixed||[];let e=this._mixedLookup(s);e||(e={segment:s,node:new n.Segment},this._mixed.push(e),this._mixed.sort(n.mixed)),o?(r.assert(!e.node._edge,"New route",t.path,"conflicts with existing",e.node._edge&&e.node._edge.record.path),e.node._edge={segment:s,record:t}):e.node.add(i,t)}else this._param=this._param||new n.Segment,o?(r.assert(!this._param._edge,"New route",t.path,"conflicts with existing",this._param._edge&&this._param._edge.record.path),this._param._edge={segment:s,record:t}):(r.assert(!this._wildcard||!i[0].wildcard,"New route",t.path,"conflicts with existing",this._wildcard&&this._wildcard.record.path),this._param.add(i,t))},n.Segment.prototype._mixedLookup=function(e){for(let t=0;t<this._mixed.length;++t)if(0===n.mixed({segment:e},this._mixed[t]))return this._mixed[t];return null},n.mixed=function(e,t){const s=e.segment,r=t.segment;if(s.length!==r.length)return s.length>r.length?-1:1;if(s.first!==r.first)return s.first?1:-1;for(let e=0;e<s.segments.length;++e){const t=s.segments[e],n=r.segments[e];if(t!==n)return t.length===n.length?t>n?1:-1:t.length<n.length?1:-1}return 0},n.Segment.prototype.lookup=function(e,t,s){let r=null;if(this._fulls&&(r=this._fulls[s.isCaseSensitive?e:e.toLowerCase()]))return{record:r.record,array:[]};const i=t[0],o=e.slice(i.length+1),a=t.length>1?t.slice(1):null;if(this._literals){const e=s.isCaseSensitive?i:i.toLowerCase();if(r=this._literals.hasOwnProperty(e)&&this._literals[e]){const e=n.deeper(r,o,a,[],s);if(e)return e}}if(this._mixed)for(let e=0;e<this._mixed.length;++e){r=this._mixed[e];const t=i.match(r.segment.mixed);if(t){const e=[];for(let s=1;s<t.length;++s)e.push(t[s]);const i=n.deeper(r.node,o,a,e,s);if(i)return i}}if(this._param&&(i||this._param._edge&&this._param._edge.segment.empty)){const e=n.deeper(this._param,o,a,[i],s);if(e)return e}return this._wildcard?{record:this._wildcard.record,array:[e.slice(1)]}:null},n.deeper=function(e,t,s,r,n){if(s){const i=e.lookup(t,s,n);if(i)return{record:i.record,array:r.concat(i.array)}}else{if(e._edge)return{record:e._edge.record,array:r};if(e._wildcard)return{record:e._wildcard.record,array:r}}return null}},function(e,t,s){"use strict";const r=s(5),n=s(34),i=s(9),o=s(0),a=s(17),c=s(72),l={version:"2"};e.exports=l.Socket=function(e,t,s){this._ws=e,this._cookies=t.headers.cookie,this._listener=s,this._helloed=!1,this._pinged=!1,this._processingCount=0,this._subscriptions={},this._packets=[],this._sending=!1,this._removed=new c,this.server=this._listener._server,this.id=this._listener._generateId(),this.app={},this.auth={isAuthenticated:!1,credentials:null,artifacts:null,_error:null,_initialAuthTimeout:null,_verified:0},this.info={remoteAddress:t.socket.remoteAddress,remotePort:t.socket.remotePort},this._listener._settings.auth&&this._listener._settings.auth.timeout&&(this.auth._initialAuthTimeout=setTimeout(()=>this.disconnect(),this._listener._settings.auth.timeout)),this._ws.on("message",e=>this._onMessage(e))},l.Socket.prototype.disconnect=function(){return clearTimeout(this.auth._initialAuthTimeout),this.auth._initialAuthTimeout=null,this._ws.close(),this._removed},l.Socket.prototype.send=function(e){const t={type:"update",message:e};return this._send(t)},l.Socket.prototype.publish=function(e,t){const s={type:"pub",path:e,message:t};return this._send(s)},l.Socket.prototype.revoke=async function(e,t){await this._unsubscribe(e);const s={type:"revoke",path:e};return null!==t&&(s.message=t),this._send(s)},l.Socket.prototype._send=function(e,t){if(t=t||{},1!==this._ws.readyState)return Promise.reject(r.internal("Socket not open"));try{var s=JSON.stringify(e);t.replace&&Object.keys(t.replace).forEach(e=>{s=s.replace(`"${e}"`,t.replace[e])})}catch(t){return this.server.log(["nes","serialization","error"],e.type),e.id?this._error(r.internal("Failed serializing message"),e):Promise.reject(t)}const n=new c;return this._packets.push({message:s,type:e.type,team:n}),this._flush(),n.work},l.Socket.prototype._flush=async function(){if(this._sending||!this._packets.length)return;this._sending=!0;const e=this._packets.shift();let t=[e.message];const s=this._listener._settings.payload.maxChunkChars;if(s&&e.message.length>s){t=[];const r=Math.ceil(e.message.length/s);for(let n=0;n<r;++n){const i=n===r-1?"!":"+";t.push(i+e.message.slice(n*s,(n+1)*s))}}for(let s=0;s<t.length;++s){const n=t[s],i=new c;this._ws.send(n,e=>i.attend(e));try{await i.work}catch(e){var r=e;break}"ping"!==e.type&&(this._pinged=!0)}this._sending=!1,e.team.attend(r),setImmediate(()=>this._flush())},l.Socket.prototype._active=function(){return this._pinged||this._sending||this._processingCount},l.Socket.prototype._error=function(e,t){e=r.boomify(e);const s=o.clone(e.output);return delete s.payload.statusCode,s.headers=this._filterHeaders(s.headers),t&&(s.type=t.type,s.id=t.id),e.path&&(s.path=e.path),this._send(s)},l.Socket.prototype._onMessage=async function(e){try{var t=JSON.parse(e)}catch(e){return this._error(r.badRequest("Cannot parse message"))}this._pinged=!0,++this._processingCount;try{var{response:s,options:i}=await this._lifecycle(t)}catch(e){n.rethrow(e,"system");var o=e}try{o?await this._error(o,t):s&&await this._send(s,i)}catch(e){n.rethrow(e,"system"),this.disconnect()}--this._processingCount},l.Socket.prototype._lifecycle=async function(e){if(!e.type)throw r.badRequest("Cannot parse message");if(!e.id)throw r.badRequest("Message missing id");if(await this._verifyAuth(),"ping"===e.type)return{};if("hello"===e.type)return this._processHello(e);if(!this._helloed)throw r.badRequest("Connection is not initialized");if("reauth"===e.type)return this._processReauth(e);if("request"===e.type)return this._processRequest(e);if("message"===e.type)return this._processMessage(e);if("sub"===e.type)return this._processSubscription(e);if("unsub"===e.type)return this._processUnsub(e);throw r.badRequest("Unknown message type")},l.Socket.prototype._processHello=async function(e){if(this._helloed)throw r.badRequest("Connection already initialized");if(e.version!==l.version)throw r.badRequest("Incorrect protocol version (expected "+l.version+" but received "+(e.version||"none")+")");if(this._helloed=!0,await this._authenticate(e),this._listener._settings.onConnection&&await this._listener._settings.onConnection(this),e.subs)for(let t=0;t<e.subs.length;++t){const s=e.subs[t];try{await this._listener._subscribe(s,this)}catch(e){throw e.path=s,e}}return{response:{type:"hello",id:e.id,heartbeat:this._listener._settings.heartbeat,socket:this.id}}},l.Socket.prototype._processReauth=async function(e){try{await this._authenticate(e)}catch(e){throw n.rethrow(e,"system"),setTimeout(()=>this.disconnect()),e}return{response:{type:"reauth",id:e.id}}},l.Socket.prototype._processRequest=async function(e){let t=e.method;if(!t)throw r.badRequest("Message missing method");let s=e.path;if(!s)throw r.badRequest("Message missing path");if(e.headers&&l.caseInsensitiveKey(e.headers,"authorization"))throw r.badRequest("Cannot include an Authorization header");if("/"!==s[0]){const e=this.server.lookup(s);if(!e)throw r.notFound();if(s=e.path,"*"===(t=e.method))throw r.badRequest("Cannot use route id with wildcard method route config")}if(this._listener._settings.auth&&s===this._listener._settings.auth.endpoint)throw r.notFound();const n={method:t,url:s,payload:e.payload,headers:e.headers,auth:this.auth.isAuthenticated?this.auth:null,validate:!1,plugins:{nes:{socket:this}}},o=await this.server.inject(n),a={type:"request",id:e.id,statusCode:o.statusCode,payload:o.result,headers:this._filterHeaders(o.headers)},c={};if("string"==typeof o.result&&o.headers["content-type"]&&o.headers["content-type"].match(/^application\/json/)){const e=i.randomString(32);c.replace={[e]:o.result},a.payload=e}return{response:a,options:c}},l.Socket.prototype._processMessage=async function(e){if(!this._listener._settings.onMessage)throw r.notImplemented();const t=await this._listener._settings.onMessage(this,e.message);return{response:{type:"message",id:e.id,message:t}}},l.Socket.prototype._processSubscription=async function(e){return await this._listener._subscribe(e.path,this),{response:{type:"sub",id:e.id,path:e.path}}},l.Socket.prototype._processUnsub=async function(e){return await this._unsubscribe(e.path),{response:{type:"unsub",id:e.id}}},l.Socket.prototype._unsubscribe=function(e){const t=this._subscriptions[e];if(t)return delete this._subscriptions[e],t.remove(this,e)},l.Socket.prototype._authenticate=async function(e){if(await this._authByCookie(),!e.auth&&!this.auth.isAuthenticated&&this._listener._authRequired())throw r.unauthorized("Connection requires authentication");if(e.auth&&"reauth"!==e.type&&this.auth.isAuthenticated)throw r.badRequest("Connection already authenticated");if(clearTimeout(this.auth._initialAuthTimeout),this.auth._initialAuthTimeout=null,e.auth){const t=this._listener._settings.auth;if("direct"===t.type){const s=this.server.lookup(t.id),n=await this.server.inject({url:s.path,method:"auth",headers:e.auth.headers,allowInternals:!0,validate:!1});if(200!==n.statusCode)throw r.unauthorized(n.result.message);return void this._setCredentials(n.result)}try{const s=await a.unseal(e.auth,t.password,t.iron||a.defaults);this._setCredentials(s)}catch(e){throw r.unauthorized("Invalid token")}}},l.Socket.prototype._authByCookie=async function(){const e=this._listener._settings.auth;if(!e)return;const t=this._cookies;if(!t)return;try{var{states:s}=await this.server.states.parse(t)}catch(e){throw r.unauthorized("Invalid nes authentication cookie")}const n=s[e.cookie];n&&this._setCredentials(n)},l.Socket.prototype._setCredentials=function(e){this.auth.isAuthenticated=!0,this.auth.credentials=e.credentials,this.auth.artifacts=e.artifacts,this.auth.strategy=e.strategy,this.auth._verified=Date.now(),this._listener._sockets.auth(this)},l.Socket.prototype._verifyAuth=async function(){const e=Date.now();if(this._listener._settings.auth.minAuthVerifyInterval&&!(e-this.auth._verified<this._listener._settings.auth.minAuthVerifyInterval)){this.auth._verified=e;try{await this.server.auth.verify(this)}catch(e){throw n.rethrow(e,"system"),setImmediate(()=>this.disconnect()),r.forbidden("Credential verification failed")}}},l.Socket.prototype._filterHeaders=function(e){const t=this._listener._settings.headers;if(!t)return;if("*"===t)return e;const s={},r=Object.keys(e);for(let n=0;n<r.length;++n){const i=r[n];-1!==t.indexOf(i.toLowerCase())&&(s[i]=e[i])}return s},l.caseInsensitiveKey=function(e,t){const s=Object.keys(e);for(let r=0;r<s.length;++r){const n=s[r];if(t===n.toLowerCase())return e[n]}}},function(e,t,s){"use strict";const r={};e.exports=r.Team=function(e={}){this.work=new Promise((e,t)=>{this._resolve=e,this._reject=t});const t=e.meetings||1;this._meetings=t,this._count=t,this._notes=[]},r.Team.prototype.attend=function(e){return e instanceof Error?this._reject(e):(this._notes.push(e),--this._count?void 0:this._resolve(1===this._meetings?this._notes[0]:this._notes))}},function(e){e.exports={name:"nes",description:"WebSocket adapter plugin for hapi routes",version:"10.0.0",repository:"git://github.com/hapijs/nes",main:"lib/index.js",browser:"dist/client.js",keywords:["hapi","plugin","websocket"],dependencies:{boom:"7.x.x",bounce:"1.x.x",call:"5.x.x",cryptiles:"4.x.x",hoek:"5.x.x",iron:"5.x.x",joi:"13.x.x",teamwork:"3.x.x",ws:"5.x.x"},devDependencies:{"babel-cli":"^6.26.0","babel-preset-env":"^1.6.1","babel-preset-minify":"^0.2.0",code:"5.x.x",hapi:"18.x.x",lab:"18.x.x",mkdirp:"0.5.1"},babel:{presets:["es2015"]},scripts:{"build-client":"mkdirp dist && babel lib/client.js --out-file dist/client.js",test:"npm run-script build-client && node node_modules/lab/bin/lab -a code -t 100 -L",prepare:"npm run-script build-client","test-cov-html":"node node_modules/lab/bin/lab -a code -r html -o coverage.html"},license:"BSD-3-Clause"}},function(e,t,s){"use strict";var r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});const n=s(75);t.BaseComponent=n.BaseComponent;const i=r(s(77));t.UtilEnv=i;const o=r(s(35));t.UtilConstant=o,t.connect=function(e){_nucleus(e)}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(76);t.BaseComponent=class{constructor(){this.cmpId="",this.cmpName=""}_send(e,t){this._evtBus&&this._evtBus.emitAsync(e,t)}_sendWithReturn(e,t,s){return new Promise((n,i)=>{this._evtBus?(this._evtBus.once(t,e=>{n(e)}),this._evtBus.emitAsync(e,s)):i(Error(r.Errors.TECHNICAL.EVENTBUS_IS_NOT_DEFINED))})}_Receive(e,t){return this._evtBus?this._evtBus.on(e,t):{off:()=>void 0}}_ReceiveOnce(e,t){return this._evtBus?this._evtBus.once(e,t):{off:()=>void 0}}get identity(){return{cmpId:this.cmpId,cmpName:this.cmpName}}initialize(){}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let r=s(35).constantTree({TYPE:{TECHNICAL:"",BUSINESS:""},TECHNICAL:{EVENTBUS_IS_NOT_DEFINED:""}});t.Errors=r},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=function(){return"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)}}]);